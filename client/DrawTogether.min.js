function Account(b,a){this.uKey=a||localStorage.getItem("drawtogether-uKey")||"";this.mail=localStorage.getItem("drawtogether-mail");this.server=b;setInterval(this.checkLogin.bind(this),18E5)}Account.prototype.login=function(b,a,c){this.loginNoHash(b,CryptoJS.SHA256(a).toString(CryptoJS.enc.Base64),c)};
Account.prototype.loginNoHash=function(b,a,c){var e=new XMLHttpRequest;e.addEventListener("readystatechange",function(d){200==e.status&&4==e.readyState?(d=JSON.parse(e.responseText),d.error?c(d.error):(this.uKey=d.uKey,this.mail=b,localStorage.setItem("drawtogether-uKey",d.uKey),localStorage.setItem("drawtogether-mail",b),localStorage.setItem("drawtogether-pass",a),setTimeout(c,0))):4==e.readyState&&c("Connection error, status code: "+e.status)}.bind(this));e.open("GET",this.server+"/login?email="+
encodeURIComponent(b)+"&pass="+encodeURIComponent(a));e.send()};
Account.prototype.register=function(b,a,c){var e=new XMLHttpRequest;a=CryptoJS.SHA256(a).toString(CryptoJS.enc.Base64);e.addEventListener("readystatechange",function(d){200==e.status&&4==e.readyState?(d=JSON.parse(e.responseText),d.error?c(d.error):(this.uKey=d.uKey,this.mail=b,localStorage.setItem("drawtogether-uKey",d.uKey),localStorage.setItem("drawtogether-mail",b),localStorage.setItem("drawtogether-pass",a),setTimeout(c,0))):4==e.readyState&&c("Connection error, status code: "+e.status)}.bind(this));
e.open("GET",this.server+"/register?email="+encodeURIComponent(b)+"&pass="+encodeURIComponent(a));e.send()};
Account.prototype.logout=function(b){var a=new XMLHttpRequest;a.addEventListener("readystatechange",function(c){200==a.status&&4==a.readyState?(c=JSON.parse(a.responseText),c.error?b("There was an error trying to logout: "+c.error):(localStorage.removeItem("drawtogether-uKey"),localStorage.removeItem("drawtogether-mail"),localStorage.removeItem("drawtogether-pass"),delete this.uKey,delete this.mail,setTimeout(function(){b(null,!0)},0))):4==a.readyState&&b("Connection error, status code: "+a.status)}.bind(this));
a.open("GET",this.server+"/logout?uKey="+encodeURIComponent(this.uKey));a.send()};
Account.prototype.checkLogin=function(b){b=b||function(){};if(!this.uKey&&localStorage.getItem("drawtogether-mail")&&localStorage.getItem("drawtogether-pass"))this.loginNoHash(localStorage.getItem("drawtogether-mail"),localStorage.getItem("drawtogether-pass"),function(a){b(a,!a)});else if(this.uKey){var a=new XMLHttpRequest;a.addEventListener("readystatechange",function(c){200==a.status&&4==a.readyState?(c=JSON.parse(a.responseText),c.error?"Not logged in."==c.error?(delete this.uKey,localStorage.removeItem("drawtogether-uKey"),
localStorage.getItem("drawtogether-mail")&&localStorage.getItem("drawtogether-pass")?this.loginNoHash(localStorage.getItem("drawtogether-mail"),localStorage.getItem("drawtogether-pass"),function(a){b(a,!a)}):b(null,!1)):b(c.error):setTimeout(function(){b(null,!0)},0)):4==a.readyState&&b("Connection error: Status code: "+a.status)}.bind(this));a.open("GET",this.server+"/checklogin?uKey="+encodeURIComponent(this.uKey));a.send()}else setTimeout(function(){b(null,!1)},0)};
Account.prototype.getReputationList=function(b){this.request("/getreputationlist",{},this.parseData.bind(this,function(a,c){a||!c||c.error||c.err?b(a||c.error||c.err,c):b(null,c)}))};Account.prototype.feedback=function(b){};
Account.prototype.request=function(b,a,c){var e=new XMLHttpRequest,d="?",f;for(f in a)d+=encodeURIComponent(f)+"="+encodeURIComponent(a[f])+"&";d=d.slice(0,d.length-1);e.addEventListener("readystatechange",function(b){if(4==e.readyState){var a;200!==e.status&&(a="Http error: "+e.status+" are you connected to the internet?");c(a,e)}});e.open("GET",this.server+b+d);e.send()};
Account.prototype.parseData=function(b,a,c){if(b)c(b);else{try{var e=JSON.parse(a.responseText)}catch(d){b="JSON Parse error. Server response was: "+a.responseText}c(b,e)}};function Chat(b,a,c){this.messagesDom=b.appendChild(document.createElement("div"));this.messagesDom.classList.add("messagecontainer");this.userSettings=c;this.inputContainerDom=b.appendChild(document.createElement("div"));this.inputContainerDom.classList.add("inputcontainer");this.input=this.inputContainerDom.appendChild(document.createElement("input"));this.input.placeholder="Chatmessage here...";this.input.className="drawtogheter-chat-input";this.input.addEventListener("keypress",function(b){13==
b.keyCode&&this.sendChat()}.bind(this));this.input.maxLength=255;this.input.setAttribute("data-snap-ignore","true");button=this.inputContainerDom.appendChild(document.createElement("div"));button.classList.add("button-small");button.setAttribute("data-snap-ignore","true");button.appendChild(document.createTextNode("Send"));button.addEventListener("click",this.sendChat.bind(this));this.onMessage=a||function(){};this.messageSound=new Audio("sounds/message.wav")}
Chat.prototype.string2Color=function(b){for(var a=2348,c=0.9,e=0.4,d=Math.max(b.length-1,2);0<=d;d--)for(var f=b.length-1;0<=f;f--)a=(a<<5)-a+~b.charCodeAt(f);0>a&&(a=-a,e=0.35);360<a&&(b=parseInt(a/360),a-=360*b,0===b%3?c=1:0===b%2&&(c=0.95));return"hsl("+a+", "+100*c+"%, "+70*e+"%)"};Chat.prototype.emotesOrder="CasualLama Nyan RedCoat BCouch FUNgineer GrammarKing JonCarnage NotLikeThis OMGScoots NoNoSpot OSkomodo ShazBotstix PuppeyFace CorgiDerp OptimizePrime PraiseIt TTours YouWHY cmonBruh PunchTrees SriHead Jebaited Keepo panicBasket BatChest BloodTrail HotPokket CoolCat SuperVinlin PicoMause Volcania OhMyDog SeemsGood SMOrc StoneLightning UnSane DogFace EleGiggle KappaRoss FrankerZ VoHiYo MVGame RaccAttack UncleNox HeyGuys Kappa Kippa ShadyLulu SoBayed SSSsss TinyFace WTRuck BigBrother BORT PanicVis KAPOW TriHard MingLee OSfrog PermaSmug PeteZaroll ArsonNoSexy FreakinStinkin GingerPower PipeHype CougarHunt FPSMarksman HassanChop TheTarFu deIlluminati SwiftRage TF2John RalpherZ RuleFive TheRinger ThunBeast BrainSlug DansGame FunRun ItsBoshyTime KappaPride ArgieB8 BlargNaut BuddhaBar NotATK PRChase ShibeZ KevinTurtle NinjaTroll RitzMitz KappaWealth PMSTwin TooSpicy WholeWheat EvilFetus PogChamp SMSkull twitchRaid UleetBackup WutFace ANELE AsianGlow BrokeBack KappaClaus MikeHogu PartyTime TheThing bleedPurple FuzzyOtterOO HassaanChop OneHand BabyRage DAESuppy Mau5 riPepperonis DOOMGuy mcaT OpieOP duDudu EagleEye FailFish MrDestructoid PeoplesChamp 4Head BCWarrior DendiFace WinWaker PeteZarollTie SoonerLater VaultBoy Kreygasm Poooound HumbleLife JKanStyle ResidentSleeper StrawBeary AthenaPMS DatSheffy deExcite OSsloth PazPazowitz PJSalt BibleThump BionicBunion DBstyle WillDraw4Rep".split(" ");
Chat.prototype.emotesHash={CasualLama:"images/emotes/CasualLama.png",Nyan:"images/emotes/Nyan.png","4Head":"images/emotes/4Head.png",ANELE:"images/emotes/ANELE.png",ArgieB8:"images/emotes/ArgieB8.png",ArsonNoSexy:"images/emotes/ArsonNoSexy.png",AsianGlow:"images/emotes/AsianGlow.png",AthenaPMS:"images/emotes/AthenaPMS.png",BCWarrior:"images/emotes/BCWarrior.png",BCouch:"images/emotes/BCouch.png",BORT:"images/emotes/BORT.png",BabyRage:"images/emotes/BabyRage.png",BatChest:"images/emotes/BatChest.png",
BibleThump:"images/emotes/BibleThump.png",BigBrother:"images/emotes/BigBrother.png",BionicBunion:"images/emotes/BionicBunion.png",BlargNaut:"images/emotes/BlargNaut.png",BloodTrail:"images/emotes/BloodTrail.png",BrainSlug:"images/emotes/BrainSlug.png",BrokeBack:"images/emotes/BrokeBack.png",BuddhaBar:"images/emotes/BuddhaBar.png",CoolCat:"images/emotes/CoolCat.png",CorgiDerp:"images/emotes/CorgiDerp.png",CougarHunt:"images/emotes/CougarHunt.png",DAESuppy:"images/emotes/DAESuppy.png",DBstyle:"images/emotes/DBstyle.png",
DOOMGuy:"images/emotes/DOOMGuy.png",DansGame:"images/emotes/DansGame.png",DatSheffy:"images/emotes/DatSheffy.png",DendiFace:"images/emotes/DendiFace.png",DogFace:"images/emotes/DogFace.png",EagleEye:"images/emotes/EagleEye.png",EleGiggle:"images/emotes/EleGiggle.png",EvilFetus:"images/emotes/EvilFetus.png",FPSMarksman:"images/emotes/FPSMarksman.png",FUNgineer:"images/emotes/FUNgineer.png",FailFish:"images/emotes/FailFish.png",FrankerZ:"images/emotes/FrankerZ.png",FreakinStinkin:"images/emotes/FreakinStinkin.png",
FunRun:"images/emotes/FunRun.png",FuzzyOtterOO:"images/emotes/FuzzyOtterOO.png",GingerPower:"images/emotes/GingerPower.png",GrammarKing:"images/emotes/GrammarKing.png",HassaanChop:"images/emotes/HassaanChop.png",HassanChop:"images/emotes/HassanChop.png",HeyGuys:"images/emotes/HeyGuys.png",HotPokket:"images/emotes/HotPokket.png",HumbleLife:"images/emotes/HumbleLife.png",ItsBoshyTime:"images/emotes/ItsBoshyTime.png",JKanStyle:"images/emotes/JKanStyle.png",Jebaited:"images/emotes/Jebaited.png",JonCarnage:"images/emotes/JonCarnage.png",
KAPOW:"images/emotes/KAPOW.png",Kappa:"images/emotes/Kappa.png",KappaClaus:"images/emotes/KappaClaus.png",KappaPride:"images/emotes/KappaPride.png",KappaRoss:"images/emotes/KappaRoss.png",KappaWealth:"images/emotes/KappaWealth.png",Keepo:"images/emotes/Keepo.png",KevinTurtle:"images/emotes/KevinTurtle.png",Kippa:"images/emotes/Kippa.png",Kreygasm:"images/emotes/Kreygasm.png",MVGame:"images/emotes/MVGame.png",Mau5:"images/emotes/Mau5.png",MikeHogu:"images/emotes/MikeHogu.png",MingLee:"images/emotes/MingLee.png",
MrDestructoid:"images/emotes/MrDestructoid.png",NinjaTroll:"images/emotes/NinjaTroll.png",NoNoSpot:"images/emotes/NoNoSpot.png",NotATK:"images/emotes/NotATK.png",NotLikeThis:"images/emotes/NotLikeThis.png",OMGScoots:"images/emotes/OMGScoots.png",OSfrog:"images/emotes/OSfrog.png",OSkomodo:"images/emotes/OSkomodo.png",OSsloth:"images/emotes/OSsloth.png",OhMyDog:"images/emotes/OhMyDog.png",OneHand:"images/emotes/OneHand.png",OpieOP:"images/emotes/OpieOP.png",OptimizePrime:"images/emotes/OptimizePrime.png",
PJSalt:"images/emotes/PJSalt.png",PMSTwin:"images/emotes/PMSTwin.png",PRChase:"images/emotes/PRChase.png",PanicVis:"images/emotes/PanicVis.png",PartyTime:"images/emotes/PartyTime.png",PazPazowitz:"images/emotes/PazPazowitz.png",PeoplesChamp:"images/emotes/PeoplesChamp.png",PermaSmug:"images/emotes/PermaSmug.png",PeteZaroll:"images/emotes/PeteZaroll.png",PeteZarollTie:"images/emotes/PeteZarollTie.png",PicoMause:"images/emotes/PicoMause.png",PipeHype:"images/emotes/PipeHype.png",PogChamp:"images/emotes/PogChamp.png",
Poooound:"images/emotes/Poooound.png",PraiseIt:"images/emotes/PraiseIt.png",PunchTrees:"images/emotes/PunchTrees.png",PuppeyFace:"images/emotes/PuppeyFace.png",RaccAttack:"images/emotes/RaccAttack.png",RalpherZ:"images/emotes/RalpherZ.png",RedCoat:"images/emotes/RedCoat.png",ResidentSleeper:"images/emotes/ResidentSleeper.png",RitzMitz:"images/emotes/RitzMitz.png",RuleFive:"images/emotes/RuleFive.png",SMOrc:"images/emotes/SMOrc.png",SMSkull:"images/emotes/SMSkull.png",SSSsss:"images/emotes/SSSsss.png",
SeemsGood:"images/emotes/SeemsGood.png",ShadyLulu:"images/emotes/ShadyLulu.png",ShazBotstix:"images/emotes/ShazBotstix.png",ShibeZ:"images/emotes/ShibeZ.png",SoBayed:"images/emotes/SoBayed.png",SoonerLater:"images/emotes/SoonerLater.png",SriHead:"images/emotes/SriHead.png",StoneLightning:"images/emotes/StoneLightning.png",StrawBeary:"images/emotes/StrawBeary.png",SuperVinlin:"images/emotes/SuperVinlin.png",SwiftRage:"images/emotes/SwiftRage.png",TF2John:"images/emotes/TF2John.png",TTours:"images/emotes/TTours.png",
TheRinger:"images/emotes/TheRinger.png",TheTarFu:"images/emotes/TheTarFu.png",TheThing:"images/emotes/TheThing.png",ThunBeast:"images/emotes/ThunBeast.png",TinyFace:"images/emotes/TinyFace.png",TooSpicy:"images/emotes/TooSpicy.png",TriHard:"images/emotes/TriHard.png",UleetBackup:"images/emotes/UleetBackup.png",UnSane:"images/emotes/UnSane.png",UncleNox:"images/emotes/UncleNox.png",VaultBoy:"images/emotes/VaultBoy.png",VoHiYo:"images/emotes/VoHiYo.png",Volcania:"images/emotes/Volcania.png",WTRuck:"images/emotes/WTRuck.png",
WholeWheat:"images/emotes/WholeWheat.png",WinWaker:"images/emotes/WinWaker.png",WutFace:"images/emotes/WutFace.png",YouWHY:"images/emotes/YouWHY.png",bleedPurple:"images/emotes/bleedPurple.png",cmonBruh:"images/emotes/cmonBruh.png",deExcite:"images/emotes/deExcite.png",deIlluminati:"images/emotes/deIlluminati.png",duDudu:"images/emotes/duDudu.png",mcaT:"images/emotes/mcaT.png",panicBasket:"images/emotes/panicBasket.png",riPepperonis:"images/emotes/riPepperonis.png",twitchRaid:"images/emotes/twitchRaid.png",
WillDraw4Rep:"images/emotes/WillDraw4Rep.png"};Chat.prototype.urlRegex=/(((http|ftp)s?):\/\/)?([\d\w]+\.)+[\d\w]{2,}(\/\S+)?/;
Chat.prototype.addMessage=function(b,a){var c=Math.floor(this.messagesDom.scrollHeight-this.messagesDom.getBoundingClientRect().height),e=Math.ceil(this.messagesDom.scrollTop),d=this.messagesDom.appendChild(document.createElement("div"));d.classList.add("chat-message");var f=new Date,f=("0"+f.getHours()).slice(-2)+":"+("0"+f.getMinutes()).slice(-2)+":"+("0"+f.getSeconds()).slice(-2);if("undefined"==typeof a)a=b;else{var g=d.appendChild(document.createElement("span"));g.appendChild(document.createTextNode(b+
": "));g.style.color=this.string2Color(b)}this.addMessageToDom(d,a);d.title=f;d.alt=f;c<=e&&(this.messagesDom.scrollTop=this.messagesDom.scrollHeight-this.messagesDom.getBoundingClientRect().height);b===a||this.userSettings.getBoolean("Mute chat")||this.messageSound.play()};
Chat.prototype.addElementAsMessage=function(b){var a=Math.floor(this.messagesDom.scrollHeight-this.messagesDom.getBoundingClientRect().height),c=Math.ceil(this.messagesDom.scrollTop),e=this.messagesDom.appendChild(document.createElement("div"));e.classList.add("chat-message");e.appendChild(b);a<=c&&(this.messagesDom.scrollTop=this.messagesDom.scrollHeight-this.messagesDom.getBoundingClientRect().height)};
Chat.prototype.addMessageToDom=function(b,a){for(var c=a.split(" "),e=0;e<c.length;e++)this.urlRegex.test(c[e])&&(c[e]={url:c[e]});this.addMessageList(b,c)};Chat.prototype.addMessageList=function(b,a){for(var c=0;c<a.length;c++){var e=this.emotesHash[a[c]];e?(b.appendChild(this.createEmote(a[c],e)),b.appendChild(document.createTextNode(" "))):a[c].url?(b.appendChild(this.createUrl(a[c].url)),b.appendChild(document.createTextNode(" "))):b.appendChild(document.createTextNode(a[c]+" "))}};
Chat.prototype.createUrl=function(b){var a=document.createElement("a");a.href=-1==b.indexOf("://")?"http://"+b:b;a.target="_blank";a.appendChild(document.createTextNode(b));return a};Chat.prototype.createEmote=function(b,a){var c=document.createElement("img");c.title=b;c.alt=b;c.src=a;c.className="drawtogether-emote";return c};Chat.prototype.sendChat=function(){this.onMessage(this.input.value);this.input.value=""};var CryptoJS=CryptoJS||function(b,a){var c={},e=c.lib={},d=function(){},f=e.Base={extend:function(b){d.prototype=this;var a=new d;b&&a.mixIn(b);a.hasOwnProperty("init")||(a.init=function(){a.$super.init.apply(this,arguments)});a.init.prototype=a;a.$super=this;return a},create:function(){var b=this.extend();b.init.apply(b,arguments);return b},init:function(){},mixIn:function(b){for(var a in b)b.hasOwnProperty(a)&&(this[a]=b[a]);b.hasOwnProperty("toString")&&(this.toString=b.toString)},clone:function(){return this.init.prototype.extend(this)}},
g=e.WordArray=f.extend({init:function(b,c){b=this.words=b||[];this.sigBytes=c!=a?c:4*b.length},toString:function(b){return(b||k).stringify(this)},concat:function(b){var a=this.words,c=b.words,d=this.sigBytes;b=b.sigBytes;this.clamp();if(d%4)for(var e=0;e<b;e++)a[d+e>>>2]|=(c[e>>>2]>>>24-8*(e%4)&255)<<24-8*((d+e)%4);else if(65535<c.length)for(e=0;e<b;e+=4)a[d+e>>>2]=c[e>>>2];else a.push.apply(a,c);this.sigBytes+=b;return this},clamp:function(){var a=this.words,c=this.sigBytes;a[c>>>2]&=4294967295<<
32-8*(c%4);a.length=b.ceil(c/4)},clone:function(){var b=f.clone.call(this);b.words=this.words.slice(0);return b},random:function(a){for(var c=[],d=0;d<a;d+=4)c.push(4294967296*b.random()|0);return new g.init(c,a)}}),h=c.enc={},k=h.Hex={stringify:function(b){var a=b.words;b=b.sigBytes;for(var c=[],d=0;d<b;d++){var e=a[d>>>2]>>>24-8*(d%4)&255;c.push((e>>>4).toString(16));c.push((e&15).toString(16))}return c.join("")},parse:function(b){for(var a=b.length,c=[],d=0;d<a;d+=2)c[d>>>3]|=parseInt(b.substr(d,
2),16)<<24-4*(d%8);return new g.init(c,a/2)}},l=h.Latin1={stringify:function(b){var a=b.words;b=b.sigBytes;for(var c=[],d=0;d<b;d++)c.push(String.fromCharCode(a[d>>>2]>>>24-8*(d%4)&255));return c.join("")},parse:function(b){for(var a=b.length,c=[],d=0;d<a;d++)c[d>>>2]|=(b.charCodeAt(d)&255)<<24-8*(d%4);return new g.init(c,a)}},m=h.Utf8={stringify:function(b){try{return decodeURIComponent(escape(l.stringify(b)))}catch(a){throw Error("Malformed UTF-8 data");}},parse:function(b){return l.parse(unescape(encodeURIComponent(b)))}},
n=e.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=new g.init;this._nDataBytes=0},_append:function(b){"string"==typeof b&&(b=m.parse(b));this._data.concat(b);this._nDataBytes+=b.sigBytes},_process:function(a){var c=this._data,d=c.words,e=c.sigBytes,f=this.blockSize,h=e/(4*f),h=a?b.ceil(h):b.max((h|0)-this._minBufferSize,0);a=h*f;e=b.min(4*a,e);if(a){for(var k=0;k<a;k+=f)this._doProcessBlock(d,k);k=d.splice(0,a);c.sigBytes-=e}return new g.init(k,e)},clone:function(){var b=f.clone.call(this);
b._data=this._data.clone();return b},_minBufferSize:0});e.Hasher=n.extend({cfg:f.extend(),init:function(b){this.cfg=this.cfg.extend(b);this.reset()},reset:function(){n.reset.call(this);this._doReset()},update:function(b){this._append(b);this._process();return this},finalize:function(b){b&&this._append(b);return this._doFinalize()},blockSize:16,_createHelper:function(b){return function(a,c){return(new b.init(c)).finalize(a)}},_createHmacHelper:function(b){return function(a,c){return(new r.HMAC.init(b,
c)).finalize(a)}}});var r=c.algo={};return c}(Math);
(function(b){for(var a=CryptoJS,c=a.lib,e=c.WordArray,d=c.Hasher,c=a.algo,f=[],g=[],h=function(b){return 4294967296*(b-(b|0))|0},k=2,l=0;64>l;){var m;a:{m=k;for(var n=b.sqrt(m),r=2;r<=n;r++)if(!(m%r)){m=!1;break a}m=!0}m&&(8>l&&(f[l]=h(b.pow(k,0.5))),g[l]=h(b.pow(k,1/3)),l++);k++}var q=[],c=c.SHA256=d.extend({_doReset:function(){this._hash=new e.init(f.slice(0))},_doProcessBlock:function(b,a){for(var c=this._hash.words,d=c[0],e=c[1],f=c[2],h=c[3],k=c[4],l=c[5],n=c[6],m=c[7],r=0;64>r;r++){if(16>r)q[r]=
b[a+r]|0;else{var J=q[r-15],y=q[r-2];q[r]=((J<<25|J>>>7)^(J<<14|J>>>18)^J>>>3)+q[r-7]+((y<<15|y>>>17)^(y<<13|y>>>19)^y>>>10)+q[r-16]}J=m+((k<<26|k>>>6)^(k<<21|k>>>11)^(k<<7|k>>>25))+(k&l^~k&n)+g[r]+q[r];y=((d<<30|d>>>2)^(d<<19|d>>>13)^(d<<10|d>>>22))+(d&e^d&f^e&f);m=n;n=l;l=k;k=h+J|0;h=f;f=e;e=d;d=J+y|0}c[0]=c[0]+d|0;c[1]=c[1]+e|0;c[2]=c[2]+f|0;c[3]=c[3]+h|0;c[4]=c[4]+k|0;c[5]=c[5]+l|0;c[6]=c[6]+n|0;c[7]=c[7]+m|0},_doFinalize:function(){var a=this._data,c=a.words,d=8*this._nDataBytes,e=8*a.sigBytes;
c[e>>>5]|=128<<24-e%32;c[(e+64>>>9<<4)+14]=b.floor(d/4294967296);c[(e+64>>>9<<4)+15]=d;a.sigBytes=4*c.length;this._process();return this._hash},clone:function(){var b=d.clone.call(this);b._hash=this._hash.clone();return b}});a.SHA256=d._createHelper(c);a.HmacSHA256=d._createHmacHelper(c)})(Math);function DrawTogether(b,a){this.container=b;this.settings=this.utils.merge(this.utils.copy(a),this.defaultSettings);this.userSettings=QuickSettings.create(0,0,"settings");this.userSettings.setDraggable(!1);this.userSettings.setCollapsible(!1);this.playerList=[];this.moveQueue=[];this.favList=[];this.ink=0;this.previousInk=Infinity;this.lastTimeoutError=this.lastViewDeduction=this.lastZoomWarning=this.lastBrushSizeWarning=this.lastInkWarning=0;this.lastScreenMove=Date.now();this.lastScreenMoveStartPosition;
this._forceFollow;this._autoMoveScreen;this._followingPlayer;this._favoriteRenameDelayTimeout;this.network=new Network(this.settings.loadbalancer);this.account=new Account(this.settings.accountServer);this.bindSocketHandlers();this.initDom();this.gui=new Gui(b);this.updateInk();"ask"==this.settings.mode?this.openModeSelector():"askjoin"==this.settings.mode?(this.changeRoom("main"),this.openModeSelector()):"join"==this.settings.mode?(0==this.settings.room.indexOf("private_")?0==this.settings.room.indexOf("private_game_")?
ga("send","event","autojoin","privategame"):ga("send","event","autojoin","private"):this.settings.room.indexOf("game_")?ga("send","event","autojoin","game"):ga("send","event","autojoin","public"),this.changeRoom(this.settings.room,void 0,this.settings.leftTopX,this.settings.leftTopY,!0)):"private"==this.settings.mode?(this.settings.room="private_"+Math.random().toString(36).substr(2,5),this.changeRoom(this.settings.room,void 0,0,0,!0)):"member"==this.settings.mode?this.changeRoom("member-main"):"auto"==
this.settings.mode&&this.changeRoom("main");requestAnimationFrame(this.drawLoop.bind(this));this.needsClear=!1;document.addEventListener("keydown",function(b){b.target===document.body&&(27==b.keyCode&&(this.closeAccountWindow(),this.closeShareWindow(),this.closeRoomWindow(),this.closeSettingsWindow()),65==b.keyCode&&this.advancedOptions.toggleVisibility())}.bind(this));setInterval(this.displayTip.bind(this),3E5);setTimeout(this.autoMoveScreen.bind(this),0)}DrawTogether.prototype.KICKBAN_MIN_REP=50;
DrawTogether.prototype.MODERATORWELCOMEWINDOWOPENAFTER=12096E5;DrawTogether.prototype.BIG_BRUSH_MIN_REP=5;DrawTogether.prototype.ZOOMED_OUT_MIN_REP=2;DrawTogether.prototype.CLIENT_VERSION=3;DrawTogether.prototype.SOCKET_TIMEOUT=1E4;DrawTogether.prototype.TIME_BETWEEN_TIMEOUT_WARNINGS=5E3;DrawTogether.prototype.defaultSettings={mode:"ask",room:"main",leftTopX:0,leftTopY:0,loadbalancer:"http://direct.anondraw.com:3552",accountServer:"http://direct.anondraw.com:4552",imageServer:"http://direct.anondraw.com:5552"};
DrawTogether.prototype.defaultUserSettings=[{title:"Mute chat",type:"boolean",value:!1},{title:"Show tips",type:"boolean",value:!0},{title:"Show welcome",type:"boolean",value:!0}];DrawTogether.prototype.drawingTypes=["line","brush","block"];DrawTogether.prototype.drawingTypesByName={line:0,brush:1,block:2};
DrawTogether.prototype.drawLoop=function(){this.needsClear&&(this.userCtx.clearRect(0,0,this.userCtx.canvas.width,this.userCtx.canvas.height),this.needsClear=!1);for(var b=0;b<this.playerList.length;b++)this.playerList[b].lastPosition&&6E3>Date.now()-this.playerList[b].lastPosition.time&&(this.drawPlayerInteraction(this.playerList[b].name,this.playerList[b].lastPosition.pos),this.needsClear=!0);this.handleMoveQueue();requestAnimationFrame(this.drawLoop.bind(this))};
DrawTogether.prototype.handleMoveQueue=function(){if(0<this.moveQueue.length)if(Date.now()-this.lastScreenMove>=this.moveQueue[0].duration)this.lastScreenMove=Date.now(),this.lastScreenMoveStartPosition=this.moveQueue[0].position,this.paint.goto(this.moveQueue[0].position[0],this.moveQueue[0].position[1]),this.moveQueue.shift();else{var b=(Date.now()-this.lastScreenMove)/this.moveQueue[0].duration,b=[b*(this.moveQueue[0].position[0]-this.lastScreenMoveStartPosition[0]),b*(this.moveQueue[0].position[1]-
this.lastScreenMoveStartPosition[1])];this.paint.goto(b[0]+this.lastScreenMoveStartPosition[0],b[1]+this.lastScreenMoveStartPosition[1])}};
DrawTogether.prototype.autoMoveScreen=function(){if(this._forceFollow)this.moveScreenTo(this._forceFollow),this._followingPlayer=null;else if(this._autoMoveScreen){this._followingPlayer||(this._followingPlayer=this.getMaxViewScorePlayer(),this.lastViewDeduction=Date.now());for(var b=Date.now()-this.lastViewDeduction;0<this.playerList.length;){this.playerList[0].id==this._followingPlayer;this.playerList[0].viewScore-=b;break}this.lastViewDeduction+=b;this.moveScreenTo(this._followingPlayer);this._followingPlayer=
this.getMaxViewScorePlayer()}else this._followingPlayer=null;setTimeout(this.autoMoveScreen.bind(this),5E3)};
DrawTogether.prototype.moveScreenTo=function(b){var a=this.playerFromId(b);if(a&&a.lastPosition&&a.lastPosition.pos){b=[this.paint.public.canvas.width/this.paint.public.zoom,this.paint.public.canvas.height/this.paint.public.zoom];var a=[a.lastPosition.pos[0]-b[0]/2,a.lastPosition.pos[1]-b[1]/2],c=[a[0]-this.paint.public.leftTopX,a[1]-this.paint.public.leftTopY];Math.abs(c[0])<0.35*b[0]&&Math.abs(c[1])<0.35*b[1]||(Math.abs(c[0])<b[0]&&Math.abs(c[1])<b[1]?this.moveScreenToPosition(a,3500):(b=[a[0]-
0.15*c[0],a[1]-0.15*c[1]],this.moveScreenToPosition([this.paint.public.leftTopX+0.15*c[0],this.paint.public.leftTopY+0.15*c[1]],500),this.moveScreenToPosition(b,0),this.moveScreenToPosition(a,500)))}};
DrawTogether.prototype.moveScreenToPosition=function(b,a){this.lastScreenMoveStartPosition&&0!=this.moveQueue.length||(this.lastScreenMoveStartPosition=[this.paint.public.leftTopX,this.paint.public.leftTopY],this.lastScreenMove=Date.now());if(isNaN(a)||isNaN(b[0])||isNaN(b[1]))throw"Duration or position was not a number";this.moveQueue.push({position:b,duration:a});return!0};
DrawTogether.prototype.getMaxViewScorePlayer=function(){if(1>this.playerList.length)return null;for(var b=-Infinity,a=this.playerList[0].id,c=0;c<this.playerList.length;c++)this.playerList[c].viewScore>b&&(b=this.playerList[c].viewScore,a=this.playerList[c].id);return a};
DrawTogether.prototype.drawPlayerInteraction=function(b,a){this.userCtx.font="12px monospace";this.userCtx.lineWidth=3;this.userCtx.strokeStyle="black";this.userCtx.strokeText(b,(a[0]-this.userCtx.canvas.leftTopX)*this.paint.public.zoom,(a[1]-this.userCtx.canvas.leftTopY)*this.paint.public.zoom-40);this.userCtx.fillStyle="white";this.userCtx.fillText(b,(a[0]-this.userCtx.canvas.leftTopX)*this.paint.public.zoom,(a[1]-this.userCtx.canvas.leftTopY)*this.paint.public.zoom-40)};
DrawTogether.prototype.bindSocketHandlers=function(){var b=this;this.network.on("connect",function(){localStorage.getItem("drawtogether-name")&&b.changeName(localStorage.getItem("drawtogether-name"));b.account.uKey&&b.network.socket.emit("uKey",b.account.uKey)});this.network.on("disconnect",function(){if(b.current_room){var a=b.current_room;delete b.current_room;b.changeRoom(a,void 0,0,0,!0)}});this.network.on("initname",function(a){localStorage.getItem("drawtogether-name")||b.setName(a)});this.network.on("finalize",
function(a){b.paint.finalizeAll(a)});this.network.on("clear",function(){b.paint.clear()});this.network.on("drawing",function(a){var c=b.decodeDrawings([a.drawing])[0];b.paint.addPublicDrawing(c);b.setPlayerPosition(a.socketid,[c.x,c.y],Date.now())});this.network.on("sp",function(a){a.color=tinycolor(a.color);b.paint.addPath(a.id,a)});this.network.on("ep",function(a){b.paint.finalizePath(a)});this.network.on("pp",function(a,c){b.paint.addPathPoint(a,c);b.setPlayerPosition(a,c,Date.now())});this.network.on("paths",
function(a){for(var c in a)b.paint.addPath(c,a[c])});this.network.on("playernamechange",function(a){for(var c=0;c<b.playerList.length;c++)b.playerList[c].id==a.id&&(b.playerList[c].name=a.newname);b.updatePlayerList()});this.network.on("playerlist",function(a){b.playerList=a;b.updatePlayerList()});this.network.on("leave",function(a){for(var c=0;c<b.playerList.length;c++)b.playerList[c].id==a.id&&(b.chat.addElementAsMessage(b.createPlayerLeftDom(b.playerList[c])),b.playerList.splice(c,1),c--);b.updatePlayerList()});
this.network.on("join",function(a){for(var c=0;c<b.playerList.length;c++)if(b.playerList[c].id==a.id)return;b.playerList.push(a);b.updatePlayerList()});this.network.on("undodrawings",function(a,c){b.paint.undodrawings(a,c)});this.network.on("reputation",function(a){for(var c=0;c<b.playerList.length;c++)b.playerList[c].id==a.id&&(b.playerList[c].reputation=a.reputation);b.updatePlayerList()});this.network.on("generalmessage",function(a){b.displayMessage(a)});this.network.on("gamestatus",function(a){b.chat.addMessage("GAME",
b.usernameFromSocketid(a.currentPlayer)+" is now drawing. You have "+Math.round(a.timeLeft/1E3)+" seconds left.");0==a.letters?b.chat.addMessage("GAME",b.usernameFromSocketid(a.currentPlayer)+" is picking a word."):(b.chat.addMessage("GAME","The word: "+Array(a.letters+1).join("_ ")+"("+a.letters+" letters)"),b.displayMessage("The word: "+Array(a.letters+1).join("_ ")+"("+a.letters+" letters)"));for(var c=0;c<b.playerList.length;c++)b.playerList[c].currentPlayer=b.playerList[c].id==a.currentPlayer?
!0:!1;b.updatePlayerList()});this.network.on("words",function(a){var c=b.gui.prompt("It is your turn! Pick a word to draw. You have 10 seconds.",a,function(a){b.network.socket.emit("word",a)});setTimeout(function(){c.parentNode&&c.parentNode.removeChild(c)},1E4)});this.network.on("gameword",function(a){b.displayMessage("You picked "+a);b.chat.addMessage("GAME","You picked "+a);b.weAreCurrentPlayer=!0});this.network.on("endturn",function(){b.weAreCurrentPlayer=!1});this.network.on("chatmessage",function(a){a=
a||{};b.chat.addMessage(a.user,a.message)});this.network.on("emote",function(a){a=a||{};b.chat.addMessage(a.user+" "+a.message)});this.network.on("setmemberlevel",function(a){b.memberlevel=a;console.log("We have memberlevel ",a);0<b.memberlevel&&!localStorage.getItem("buyreported")&&(goog_report_buy(),ga("send","event","conversion","buypremium"),localStorage.setItem("buyreported",!0))});this.network.on("setreputation",function(a){b.reputation=a;console.log("Our reputation is ",a);b.reputation>=b.KICKBAN_MIN_REP&&
((a=localStorage.getItem("moderatorwelcomewindowlastopen"))?(a=parseInt(a),a+b.MODERATORWELCOMEWINDOWOPENAFTER<Date.now()&&drawTogether.openModeratorWelcomeWindow()):drawTogether.openModeratorWelcomeWindow());drawTogether.getFavorites()});this.network.on("setink",function(a){b.ink=a;b.updateInk()})};DrawTogether.prototype.sendMessage=function(b){this.network.socket.emit("chatmessage",b)};
DrawTogether.prototype.displayMessage=function(b,a){this.messageDom.style.display="block";this.messageDom.innerText=b;this.messageDom.textContent=b;clearTimeout(this.removeMessageTimeout);this.removeMessageTimeout=setTimeout(function(){this.messageDom.style.display=""}.bind(this),a||Math.max(1E3*Math.ceil(b.length/10),3E3))};
DrawTogether.prototype.displayTip=function(){if(this.userSettings.getBoolean("Show tips")){var b="Did you know you can use shortcuts? Press C to toggle the color selection!;Tip: use B to switch to the brush tool. (Others: [l]ine, [c]olor, [p]icker, [g]rab, ...);Tip: You get ink faster if you register an account and get reputation!;Did you know? You can easily upload your drawing to imgur, you can also share it to reddit!;Did you know? Private rooms always start with private_;Did you know? There is a member only room where only people with enough reputation can draw.;Tip: If you type Nyan with a capital, a cat will appear.;Tip: If you write Kappa with a capital you will get the twitch emote.;Tip: There are a few commands, try typing /me or /help;Need more ink? Try creating an account.;Want to be shown on the frontpage? If you share to reddit it will get added automatically.;Tip: Use transparency to get nicer effects.;The \u25b2 next to peoples name is the upvote button.;Did you know you can ban people once you have 50+ rep?;Got feedback? There is a button at the left where you can leave it!;Try some shortcuts: C, L, B, P, G;If you click on someones name you will jump to their last draw position!;Pressing the eye next to someones name will make your screen follow the player.".split(";");this.displayMessage(b[Math.floor(Math.random()*
b.length)])}};
DrawTogether.prototype.changeRoom=function(b,a,c,e,d,f){b===this.current_room?this.chat.addMessage("CLIENT","You are already in room '"+b+"'"):this.changingRoom||(this.changingRoom=!0,setTimeout(function(){this.changingRoom=!1}.bind(this),2E3),a=a||"",this.network.loadRoom(b+a,d,f,function(g,h){this.changingRoom=!1;g&&-1!==g.indexOf("Too many users")?(this.chat.addMessage("Room '"+b+a+"' is full! Trying "+b+((a||0)+1)),this.changeRoom(b,(a||0)+1,c,e)):g?(this.chat.addMessage("Failed to load room '"+b+
"'. Server error: "+g+". Trying again in 5 seconds."),setTimeout(this.changeRoom.bind(this,b,a,c,e,d,f),5E3)):(this.setRoom(b+a),this.paint.clear(),this.paint.goto(c||0,e||0),this.paint.changeTool("grab"),this.paint.addPublicDrawings(this.decodeDrawings(h)),this.chat.addMessage("Invite people","http://www.anondraw.com/#"+b+a),this.userSettings.getBoolean("Show welcome")?this.openWelcomeWindow():parseInt(localStorage.getItem("newfeaturewindowversion"))!==this.CLIENT_VERSION&&this.openNewFeatureWindow(),
this.removeLoading())}.bind(this)),this.setLoading(b))};
DrawTogether.prototype.joinGame=function(){ga("send","event","modeselector","publicgame");this.network.joinGame("Uberlord"==this.controls.byName.name.input.value,function(b,a,c){b&&-1!==b.indexOf("Too many users")?(this.chat.addMessage("Couldn't join gameroom, too many users."),this.gui.prompt("With whom would you like to play?",["Join strangers","Create private room","Cancel"],function(b){"Cancel"==b?this.openModeSelector():"Join strangers"==b?this.joinGame():"Create private room"==b&&this.createPrivateGame()}.bind(this))):
b?(this.chat.addMessage("Failed to join game. Trying again in 5 seconds. Error: "+b),setTimeout(this.joinGame.bind(this),5E3)):(this.setRoom(a),this.paint.clear(),this.paint.drawDrawings("public",this.decodeDrawings(c)),this.chat.addMessage("Welcome to anondraw, enjoy your game!"),this.chat.addMessage("Invite friends:","http://www.anondraw.com/#"+a),this.removeLoading())}.bind(this));this.setLoading("game");this.chat.addMessage("Looking for game to join ...")};
DrawTogether.prototype.createPrivateGame=function(){ga("send","event","modeselector","newprivategame");this.changeRoom("private_game_"+Math.random().toString(36).substr(2,5))};DrawTogether.prototype.setLoading=function(b){this.loading||(this.loading=this.paintContainer.appendChild(document.createElement("div")),this.loading.innerText="Loading room '"+b+"' ...",this.loading.textContent="Loading room '"+b+"' ...",this.loading.className="drawtogether-loading")};
DrawTogether.prototype.removeLoading=function(){this.loading&&(this.loading.parentNode.removeChild(this.loading),delete this.loading)};DrawTogether.prototype.changeName=function(b){b||(b=this.controls.byName.name.input.value,this.controls.byName.name.input.focus());this.network.socket.emit("changename",b,function(b,c){b?this.chat.addMessage("SERVER",b):localStorage.setItem("drawtogether-name",c)}.bind(this))};
DrawTogether.prototype.changeNameDelayed=function(){clearTimeout(this.changeNameTimeout);this.changeNameTimeout=setTimeout(this.changeName.bind(this),750)};
DrawTogether.prototype.updatePlayerList=function(){for(;this.playerListDom.firstChild;)this.playerListDom.removeChild(this.playerListDom.firstChild);var b=this.playerListDom.appendChild(document.createElement("span"));b.innerText="PlayerList ("+this.playerList.length+")";b.textContent="PlayerList ("+this.playerList.length+")";b.className="drawtogether-pl-title";for(b=0;b<this.playerList.length;b++)this.playerListDom.appendChild(this.createPlayerDom(this.playerList[b]))};
DrawTogether.prototype.setPlayerPosition=function(b,a,c){for(var e=0;e<this.playerList.length;e++)this.playerList[e].id==b&&(this.playerList[e].lastPosition=this.playerList[e].lastPosition||{},this.playerList[e].viewScore=this.playerList[e].viewScore||0,this.playerList[e].lastPosition.pos=a,this.playerList[e].lastPosition.time=c,this.playerList[e].viewScore+=100)};
DrawTogether.prototype.updateInk=function(){for(;this.inkDom.firstChild;)this.inkDom.removeChild(this.inkDom.firstChild);this.inkDom.appendChild(document.createTextNode("Ink: "+Math.floor(this.ink)+"/200000"));var b=Math.floor(Math.max(this.ink/2E3,0));this.lastInkWidth&&this.lastInkWidth===b||(this.inkDom.style.width=b+"%",this.lastInkWidth=b);3E3<=this.previousInk&&3E3>this.ink?(this.inkDom.classList.add("drawtogether-ink-low"),this.inkDom.classList.remove("drawtogether-ink-middle")):8E3<=this.previousInk&&
8E3>this.ink?(this.inkDom.classList.add("drawtogether-ink-middle"),this.inkDom.classList.remove("drawtogether-ink-low")):8E3>this.previousInk&&8E3<=this.ink&&(this.inkDom.classList.remove("drawtogether-ink-middle"),this.inkDom.classList.remove("drawtogether-ink-low"));this.previousInk=this.ink};DrawTogether.prototype.sendDrawing=function(b,a){this.network.socket&&this.network.socket.emit("drawing",this.encodeDrawing(b),a)};
DrawTogether.prototype.encodeDrawing=function(b){var a={},c;for(c in b)a[c]=b[c];a.color=b.color.toHex8();return a};DrawTogether.prototype.decodeDrawings=function(b){for(var a=0;a<b.length;a++)b[a].color=tinycolor(b[a].color);return b};DrawTogether.prototype.setName=function(b){this.controls.byName.name.input.value=b;this.chat.addMessage("SERVER","Name set to '"+b+"'");localStorage.setItem("drawtogether-name",b)};
DrawTogether.prototype.setRoom=function(b){this.current_room=b;this.roomInput.value=b;location.hash=b+","+this.paint.public.leftTopX.toFixed()+","+this.paint.public.leftTopY.toFixed();this.getFavorites()};DrawTogether.prototype.openSettingsWindow=function(){this.settingsWindow.style.display="block";ga("send","event","openwindow","settings")};
DrawTogether.prototype.openShareWindow=function(){this.shareWindow.style.display="block";ga("send","event","openwindow","share");this.preview.width=0.9*this.shareWindow.offsetWidth;this.preview.height=this.preview.width*(this.paint.public.canvas.height/this.paint.public.canvas.width);var b=this.preview.getContext("2d");b.drawImage(this.paint.background.canvas,0,0,this.preview.width,this.preview.height);b.drawImage(this.paint.public.canvas,0,0,this.preview.width,this.preview.height)};
DrawTogether.prototype.openRoomWindow=function(){this.roomWindow.style.display="block";ga("send","event","openwindow","rooms");this.network.getRooms(function(b,a){for(;this.publicRoomsContainer.firstChild;)this.publicRoomsContainer.removeChild(this.publicRoomsContainer.firstChild);for(var c=Object.keys(a).sort(),e=0;e<c.length;e++){var d=c[e],f=this.publicRoomsContainer.appendChild(document.createElement("div"));f.className="drawtogether-button drawtogether-room-button";f.appendChild(document.createTextNode(d+
" ("+a[d]+" users)"));f.addEventListener("click",function(b,a){this.changeRoom(b,void 0,0,0,!0);this.closeRoomWindow()}.bind(this,d))}}.bind(this))};DrawTogether.prototype.openAccountWindow=function(){this.accWindow.style.display="block";ga("send","event","openwindow","account")};DrawTogether.prototype.openModeSelector=function(){this.selectWindow.style.display="block"};DrawTogether.prototype.closeSettingsWindow=function(){this.settingsWindow.style.display=""};
DrawTogether.prototype.closeShareWindow=function(){this.shareWindow.style.display=""};DrawTogether.prototype.closeAccountWindow=function(){this.accWindow.style.display=""};DrawTogether.prototype.closeRoomWindow=function(){this.roomWindow.style.display=""};
DrawTogether.prototype.initDom=function(){this.createChat();this.createRoomInformation();this.createDrawZone();this.createControls();this.createMessage();this.createShareWindow();this.createAccountWindow();this.createRoomWindow();this.createModeSelector();this.createSettingsWindow()};DrawTogether.prototype.usernameFromSocketid=function(b){for(var a=0;a<this.playerList.length;a++)if(this.playerList[a].id==b)return this.playerList[a].name;return"[Not found]"};
DrawTogether.prototype.playerFromId=function(b){for(var a=0;a<this.playerList.length;a++)if(this.playerList[a].id==b)return this.playerList[a];return null};
DrawTogether.prototype.createPlayerLeftDom=function(b){var a=document.createElement("div");a.className="drawtogether-player";if(this.reputation>=this.KICKBAN_MIN_REP){var c=document.createElement("span");c.className="drawtogether-player-button drawtogether-kickban-button";c.innerText="B";c.textContent="B";c.addEventListener("click",this.kickban.bind(this,b.id));a.appendChild(c)}c=document.createElement("span");c.className="drawtogether-player-button drawtogether-upvote-button";c.appendChild(document.createTextNode("\u25b2"));
c.addEventListener("click",function(b,a){this.network.socket.emit("upvote",b)}.bind(this,b.id));var e=document.createElement("span");e.className="drawtogether-player-name";var d="",f="";"undefined"!==typeof b.reputation&&(d=" ("+b.reputation+" R)");"undefined"!==typeof b.gamescore&&(f=" ["+b.gamescore+" Points]");e.appendChild(document.createTextNode(b.name+d+f+" has left."));a.appendChild(c);a.appendChild(e);return a};
DrawTogether.prototype.createPlayerDom=function(b){var a=document.createElement("div");a.className="drawtogether-player "+(b.currentPlayer?"currentplayer":"");a.setAttribute("data-snap-ignore","true");a.addEventListener("click",function(b,a){this.moveQueue.length=0;this.moveScreenTo(b)}.bind(this,b.id));var c=a.appendChild(document.createElement("span"));c.className="drawtogether-player-button drawtogether-follow-button";b.id==this._forceFollow&&c.classList.add("drawtogether-activated");c.appendChild(document.createElement("img")).src=
"images/icons/eye.png";c.addEventListener("click",function(b,a){this.moveQueue.length=0;this._forceFollow=this._forceFollow==b?null:b;this.updatePlayerList()}.bind(this,b.id));c=document.createElement("span");c.className="drawtogether-player-button drawtogether-upvote-button";c.appendChild(document.createTextNode("\u25b2"));c.addEventListener("click",function(b,a){this.network.socket.emit("upvote",b)}.bind(this,b.id));if(this.reputation>=this.KICKBAN_MIN_REP){var e=document.createElement("span");
e.className="drawtogether-player-button drawtogether-kickban-button";e.innerText="B";e.textContent="B";e.addEventListener("click",this.kickban.bind(this,b.id));a.appendChild(e)}var d=document.createElement("span");d.className="drawtogether-player-name";var f="",g="",h="",e="";"undefined"!==typeof b.reputation&&(f=" ("+b.reputation+" R)");"undefined"!==typeof b.gamescore&&(g=" ["+b.gamescore+" Points]");b.currentPlayer&&(h=" | DRAWING");1==b.memberlevel&&(e+="\u2665",d.className+=" premium");d.appendChild(document.createTextNode(b.name+
f+g+h));a.appendChild(c);a.appendChild(d);b=document.createElement("span");b.appendChild(document.createTextNode(e));b.className="icons";a.appendChild(b);return a};
DrawTogether.prototype.kickban=function(b){this.gui.prompt("How long do you want to kickban this person for? (minutes)","freepick;10 year;1 year;1 month;1 week;1 day;1 hour;5 minutes;1 minute;Cancel".split(";"),function(a){"Cancel"!=a&&("10 year"==a&&(a=5126400),"1 year"==a&&(a=512640),"1 month"==a&&(a=43200),"1 week"==a&&(a=10080),"1 day"==a&&(a=1440),"1 hour"==a&&(a=60),"5 minutes"==a&&(a=5),"1 minute"==a&&(a=1),this.gui.prompt("Should we ban the account, the ip or both?",["account","ip","both",
"Cancel"],function(c){"Cancel"!=c&&this.gui.prompt("What is the reason you want to ban him?","freepick;Drawings swastikas;Destroying drawings;Being a dick in chat;Spam;Cancel".split(";"),function(e){"Cancel"!=e&&this.gui.prompt("Are you sure you want to ban "+this.usernameFromSocketid(b)+" (bantype: "+c+") for "+a+" minutes. Reason: "+e,["Yes","No"],function(d){"Yes"==d&&this.network.socket.emit("kickban",[b,a,c,e],function(b){this.chat.addMessage("SERVER",b.error||b.success)}.bind(this))}.bind(this))}.bind(this))}.bind(this)))}.bind(this))};
DrawTogether.prototype.createChat=function(){var b=this.container.appendChild(document.createElement("div"));b.className="drawtogether-chat-container";this.chat=new Chat(b,this.sendMessage.bind(this),this.userSettings);this.chatContainer=b;this.chat.addMessage("Welcome to anondraw, the free interactive group drawing app.");new Snap({element:b,disable:"left",minPosition:-275,maxPosition:0,slideIntent:40})};
DrawTogether.prototype.setLoadImage=function(b){b=b||5E3;var a=new Image;a.onload=function(){this.paint.background.loadingImage=a}.bind(this);a.onerror=function(){setTimeout(this.setLoadImage.bind(this,2*b),2*b)}.bind(this);a.src="images/loadingChunk.png?v=1"};
DrawTogether.prototype.createDrawZone=function(){var b=this.container.appendChild(document.createElement("div"));b.className="drawtogether-paint-container";this.paintContainer=b;this.paint=new Paint(b);this.userCtx=this.paint.newCanvasOnTop("userinteraction").getContext("2d");this.setLoadImage();this.paint.background.requestUserChunk=function(b,a,c,g){var h=new Image;g=g||0;g+=5E3*Math.random()+2500;h.onload=function(b){c(h)};h.onerror=function(h){console.error("Failed to load chunk ",b,a," retrying in "+
Math.round(g/1E3)+" seconds");setTimeout(function(){this.paint.background.requestUserChunk(b,a,c,g)}.bind(this),g)}.bind(this);var k=encodeURIComponent(this.current_room);b=encodeURIComponent(b);a=encodeURIComponent(a);h.crossOrigin="Anonymous";this.current_room?h.src=this.settings.imageServer+"/chunk?room="+k+"&x="+b+"&y="+a+"&t="+(this.lastImageUpdate||Date.now()):c(h)}.bind(this);this.paint.addEventListener("userdrawing",function(b){if(0!==this.current_room.indexOf("game_")&&0!==this.current_room.indexOf("private_game_")||
this.weAreCurrentPlayer){if(0!==this.current_room.indexOf("private_")&&0!==this.current_room.indexOf("game_")){if(!(this.reputation>=this.BIG_BRUSH_MIN_REP)&&(10<b.drawing.size&&"undefined"==typeof b.drawing.text||20<b.drawing.size)){5E3<Date.now()-this.lastBrushSizeWarning&&(this.chat.addMessage("Brush sizes above 10 and text sizes above 20 require an account with "+this.BIG_BRUSH_MIN_REP+" reputation! Registering is free and easy. You don't even need to confirm your email!"),this.lastBrushSizeWarning=
Date.now());b.removeDrawing();return}var a=this.inkUsageFromDrawing(b.drawing);if(this.ink<a){5E3<Date.now()-this.lastInkWarning&&(this.chat.addMessage("Not enough ink! You will regain ink every few seconds."),this.chat.addMessage("Tip: Small brushes use less ink."),this.chat.addMessage("Tip: logged in users receive more ink"),this.lastInkWarning=Date.now());b.removeDrawing();return}if(this.reputation<this.ZOOMED_OUT_MIN_REP&&1>this.paint.public.zoom){5E3<Date.now()-this.lastZoomWarning&&this.chat.addMessage("Drawing while zoomed out this far is only allowed if you have more than "+
this.ZOOMED_OUT_MIN_REP+" reputation.");this.lastZoomWarning=Date.now();b.removeDrawing();return}this.ink-=a;this.updateInk()}this.sendDrawing(b.drawing,function(){b.removeDrawing()})}else this.displayMessage("Not your turn!"),b.removeDrawing()}.bind(this));this.paint.addEventListener("undo",function(b){this.network.socket.emit("undo")}.bind(this));this.paint.addEventListener("startuserpath",function(b){this.network.socket.emit("sp",b.props.color.toHex8(),b.props.size);this.lastPathSize=b.props.size}.bind(this));
this.paint.addEventListener("enduserpath",function(b){this.network.socket.emit("ep",function(a){b.removePath(!0,a)})}.bind(this));this.paint.addEventListener("userpathpoint",this.handlePaintUserPathPoint.bind(this));this.paint.addEventListener("select",this.handlePaintSelection.bind(this));var a,c=function(){location.hash=this.current_room+","+this.paint.public.leftTopX.toFixed()+","+this.paint.public.leftTopY.toFixed()}.bind(this);this.paint.addEventListener("move",function(b){clearTimeout(a);a=
setTimeout(c,100)});this.paint.changeTool("grab")};
DrawTogether.prototype.handlePaintUserPathPoint=function(b){if(0!==this.current_room.indexOf("game_")&&0!==this.current_room.indexOf("private_game_")||this.weAreCurrentPlayer){if(0!==this.current_room.indexOf("private_")&&0!==this.current_room.indexOf("game_")){if(!(this.reputation>=this.BIG_BRUSH_MIN_REP)&&10<this.lastPathSize){5E3<Date.now()-this.lastBrushSizeWarning&&(this.chat.addMessage("Brush sizes above 10 and text sizes above 20 require an account with "+this.BIG_BRUSH_MIN_REP+" reputation! Registering is free and easy. You don't even need to confirm your email!"),
this.lastBrushSizeWarning=Date.now());b.removePathPoint();return}var a=this.inkUsageFromPath(b.point,this.lastPathPoint,this.lastPathSize);if(this.ink<a){2E4<Date.now()-this.lastInkWarning&&(this.chat.addMessage("CLIENT","Not enough ink! You will regain ink every 20 seconds."),this.chat.addMessage("CLIENT","Tip: Small brushes use less ink."),this.chat.addMessage("CLIENT","Tip: logged in users receive more ink"),this.lastInkWarning=Date.now());b.removePathPoint();return}if(this.reputation<this.ZOOMED_OUT_MIN_REP&&
1>this.paint.public.zoom){5E3<Date.now()-this.lastZoomWarning&&(this.chat.addMessage("Drawing while zoomed out this far is only allowed if you have more than "+this.ZOOMED_OUT_MIN_REP+" reputation."),this.lastZoomWarning=Date.now());b.removePathPoint();return}this.ink-=a;this.updateInk()}this.network.socket.emit("pp",b.point,timeoutCallback(function(a,e){if(!a&&(b.removePathPoint(),"undefined"!==typeof e&&e)){var d=Date.now();d-this.lastTimeoutError>this.TIME_BETWEEN_TIMEOUT_WARNINGS&&(this.chat.addMessage("The server took longer than "+
Math.round(this.SOCKET_TIMEOUT/1E3)+" seconds to respond. You should probably refresh your page."),this.lastTimeoutError=d)}},this.SOCKET_TIMEOUT,this,[!1,!0]));this.lastPathPoint=b.point}else this.displayMessage("Not your turn!"),b.removePathPoint()};
DrawTogether.prototype.handlePaintSelection=function(b){this.gui.prompt("What do you want to do with your selection?",["Export in high quality","Create protected region","Cancel"],function(a){if("Cancel"!==a)({"Export in high quality":this.exportImage.bind(this),"Create protected region":this.createProtectedRegion.bind(this)})[a](b.from,b.to)}.bind(this))};
DrawTogether.prototype.setCoordFavorite=function(b,a,c,e,d,f){this.network.socket.emit("setcoordfavorite",b,a,c,e,d,function(c,d){c?this.chat.addMessage("Changing coordinate of Favorite","Error: "+c):d.success&&(console.log("changed cord"),this.paint.updateIndividualFavoriteDom(b,a,null,null,f),this.getFavorites())}.bind(this))};
DrawTogether.prototype.removeFavorite=function(b,a,c,e){this.network.socket.emit("removefavorite",b,a,c,function(b,a){b?this.chat.addMessage("Removing Favorite","Error: "+b):a.success&&(console.log("deleted"),e.remove(),this.getFavorites())}.bind(this))};DrawTogether.prototype.renameFavorite=function(b,a,c,e){this.network.socket.emit("renamefavorite",b,a,c,function(b,a){b?this.chat.addMessage("Renaming Favorite","Error: "+b):a.success&&(this.paint.updateIndividualFavoriteDom(null,null,c,null,e),this.getFavorites())}.bind(this))};
DrawTogether.prototype.updateFavoriteDom=function(){this.paint.updateFavoriteDom(this.favList)};DrawTogether.prototype.getFavorites=function(){this.network.socket.emit("getfavorites",function(b,a){b?this.chat.addMessage("Getting Favorites","Error: "+b):this.favList=a}.bind(this))};
DrawTogether.prototype.createFavorite=function(b,a,c){null===drawTogether.account.mail?this.chat.addMessage("You must login to save or create favorites!"):!this.memberlevel&&5<=this.favList.length?this.chat.addMessage("Creating favorites past 5 is limited to Premium Users."):this.network.socket.emit("createfavorite",b,a,c,function(b,a){b?this.chat.addMessage("Favorite","Error: "+b):a.success&&(this.chat.addMessage("Favorite added",a.success),this.paint.insertOneFavorite(0,0,"",a.owner),this.getFavorites())}.bind(this))};
DrawTogether.prototype.createProtectedRegion=function(b,a){this.memberlevel?this.network.socket.emit("createprotectedregion",b,a,function(b,a){b?this.chat.addMessage("Regions","Error: "+b):a.success&&this.chat.addMessage("Regions",a.success)}.bind(this)):this.chat.addMessage("Creating a protected region is a member only feature.")};
DrawTogether.prototype.resetProtectedRegions=function(){this.network.socket.emit("resetprotectedregions",function(b,a){b?this.chat.addMessage("Regions","Reset Error: "+b):this.chat.addMessage("Regions","Reset your regions")}.bind(this))};DrawTogether.prototype.exportImage=function(b,a){var c=document.createElement("img");c.src=this.paint.exportImage(b,a);c.alt="Exported image";var e=this.gui.createWindow({title:"Exported image (right click to save)"});e.classList.add("exportwindow");e.appendChild(c)};
DrawTogether.prototype.createMessage=function(){this.messageDom=this.container.appendChild(document.createElement("div"));this.messageDom.className="drawtogether-general-message"};DrawTogether.prototype.inkUsageFromPath=function(b,a,c){b=c+(a?this.utils.distance(b[0],b[1],a[0],a[1]):0);return Math.ceil(c*b/25)};
DrawTogether.prototype.inkUsageFromDrawing=function(b){var a=b.size;"number"==typeof b.x1&&(a=2*this.utils.distance(b.x,b.y,b.x1,b.y1));"string"==typeof b.text&&(a*=b.text.length);return Math.ceil(b.size*a/25)};
DrawTogether.prototype.createRoomInformation=function(){var b=this.container.appendChild(document.createElement("div"));b.className="drawtogether-info-container";this.infoContainer=b;var a=b.appendChild(document.createElement("div"));a.className="drawtogether-ink-container";a.setAttribute("data-intro","Here you can see how much ink you have left. Drawing uses ink and once you hit 0 you can no longer draw.");this.inkDom=a.appendChild(document.createElement("div"));this.inkDom.className="drawtogether-ink";
this.playerListDom=b.appendChild(document.createElement("div"));this.playerListDom.className="drawtogether-info-playerlist";this.playerListDom.setAttribute("data-intro","Here is a list of people currently in the room. If you want to watch them you can click their name. The eye icon can be used as a stalker mode.");new Snap({element:b,disable:"left",minPosition:-275,maxPosition:0,slideIntent:40})};
DrawTogether.prototype.createGameInformation=function(){var b=this.container.appendChild(document.createElement("div"));b.className="drawtogether-gameinfo-container";this.gameInfoContainer=b};
DrawTogether.prototype.createSettingsWindow=function(){this.settingsWindow&&this.settingsWindow.parentNode.removeChild(this.settingsWindow);var b=this.container.appendChild(document.createElement("div"));b.className="drawtogether-window drawtogether-settingswindow";this.settingsWindow=b;b=b.appendChild(document.createElement("div"));b.className="drawtogether-settingswindow-container";for(var a=0;a<this.defaultUserSettings.length;a++)this.userSettings.addControl(this.defaultUserSettings[a]);var c=
QuickSettings.create(30,10,"Advanced options");c.hide();this.advancedOptions=c;c.addInfo("Tip 1:","Press ESC to undo anything out of this menu.");c.addInfo("Tip 2:","U can also use the keys mentioned between the ( and ).");c.addRange("Rotation (e and r)",-180,180,0,1,function(b){this.paint.setRotation(b)}.bind(this));c.addBoolean("Flip horizontal (m)",!1,function(b){this.paint.setHorizontalMirror(b)}.bind(this));c.addBoolean("Flip vertical (k)",!1,function(b){this.paint.setVerticalMirror(b)}.bind(this));
c.addButton("Close (a)",function(){c.hide()});this.paint.addEventListener("canvaschange",function(b){var a=b.rotation;180<b.rotation&&(a=-360+b.rotation);c.setRangeValue("Rotation (r)",a,!1);c.setBoolean("Flip horizontal (m)",-1==b.scale[0],!1);c.setBoolean("Flip vertical (k)",-1==b.scale[1],!1)});b.appendChild(this.userSettings._panel);a=b.appendChild(document.createElement("div"));a.appendChild(document.createTextNode("Open advanced settings (a)"));a.className="drawtogether-button";a.addEventListener("click",
function(){this.closeSettingsWindow();c.show()}.bind(this));b=b.appendChild(document.createElement("div"));b.appendChild(document.createTextNode("Close settings window"));b.className="drawtogether-button drawtogether-close-button";b.addEventListener("click",this.closeSettingsWindow.bind(this))};
DrawTogether.prototype.createAccountWindow=function(){this.accWindow&&this.accWindow.parentNode.removeChild(this.accWindow);var b=this.container.appendChild(document.createElement("div"));b.className="drawtogether-window drawtogether-accountwindow";this.accWindow=b;this.accWindow.appendChild(document.createTextNode("Loading session data ..."));this.account.checkLogin(function(a,c){var e=b.appendChild(document.createElement("div"));e.className="drawtogether-account-formcontainer";this.loginMessage=
e.appendChild(document.createElement("div"));this.account.mail&&this.accountSuccess("Logged in as "+this.account.mail);a&&this.accountError("Error getting session state: "+a);if(c){var d=e.appendChild(document.createElement("div"));d.appendChild(document.createTextNode("Reset protected regions"));d.className="drawtogether-button";d.addEventListener("click",function(){this.resetProtectedRegions()}.bind(this));d=e.appendChild(document.createElement("div"));d.appendChild(document.createTextNode("Premium"));
d.className="drawtogether-button";d.addEventListener("click",function(){this.closeAccountWindow();this.openPremiumBuyWindow()}.bind(this));d=e.appendChild(document.createElement("div"));d.appendChild(document.createTextNode("Logout"));d.className="drawtogether-button drawtogether-logout-button";d.addEventListener("click",function(){this.account.logout(function(b){b?this.accountError("Couldn't logout: "+b):(this.createAccountWindow(),this.network.socket.emit("uKey",this.account.uKey))}.bind(this))}.bind(this))}else d=
e.appendChild(document.createElement("input")),d.type="email",d.placeholder="email@example.com",this.emailInput=d,d=e.appendChild(document.createElement("input")),d.type="password",d.placeholder="*********",this.passInput=d,this.emailInput.addEventListener("keydown",function(b){13==b.keyCode&&this.formLogin()}.bind(this)),this.passInput.addEventListener("keydown",function(b){13==b.keyCode&&this.formLogin()}.bind(this)),d=e.appendChild(document.createElement("div")),d.appendChild(document.createTextNode("Login")),
d.className="drawtogether-button drawtogether-login-button",d.addEventListener("click",this.formLogin.bind(this)),d=e.appendChild(document.createElement("div")),d.appendChild(document.createTextNode("Register")),d.className="drawtogether-button drawtogether-register-button",d.addEventListener("click",this.formRegister.bind(this));e=e.appendChild(document.createElement("div"));e.appendChild(document.createTextNode("Close account window"));e.className="drawtogether-button drawtogether-close-button";
e.addEventListener("click",this.closeAccountWindow.bind(this))}.bind(this))};
DrawTogether.prototype.createRoomWindow=function(){this.roomWindow=this.container.appendChild(document.createElement("div"));this.roomWindow.className="drawtogether-window drawtogether-roomwindow";var b=this.roomWindow.appendChild(document.createElement("div"));b.className="drawtogether-roomwindow-content";var a=b.appendChild(document.createElement("div"));a.appendChild(document.createTextNode("Public group rooms:"));a.className="drawtogether-room-text";this.publicRoomsContainer=b.appendChild(document.createElement("div"));
this.publicRoomsContainer.className="drawtogether-publicroomscontainer";a=b.appendChild(document.createElement("div"));a.appendChild(document.createTextNode("Manual room:"));a.className="drawtogether-room-text";this.roomInput=b.appendChild(document.createElement("input"));this.roomInput.type="text";this.roomInput.placeholder="Room name";a=b.appendChild(document.createElement("div"));a.appendChild(document.createTextNode("Create public room"));a.className="drawtogether-button";a.addEventListener("click",
function(b){this.roomInput.value==this.current_room?this.changeRoom("main",void 0,0,0,!0,"Uberlord"==this.controls.byName.name.input.value):this.changeRoom(this.roomInput.value);this.closeRoomWindow()}.bind(this));a=b.appendChild(document.createElement("div"));a.appendChild(document.createTextNode("Create private room"));a.className="drawtogether-button create-private-room";a.addEventListener("click",function(b){this.changeRoom("private_"+Math.random().toString(36).substr(2,5),void 0,0,0,!0);this.closeRoomWindow()}.bind(this));
b=b.appendChild(document.createElement("div"));b.appendChild(document.createTextNode("Close room window"));b.className="drawtogether-button drawtogether-close-button";b.addEventListener("click",this.closeRoomWindow.bind(this))};
DrawTogether.prototype.createControls=function(){var b=this.container.appendChild(document.createElement("div"));b.className="drawtogether-control-container";this.controls=new Controls(b,this.createControlArray());b.appendChild(document.createElement("div")).className="addthis_sharing_toolbox";for(var a in this.controls.byName)this.controls.byName[a].input.setAttribute("data-snap-ignore","true");new Snap({element:b,disable:"right",minPosition:0,maxPosition:275,slideIntent:40})};
DrawTogether.prototype.formLogin=function(){var b=this.emailInput.value,a=this.passInput.value;this.accountError(void 0);this.account.login(b,a,function(b){b?this.accountError("Couldn't login: "+b):(this.network.socket.emit("uKey",this.account.uKey),this.createAccountWindow())}.bind(this))};
DrawTogether.prototype.formRegister=function(){var b=this.emailInput.value,a=this.passInput.value;this.accountError(void 0);this.account.register(b,a,function(b){b?this.accountError("Couldn't register: "+b):(goog_report_register(),ga("send","event","conversion","register"),this.network.socket.emit("uKey",this.account.uKey),this.createAccountWindow())}.bind(this))};
DrawTogether.prototype.accountError=function(b){for(;this.loginMessage.firstChild;)this.loginMessage.removeChild(this.loginMessage.firstChild);if(b){var a=this.loginMessage.appendChild(document.createElement("div"));a.className="drawtogether-error drawtogether-login-error";a.appendChild(document.createTextNode(b))}};
DrawTogether.prototype.accountSuccess=function(b){for(;this.loginMessage.firstChild;)this.loginMessage.removeChild(this.loginMessage.firstChild);if(b){var a=this.loginMessage.appendChild(document.createElement("div"));a.className="drawtogether-success drawtogether-login-success";a.appendChild(document.createTextNode(b))}};
DrawTogether.prototype.uploadImage=function(){for(;this.imgurUrl.firstChild;)this.imgurUrl.removeChild(this.imgurUrl.firstChild);this.showShareMessage("Uploading...");this.network.socket.emit("uploadimage",this.preview.toDataURL().split(",")[1],function(b){b.error?this.showShareError(b.error):this.showImgurUrl(b.url)}.bind(this))};
DrawTogether.prototype.showShareError=function(b){for(;this.shareError.firstChild;)this.shareError.removeChild(this.shareError.firstChild);var a=this.shareError.appendChild(document.createElement("div"));a.appendChild(document.createTextNode(b));a.className="drawtogether-error drawtogether-share-error"};
DrawTogether.prototype.showShareMessage=function(b){for(;this.imgurUrl.firstChild;)this.imgurUrl.removeChild(this.imgurUrl.firstChild);var a=this.imgurUrl.appendChild(document.createElement("div"));a.appendChild(document.createTextNode(b));a.className="drawtogether-share-url"};
DrawTogether.prototype.showImgurUrl=function(b){for(;this.imgurUrl.firstChild;)this.imgurUrl.removeChild(this.imgurUrl.firstChild);var a=this.imgurUrl.appendChild(document.createElement("div"));a.innerHTML='Uploaded on imgur: <a href="'+b+'">'+b+"</a>";a.className="drawtogether-share-url";this.shareToRedditButton.target="_blank";this.shareToRedditButton.href="http://www.reddit.com/r/anondraw/submit?url="+encodeURIComponent(b)};
DrawTogether.prototype.toggleFollow=function(){(this._autoMoveScreen=!this._autoMoveScreen)?this.displayMessage("Your screen will now move around automatically."):(this.displayMessage("You now have to move the camera manually."),this.moveQueue.length=0)};
DrawTogether.prototype.createShareWindow=function(){shareWindow=this.container.appendChild(document.createElement("div"));shareWindow.className="drawtogether-sharewindow";this.shareWindow=shareWindow;this.shareError=shareWindow.appendChild(document.createElement("div"));this.imgurUrl=shareWindow.appendChild(document.createElement("div"));var b=shareWindow.appendChild(document.createElement("canvas"));b.className="drawtogether-preview-canvas";this.preview=b;b=shareWindow.appendChild(document.createElement("div"));
b.className="drawtogether-button drawtogether-upload-button";b.appendChild(document.createTextNode("Upload image to imgur"));b.addEventListener("click",this.uploadImage.bind(this));b=shareWindow.appendChild(document.createElement("a"));b.className="drawtogether-button drawtogether-share-button";b.appendChild(document.createTextNode("Share image to reddit"));b.href="#";this.shareToRedditButton=b;b.addEventListener("click",function(b){-1===b.href.indexOf("reddit")&&this.showShareError("First upload the image to imgur before uploading it to reddit!")}.bind(this,
b));b=shareWindow.appendChild(document.createElement("div"));b.appendChild(document.createTextNode("Close share window"));b.className="drawtogether-button drawtogether-close-button";b.addEventListener("click",this.closeShareWindow.bind(this))};
DrawTogether.prototype.createModeSelector=function(){var b=this.container.appendChild(document.createElement("div"));b.className="drawtogether-selectwindow";this.selectWindow=b;var a=b.appendChild(document.createElement("h1"));a.appendChild(document.createTextNode("Anondraw - Draw with friends or strangers!"));a.className="drawtogether-welcome-text";a=b.appendChild(document.createElement("div"));a.className="drawtogether-welcome-text-box";a.appendChild(document.createElement("span")).appendChild(document.createTextNode("Realtime paint on an unlimited canvas."));
a=b.appendChild(document.createElement("div"));a.className="drawtogether-buttoncontainer";var c=a.appendChild(document.createElement("div"));c.className="drawtogether-modeselect-button";c.innerHTML='<img src="images/multi.png"/><br/>Draw with everyone';c.addEventListener("click",function(){this.changeRoom("main");ga("send","event","modeselector","strangers");this.selectWindow.style.display="";goog_report_join()}.bind(this));c=a.appendChild(document.createElement("div"));c.className="drawtogether-modeselect-button";
c.innerHTML='<img src="images/invite.png"/><br/>Sketch alone or with friends';c.addEventListener("click",function(){this.settings.room="private_"+Math.random().toString(36).substr(2,5);this.changeRoom(this.settings.room,void 0,0,0,!0);ga("send","event","modeselector","private");this.selectWindow.style.display="";goog_report_join()}.bind(this));a=a.appendChild(document.createElement("div"));a.className="drawtogether-modeselect-button";a.innerHTML='<img src="images/game.png"/><br/>Play guess word';
a.addEventListener("click",function(){this.gui.prompt("With whom would you like to play?",["Join strangers","Create private room","Cancel"],function(b){"Cancel"==b?this.openModeSelector():"Join strangers"==b?this.joinGame():"Create private room"==b&&this.createPrivateGame()}.bind(this));ga("send","event","modeselector","game");this.selectWindow.style.display="";goog_report_join()}.bind(this));b.appendChild(this.createFAQDom());this.redditDrawings=b.appendChild(document.createElement("div"));this.redditDrawings.className=
"drawtogether-redditdrawings";this.populateRedditDrawings();b=b.appendChild(document.createElement("div"));b.appendChild(document.createTextNode("Feedback/contact: info@anondraw.com"));b.classList.add("contactinfo");pw_load()};
DrawTogether.prototype.populateRedditDrawings=function(){var b=new XMLHttpRequest;b.addEventListener("readystatechange",function(a){if(4==b.readyState&&200==b.status){a=JSON.parse(b.responseText).data.children;for(var e=0;e<a.length;e++)this.redditDrawings.appendChild(this.createRedditPost(a[e].data))}}.bind(this));b.open("GET","https://www.reddit.com/r/anondraw/.json");b.send();var a=this.redditDrawings.appendChild(document.createElement("a"));a.appendChild(document.createTextNode("Reddit gallery (/r/anondraw)"));
a.href="http://www.reddit.com/r/anondraw";a.className="drawtogether-redditdrawings-title"};
DrawTogether.prototype.createRedditPostAd=function(){var b=document.createElement("div");b.className="adcontainer drawtogether-redditpost";b.innerHTML='\x3c!-- Project Wonderful Ad Box Code --\x3e<div id="pw_adbox_78948_4_0"></div><script type="text/javascript">\x3c/script><noscript><map name="admap78948" id="admap78948"><area href="http://www.projectwonderful.com/out_nojs.php?r=0&c=0&id=78948&type=4" shape="rect" coords="0,0,125,125" title="" alt="" target="_blank" /></map><table cellpadding="0" cellspacing="0" style="width:125px;border-style:none;background-color:#ffffff;"><tr><td><img src="http://www.projectwonderful.com/nojs.php?id=78948&type=4" style="width:125px;height:125px;border-style:none;" usemap="#admap78948" alt="" /></td></tr><tr><td style="background-color:#ffffff;" colspan="1"><center><a style="font-size:10px;color:#0000ff;text-decoration:none;line-height:1.2;font-weight:bold;font-family:Tahoma, verdana,arial,helvetica,sans-serif;text-transform: none;letter-spacing:normal;text-shadow:none;white-space:normal;word-spacing:normal;" href="http://www.projectwonderful.com/advertisehere.php?id=78948&type=4" target="_blank">Ads by Project Wonderful!  Your ad here, right now: $0</a></center></td></tr></table></noscript>\x3c!-- End Project Wonderful Ad Box Code --\x3e';return b};
DrawTogether.prototype.createThumbLink=function(b,a,c){var e=document.createElement("a");e.href=b;e.target="_blank";e.className="drawtogether-redditpost";b=e.appendChild(document.createElement("span"));b.className="drawtogether-redditpost-title";b.appendChild(document.createTextNode(a));a=e.appendChild(document.createElement("img"));a.className="drawtogether-redditpost-thumb";a.src=c;return e};
DrawTogether.prototype.createRedditPost=function(b){var a=document.createElement("a");a.href="http://www.reddit.com"+b.permalink;a.target="_blank";a.className="drawtogether-redditpost";var c=a.appendChild(document.createElement("span"));c.className="drawtogether-redditpost-title";c.appendChild(document.createTextNode(b.title));"self"!==b.thumbnail&&"default"!==b.thumbnail&&"nsfw"!==b.thumbnail?(c=a.appendChild(document.createElement("img")),c.className="drawtogether-redditpost-thumb",c.src=b.thumbnail):
"nsfw"==b.thumbnail?(c=a.appendChild(document.createElement("img")),c.className="drawtogether-redditpost-thumb",c.src=b.url):a.appendChild(document.createElement("div")).className="drawtogether-redditpost-thumbfiller";return a};DrawTogether.prototype.openDiscordWindow=function(){this.gui.createWindow({title:"Voice chat: Discord"}).appendChild(document.createElement("div")).innerHTML='<iframe src="https://discordapp.com/widget?id=187008981837938689&theme=dark" width="350" height="500" allowtransparency="true" frameborder="0"></iframe>'};
DrawTogether.prototype.openPremiumBuyWindow=function(){var b=this.gui.createWindow({title:"Premium"}).appendChild(document.createElement("div"));b.className="content";b.appendChild(document.createElement("h2")).appendChild(document.createTextNode("Getting premium."));var a=b.appendChild(document.createElement("p"));a.appendChild(document.createTextNode("Anondraw runs on very expensive unicorn juice, for that we need your help!"));a=b.appendChild(document.createElement("p"));a.appendChild(document.createTextNode("Going premium costs 20 euro which will forever grant you extra features. It will also help us build new and better tools."));
a=b.appendChild(document.createElement("p"));a.appendChild(document.createTextNode("Current features:"));for(var a=b.appendChild(document.createElement("ol")),c=["Support icon","Rainbow colored name","20 reputation","Private regions"],e=0;e<c.length;e++)a.appendChild(document.createElement("li")).appendChild(document.createTextNode(c[e]));a=b.appendChild(document.createElement("p"));a.appendChild(document.createTextNode("Have any premium feature ideas? Let us know!"));a=b.appendChild(document.createElement("p"));
this.account.uKey?1==this.memberlevel?b="Thank you for supporting us!":(b="You are paying for the account: "+this.account.mail+" <br/><br/>",b+='This takes up to 1 day to confirm. If it takes longer contact premium@squarific.com <br/><br/><form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">',b+='<input type="hidden" name="cmd" value="_s-xclick">',b+='<input type="hidden" name="hosted_button_id" value="RU7EGGG6RH4AG">',b+='<table style="display:none;">',b+='<tr><td><input type="hidden" name="on0" value="Account/Email">Account/Email</td></tr><tr><td><input type="text" value="'+
this.account.mail+'" name="os0" maxlength="200"></td></tr>',b+="</table>",b+='<input type="image" style="margin-top:0.5em;" src="https://www.paypalobjects.com/en_US/BE/i/btn/btn_buynowCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">',b+='<img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">',b+="</form>",b+="<br/>",b+='<a class="coinbase-button" data-code="8be6985bf22cfd01ca0877cb6fb97249" data-button-style="custom_small" href="https://www.coinbase.com/checkouts/8be6985bf22cfd01ca0877cb6fb97249">Pay With Bitcoin</a>',
b+="<br/>",b+="Or via bank transfer: IBAN: BE59 0014 7710 8926<br/>",b+="Be sure to include your username/email!<br/>",b+="This might take a few days to clear, if you mail to premium@anondraw.com we will clear you faster."):b="You should first login!";a.innerHTML=b;(function(){var b,a,c;b=function(b){return"development"===b||"test"===b?document.location.protocol+"//"+document.location.host:"sandbox"===b?"https://sandbox.coinbase.com":"https://www.coinbase.com"};a=function(c,e){var g,m;if(window.coinbaseCookieLoaded)return e(c);
if(window.coinbaseCookieLoading)return setTimeout(function(){return a(c,e)},200);g=b(c("body").data("env"));window.coinbaseCookieLoading=!0;m=document.createElement("script");m.src=g+"/checkouts/get_cookie.js";m.onload=m.onreadystatechange=function(){window.coinbaseCookieLoaded=!0;window.coinbaseCookieLoading=!1;c(m).remove();return e(c)};return(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(m)};c=function(a){var c,e,f,g,r;e=c=!1;r=b(a("body").data("env"));g=function(b){switch(b){case "custom_large":return 276;
case "custom_small":return 210;case "subscription_large":return 263;case "subscription_small":return 210;case "donation_large":return 189;case "donation_small":return 148;case "buy_now_large":return 211;case "buy_now_small":return 170;default:return 211}};f=function(b){switch(b){case "custom_large":return 62;case "custom_small":return 48;default:return 46}};window.addEventListener("message",function(b){var d,f;d=b.data.split("|");f=d[0];d=d[1];d=escape(d);if(b.origin===r){if("show modal iframe"===
f)return a("#coinbase_modal_iframe_"+d).show();if("coinbase_payment_complete"===f)return a("#coinbase_button_iframe_"+d).attr("src",r+"/buttons/paid"),a(document).trigger("coinbase_payment_complete",d);if("coinbase_payment_mispaid"===f)return a(document).trigger("coinbase_payment_mispaid",d);if("coinbase_payment_expired"===f)return a(document).trigger("coinbase_payment_expired",d);if("hide modal"===f)return a("#coinbase_modal_iframe_"+d).hide(),a(document).trigger("coinbase_modal_closed",d);if("signup redirect"===
f)return document.location=r+"/users/verify";if("button frame loaded"===f){if(c=!0,e)return a(document).trigger("coinbase_button_loaded",d)}else if("checkouts frame loaded"===f&&(e=!0,c))return a(document).trigger("coinbase_button_loaded",d)}},!1);a(".coinbase-button").each(function(e){return function(e,l){var q,L,C,H,E;q=a(l);C=q.data();C.referrer=document.domain;H=a.param(C);C=q.data("code");E=q.data("width")||g(q.data("button-style"));L=q.data("height")||f(q.data("button-style"));r=b(q.data("env"));
L="<iframe src='"+r+"/buttons/"+C+"?"+H+"' id='coinbase_button_iframe_"+C+"' name='coinbase_button_iframe_"+C+"' style='width: "+E+"px; height: "+L+"px; border: none; overflow: hidden;' scrolling='no' allowtransparency='true' frameborder='0'></iframe>";C="<iframe src='"+r+"/checkouts/"+C+"/widget?"+H+"' id='coinbase_modal_iframe_"+C+"' name='coinbase_modal_iframe_"+C+"' style='background-color: transparent; border: 0px none transparent; display: none; position: fixed; visibility: visible; margin: 0px; padding: 0px; left: 0px; top: 0px; width: 100%; height: 100%; z-index: 9999;' scrolling='no' allowtransparency='true' frameborder='0'></iframe>";
"none"===q.data("button-style")?c=!0:q.replaceWith(L);return a("body").append(C)}}(this));return a(document).on("coinbase_show_modal",function(b,c){if(0<a("#coinbase_modal_iframe_"+c).length)return a("#coinbase_modal_iframe_"+c).show(),frames["coinbase_modal_iframe_"+c].postMessage("show modal|"+c,r)})};(function(b,a){var c,d,e,f,g,p,u,B;f=[null,null,!1];e=f[0];d=f[1];g=f[2];if(e=window.jQuery)u=parseInt(b.split(".")[0])||0,B=parseInt(b.split(".")[1])||0,c=parseInt(e.fn.jquery.split(".")[0])||0,f=
parseInt(e.fn.jquery.split(".")[1])||0,c=c>u||c===u&&f>=B;if(e&&c)return a(e);p=document.createElement("script");p.type="text/javascript";p.src="https://code.jquery.com/jquery-1.8.3.min.js";p.onload=p.onreadystatechange=function(){if(!(g||(d=this.readyState)&&"loaded"!==d&&"complete"!==d))return a((e=window.jQuery).noConflict(1)),e(p).remove()};return(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(p)})("1.7",function(b){return a(b,c)})}).call(this)};
DrawTogether.prototype.openWelcomeWindow=function(){var b=this.gui.createWindow({title:"Welcome!",onclose:function(){this.userSettings.setBoolean("Show welcome",!1,!0)}.bind(this)});b.classList.add("welcome-window");var a=b.appendChild(document.createElement("div"));a.className="content";a.appendChild(document.createElement("h2")).appendChild(document.createTextNode("Hey you seem to be new!"));var c=a.appendChild(document.createElement("p"));c.appendChild(document.createTextNode("Anondraw is a website where artists of all skill levels come together to draw. All drawings are allowed so that means this website might contain NSFW (18+) images. If you do not feel comfortable with that, you should not join the public rooms."));
c=a.appendChild(document.createElement("p"));c.appendChild(document.createTextNode("License: You give us the non-exclusive, transferable right to display and modify all the content you create using this website. In the public rooms, aka the rooms that do not start with private_ you also give everyone the Creative Commons share alike license for non commercial use."));c=a.appendChild(document.createElement("p"));c.appendChild(document.createTextNode("Lastly we like to create, not destroy. Griefing will result in a ban of up to 10 years."));
c=a.appendChild(document.createElement("p"));c.appendChild(document.createTextNode("Regards,"));c.appendChild(document.createElement("br"));c.appendChild(document.createTextNode("Anondraw Team"));c=a.appendChild(document.createElement("div"));c.appendChild(document.createTextNode("Tutorial"));c.className="drawtogether-button";c.addEventListener("click",function(){b.parentNode&&b.parentNode.removeChild(b);introJs().setOptions({tooltipPosition:"auto",showProgress:!0}).onchange(function(){ga("send",
"event","tutorial","next")}).onexit(function(){ga("send","event","tutorial","exit");this.openWelcomeWindow()}.bind(this)).oncomplete(function(){ga("send","event","tutorial","complete");this.openWelcomeWindow()}.bind(this)).start()}.bind(this));a=a.appendChild(document.createElement("div"));a.appendChild(document.createTextNode("Close welcome window"));a.className="drawtogether-button drawtogether-close-button";a.addEventListener("click",function(){b.parentNode&&b.parentNode.removeChild(b);this.userSettings.setBoolean("Show welcome",
!1,!0)}.bind(this))};
DrawTogether.prototype.openFeedbackWindow=function(){var b=this.gui.createWindow({title:"Feedback"});b.classList.add("feedback-window");b=b.appendChild(document.createElement("div"));b.className="content";b.appendChild(document.createElement("h2")).appendChild(document.createTextNode("Feedback"));var a=b.appendChild(document.createElement("p"));a.appendChild(document.createTextNode("Hey we would like to ask you a question!"));a=b.appendChild(document.createElement("p"));a.appendChild(document.createTextNode("What feature would you want before you'd consider becoming a premium user?"));var c=
b.appendChild(document.createElement("form")).appendChild(document.createElement("textarea")),a=b.appendChild(document.createElement("div"));a.appendChild(document.createTextNode("Send"));a.className="drawtogether-button";a.addEventListener("click",function(){this.account.feedback(c)}.bind(this));a=b.appendChild(document.createElement("p"));a.appendChild(document.createTextNode("Regards,"));a.appendChild(document.createElement("br"));a.appendChild(document.createTextNode("Anondraw Team"))};
DrawTogether.prototype.openNewFeatureWindow=function(){localStorage.setItem("newfeaturewindowversion",this.CLIENT_VERSION);var b=this.gui.createWindow({title:"New features!"});b.classList.add("feature-window");var a=b.appendChild(document.createElement("div"));a.className="content";a.appendChild(document.createElement("h2")).appendChild(document.createTextNode("We just had an update!"));var c=a.appendChild(document.createElement("p"));c.appendChild(document.createTextNode("Current new features:"));
for(var c=a.appendChild(document.createElement("ol")),e=["Private regions for premium members","Thanks to intOrFloat the chat will now give you a warning if your drawings are not getting saved."],d=0;d<e.length;d++)c.appendChild(document.createElement("li")).appendChild(document.createTextNode(e[d]));c=a.appendChild(document.createElement("p"));c.appendChild(document.createTextNode("If you are premium you can create a private region. Noone besides you can then draw there."));c=a.appendChild(document.createElement("p"));
c.appendChild(document.createTextNode("In the future you will be able to pick who gets to draw in it and who doesn't."));a=a.appendChild(document.createElement("div"));a.appendChild(document.createTextNode("Want to enjoy this feature? Get premium!"));a.className="drawtogether-button";a.addEventListener("click",function(){b.parentNode&&b.parentNode.removeChild(b);this.openPremiumBuyWindow()}.bind(this))};
DrawTogether.prototype.openModeratorWelcomeWindow=function(){localStorage.setItem("moderatorwelcomewindowlastopen",Date.now());var b=this.gui.createWindow({title:"You are a moderator!"});b.classList.add("moderator-window");b=b.appendChild(document.createElement("div"));b.className="content";var a=b.appendChild(document.createElement("h2"));a.appendChild(document.createTextNode("You got more than "+this.KICKBAN_MIN_REP+" rep!"));a=b.appendChild(document.createElement("p"));a.appendChild(document.createTextNode("That means you can now kick and ban people in all rooms. That gives you a lot of power, and with great power comes great responsibilty."));
a=b.appendChild(document.createElement("p"));a.appendChild(document.createTextNode("To help you with that we will give you some tips!"));a=b.appendChild(document.createElement("p"));a.appendChild(document.createTextNode("A good moderator diffuses situations. Try to remain calm and have a thick skin."));a=b.appendChild(document.createElement("p"));a.appendChild(document.createTextNode("Always assume good faith.That means that if someone says or does something you have to assume they did not do it to be annoying.It also means that you have to assume that if they do something that is not allowed you should assume they did it on accident."));
a=b.appendChild(document.createElement("h3"));a.appendChild(document.createTextNode("Ban times"));a=b.appendChild(document.createElement("p"));a.appendChild(document.createTextNode("If someone blatently griefs, feel free to ban them for over a week."));a=b.appendChild(document.createElement("p"));a.appendChild(document.createTextNode("If someone is spamming or being annoying, a 5 minute timeout should suffice."));a=b.appendChild(document.createElement("p"));a.appendChild(document.createTextNode("If they come back after the timeout and repeat it, you can ban for longer periods."));
a=b.appendChild(document.createElement("p"));a.appendChild(document.createTextNode("If someone drew something that you might consider grief but might be a mistake, ask them to undo it."));a=b.appendChild(document.createElement("h3"));a.appendChild(document.createTextNode("Questions"));a=b.appendChild(document.createElement("p"));a.appendChild(document.createTextNode("If you have a question, feel free to mail info@anondraw.com or ask squarifc on discord."));a=b.appendChild(document.createElement("p"));
a.appendChild(document.createTextNode("This is also the place you should direct users with questions you don't know the answer to."))};
DrawTogether.prototype.createFAQDom=function(){var b=document.createElement("div");b.className="drawtogether-faq";var a=b.appendChild(document.createElement("div"));a.className="adcontainer drawtogether-question";a.innerHTML='\x3c!-- Project Wonderful Ad Box Code --\x3e<div style="text-align:center;"><div style="display:inline-block;" id="pw_adbox_78949_1_0"></div></div><script type="text/javascript">\x3c/script><noscript><div style="text-align:center;"><div style="display:inline-block;"><map name="admap78949" id="admap78949"><area href="http://www.projectwonderful.com/out_nojs.php?r=0&c=0&id=78949&type=1" shape="rect" coords="0,0,468,60" title="" alt="" target="_blank" /></map><table cellpadding="0" cellspacing="0" style="width:468px;border-style:none;background-color:#3A5774;"><tr><td><img src="http://www.projectwonderful.com/nojs.php?id=78949&type=1" style="width:468px;height:60px;border-style:none;" usemap="#admap78949" alt="" /></td></tr><tr><td style="background-color:#3A5774;" colspan="1"><center><a style="font-size:10px;color:#ffffff;text-decoration:none;line-height:1.2;font-weight:bold;font-family:Tahoma, verdana,arial,helvetica,sans-serif;text-transform: none;letter-spacing:normal;text-shadow:none;white-space:normal;word-spacing:normal;" href="http://www.projectwonderful.com/advertisehere.php?id=78949&type=1" target="_blank">Ads by Project Wonderful!  Your ad here, right now: $0</a></center></td></tr></table></div></div></noscript>\x3c!-- End Project Wonderful Ad Box Code --\x3e';for(var a=
[{question:"What is anondraw?",answer:"It's a website where you can draw or doodle in group with friends or strangers. Join one of the rooms and start drawing and collaborating with the group. The interactive drawing works on the iPad and other android tablets. You can also doodle on phones."},{question:"How do I chat?",answer:"There is a chat to the right or if you are on mobile you can click on the chat button."},{question:"How big is the canvas?",answer:"The interactive canvas has an infinite size. You could move as far away from the center as you'd like."},
{question:"I want to draw privately with some people, is that possible?",answer:"Yes, in the home screen click on draw with friends and then share the invite url printed in the chat. If you are already in a room, simply click on the room button and then click create private room after giving it a name."},{question:"How do you play the game?",answer:"It's a drawsomething pictionairy like game. You play the game by drawing the word you get. Then other people have to guess what you draw. The person that guessed the drawing and the drawer get a point."},
{question:"Why can't I draw? How do I regain Ink?",answer:"You probably don't have any ink left. You can get more ink by waiting 30 seconds. If you still don't get enough ink try making an account, the more reputation you have the more ink you get."},{question:"What is that number with an R behind peoples names?",answer:"That is the amount of reputation someone has. The more they have the more benefits they get."},{question:"What are those points behind some peoples names?",answer:"If you play the gamemode you can earn points by guessing what other people are drawing."},
{question:"Are 3d party programs allowed?",answer:'They are as long as they are reasonable. So be cool about it. An example of drawing bots: <a href="http://anonbots.bitballoon.com/" alt="Anondraw bot">http://anonbots.bitballoon.com</a>'},{question:"What benefits does reputation give you?",answer:"At "+this.ZOOMED_OUT_MIN_REP+" reputation, you are allowed to draw while zoomed out. \nAt "+this.BIG_BRUSH_MIN_REP+" reputation, you are allowed to use brush sizes bigger than 10. \nAt 7 reputation, you can give upvotes to other people who have less reputation than you. \nAt 15 reputation, you can join the member only rooms and share an ip with other users without affecting your ink. \nAt "+
this.KICKBAN_MIN_REP+"+ reputation, you can kickban people for a certain amount of time when they misbehave. \n "},{question:"How do I get reputation?",answer:"Other people have to give you an upvote, every upvote is one reputation."},{question:"Am I allowed to destroy doodles or drawings?",answer:"The goal is to let people draw together. You should never be afraid to help or change a drawing. However griefing on purpose is not allowed."},{question:"I want to draw in group but I don't want people to destroy my drawing/doodle.",
answer:"Move away from the center where there are less people then get some reputation from your drawings and use the member rooms."},{question:"So this is basicly a ms paint multiplayer app?",answer:"You could call it that yea, it's a draw pad where you can draw something online."},{question:"How long will my sketches be saved?",answer:"Your sketches should remain forever. All drawings are saved on the pads every 6 hours, after this period they should be permanent."},{question:"Can I play this like draw something but online?",
answer:"Yes, there is a gamemode where you get words and other people have to guess what you just drew."}],c=0;c<a.length;c++){var e=b.appendChild(document.createElement("div"));e.className="drawtogether-question";var d=e.appendChild(document.createElement("h2"));d.className="drawtogether-question-question";d.innerHTML=a[c].question;e=e.appendChild(document.createElement("div"));e.className="drawtogether-question-answer";for(var d=a[c].answer.split("\n"),f=0;f<d.length;f++)e.appendChild(document.createElement("div")).innerHTML=
d[f]}return b};
DrawTogether.prototype.createControlArray=function(){var b=[{name:"home-button",type:"button",value:"",text:"Home",title:"Go to home menu",action:this.openModeSelector.bind(this),data:{intro:"Use this to return to the FAQ and mode selection."}},{name:"toggle-view",type:"button",value:"",text:"Auto Camera",title:"Toggle the camera to follow where people are drawing.",action:this.toggleFollow.bind(this),data:{intro:"This button toggles auto view, in auto view mode the camera will switch between everyone who is drawing."}},{name:"name",
type:"text",text:"Username",value:localStorage.getItem("drawtogether-name")||"",title:"Change your name",action:this.changeNameDelayed.bind(this),data:{intro:"This is your current guest name. Change this to something you like!"}},{name:"room-button",type:"button",text:"Room",action:this.openRoomWindow.bind(this),data:{intro:"Click here if you want to change the room."}},{name:"share-button",type:"button",text:"Share",action:this.openShareWindow.bind(this),data:{intro:"Made something nice? Use this to upload to imgur. Then you can share the imgur link to reddit if you want. Sharing it to reddit will also put it on the frontpage."}},
{name:"settings",type:"button",text:"Settings",action:this.openSettingsWindow.bind(this),data:{intro:"In this window you can mute the chat, hide tips and open the advanced settings window where you can rotate and mirror the canvas."}}];-1==location.toString().indexOf("kongregate")&&b.push({name:"account",type:"button",text:"Account",action:this.openAccountWindow.bind(this),data:{intro:"Creating an account gives you the option to earn reputation. Reputation gives certain benefits like bigger brushes, drawing while zoomed out, member room access, banning, ..."}});
b.push({name:"discord",type:"button",text:"Voice chat",action:this.openDiscordWindow.bind(this),data:{intro:"We also have a voice chat using discord!"}});return b};
DrawTogether.prototype.utils={copy:function(b){var a={},c;for(c in b)a[c]="object"==typeof b[c]?this.copy(b[c]):b[c];return a},merge:function(b,a){"object"!=typeof b&&(b={});for(var c in a)"object"==typeof a[c]?b[c]=this.merge(b[c],a[c]):"undefined"==typeof b[c]&&(b[c]=a[c]);return b},distance:function(b,a,c,e){b-=c;a-=e;return Math.sqrt(b*b+a*a)}};function Gui(b){this.container=b}
Gui.prototype.prompt=function(b,a,c){"function"==typeof a&&(c=a,a="freepick");c="function"==typeof c?c:function(){};var e=this.container.appendChild(document.createElement("div")),d=e.appendChild(document.createElement("div")),f=d.appendChild(document.createElement("span")),g=d.appendChild(document.createElement("div"));e.className="gui-prompt-container";d.className="gui-prompt-content";f.className="gui-prompt-question";g.className="gui-prompt-answers";f.innerText=b;f.textContent=b;"freepick"==a&&
g.appendChild(this.createFreePick(b,function(b){c(b);this.container.removeChild(e)}.bind(this)));if("object"==typeof a&&"number"==typeof a.length)for(d=0;d<a.length;d++)"freepick"==a[d]?g.appendChild(this.createFreePick(b,function(b){c(b);this.container.removeChild(e)}.bind(this))):(f=g.appendChild(document.createElement("div")),f.className="gui-prompt-button gui-prompt-option-button",f.innerText=a[d],f.textContent=a[d],f.option=a[d],f.addEventListener("click",function(b){this.container.removeChild(e);
c(b.target.option)}.bind(this)));return e};
Gui.prototype.createFreePick=function(b,a){var c=document.createElement("div"),e=c.appendChild(document.createElement("input"));e.className="gui-prompt-freepick-input";e.placeholder=b;e.addEventListener("keypress",function(b){13==b.keyCode&&a(e.value)});var d=c.appendChild(document.createElement("div"));d.className="gui-prompt-button gui-prompt-freepick-button";d.innerText="Submit";d.textContent="Submit";d.addEventListener("click",function(b){a(e.value)});return c};
Gui.prototype.makeDraggable=function(b,a){function c(){g=!0;d=[event.clientX||0,event.clientY||0];event.changedTouches&&event.changedTouches[0]&&(d=[event.changedTouches[0].clientX||0,event.changedTouches[0].clientY||0]);var a=b.getBoundingClientRect();f=[a.left,a.top];event.preventDefault()}function e(){g&&(b.style.left=f[0]-d[0]+(event.clientX||event.changedTouches[0].clientX)+"px",b.style.top=f[1]-d[1]+(event.clientY||event.changedTouches[0].clientY)+"px",event.preventDefault())}a||(a=b);var d=
[],f=[],g=!1;a.addEventListener("mousedown",c);a.addEventListener("touchstart",c);document.addEventListener("mousemove",e);document.addEventListener("touchmove",e);a.addEventListener("mouseup",function(b){g=!1});a.addEventListener("touchend",function(b){g=!1})};
Gui.prototype.createWindow=function(b){var a=this.container.appendChild(document.createElement("div"));a.className="gui-window";var c=a.appendChild(document.createElement("div"));c.className="titlecontainer";var e=c.appendChild(document.createElement("span"));e.className="title";e.appendChild(document.createTextNode(b.title||"window"));if("undefined"==typeof b.close||b.close)e=c.appendChild(document.createElement("span")),e.appendChild(document.createTextNode("X")),e.className="close",e.addEventListener("click",
function(){a.parentNode&&a.parentNode.removeChild(a);if("function"==typeof b.onclose)b.onclose()}),e.addEventListener("touchstart",function(){a.parentNode&&a.parentNode.removeChild(a);if("function"==typeof b.onclose)b.onclose()});this.makeDraggable(a,c);return a};function Network(b){this.mainServer=b;this.socket;this.oldSockets={};this.callbacks={}}Network.prototype.loadRoom=function(b,a,c,e){this.getServerFromRoom(b,a,c,function(a,c){a?e(a):(console.log("Room '"+b+"' is on server: "+c),this.changeServer(c,function(a){a?e(a):this.socket.emit("changeroom",b,e)}.bind(this)))}.bind(this))};
Network.prototype.joinGame=function(b,a){this._joinGame(b,function(b,e){b?a(b):(console.log("We got gameroom "+e.room+" on server: "+e.server),this.changeServer(e.server,function(b){b?a(b):this.socket.emit("changeroom",e.room,function(b,c){a(b,e.room,c)})}.bind(this)))}.bind(this))};
Network.prototype._joinGame=function(b,a){var c=new XMLHttpRequest;c.addEventListener("readystatechange",function(b){200==c.status&&4==c.readyState?(b=JSON.parse(c.responseText),b.error?a(b.error):a(null,b)):4==c.readyState&&a("Error creating gameroom. Are you connected to the internet? Status code: "+c.status)});c.open("GET",this.mainServer+"/getgameroom?maxoverride="+encodeURIComponent(b));c.send()};
Network.prototype.getRooms=function(b){var a=new XMLHttpRequest;a.addEventListener("readystatechange",function(c){200==a.status&&4==a.readyState?(c=JSON.parse(a.responseText),c.error?b(c.error):b(null,c.rooms)):4==a.readyState&&b("There was an error getting the room. Are you conntected to the internet? Status code: "+a.status)});a.open("GET",this.mainServer+"/getrooms");a.send()};
Network.prototype.getServerFromRoom=function(b,a,c,e){var d=new XMLHttpRequest;d.addEventListener("readystatechange",function(b){200==d.status&&4==d.readyState?(b=JSON.parse(d.responseText),b.error?e("There was an error trying to find a server to play on. Server response: "+b.error):e(null,b.server)):4==d.readyState&&e("There was an error trying to find a server to play on. Are you connected to the internet? Status code: "+d.status)});b=this.mainServer+"/getserver?room="+encodeURIComponent(b);a&&
(b+="&specificoverride=true");c&&(b+="&maxoverride=true");d.open("GET",b);d.send()};Network.prototype.changeServer=function(b,a){-1==b.indexOf("http://")&&(b="http://"+b);this.socket&&this.socket.io.uri==b||(this.socket&&this.socket.disconnect(),this.socket=io(b,{transports:["websocket"],forceNew:!0}),this.reBindHandlers());a()};Network.prototype.on=function(b,a){this.callbacks[b]=this.callbacks[b]||[];-1===this.callbacks[b].indexOf(a)&&(this.callbacks[b].push(a),this.socket&&this.socket.on(b,a))};
Network.prototype.reBindHandlers=function(){if(this.socket&&!this.socket.DT_handlersBound){for(var b in this.callbacks)for(var a=0;a<this.callbacks[b].length;a++)this.socket.on(b,this.callbacks[b][a]);this.socket.DT_handlersBound=!0}};function timeoutCallback(b,a,c,e){var d=!1,f=setTimeout(function(){d||(d=!0,b.apply(c,e))}.bind(c),a);return function(){d||(d=!0,clearTimeout(f),b.apply(this,arguments))}};function Controls(b,a){this.controls=a||[];this.byName={};this.container=b;this.buildControls()}Controls.prototype.buildControls=function(){for(;this.container.firstChild;)this.container.removeChild(container.firstChild);for(var b=0;b<this.controls.length;b++){var a=this.createControl(this.controls[b]);this.container.appendChild(a.containerAppend);this.byName[this.controls[b].name]=a;"function"==typeof a.executeAfterAppend&&a.executeAfterAppend()}};
Controls.prototype.createControl=function(b){if("function"==typeof this.constructors[b.type])return this.constructors[b.type](b);console.error("Unknown control: "+b.type,b);return{containerAppend:document.createTextNode("Unknown control: "+b.type)}};Controls.prototype.constructors={};
Controls.prototype.constructors.button=function(b){var a=document.createElement("div");a.className=(b.classAppend||"")+"control-button";b.value&&(a.value=b.value);b.text&&a.appendChild(document.createTextNode(b.text));if(b.image){var c=a.appendChild(document.createElement("img"));c.src=b.image;c.alt=b.alt}b.title&&(a.title=b.title);if(b.data)for(var e in b.data)a.setAttribute("data-"+e,b.data[e]);a.addEventListener("click",function(c){b.action(a.value);c.preventDefault()});return{input:a,containerAppend:a}};
Controls.prototype.constructors.integer=function(b){var a=document.createElement("div");a.className=(b.classAppend||"")+"control-integer";var c=document.createElement("input");c.type=b.range?"range":"number";c.value=b.value;c.className=(b.classAppend||"")+"control-integer-input";b.text&&(c.placeholder=b.text);b.title&&(c.title=b.title);b.max&&(c.max=b.max);b.min&&(c.min=b.min);if(b.data)for(var e in b.data)c.setAttribute("data-"+e,b.data[e]);c.addEventListener("input",function(){b.action(c.value)});
a.appendChild(this.button({text:"-",action:function(){var a=parseInt(c.max||Infinity),e=parseInt(c.value)-1;c.value=Math.min(a,e);b.action(c.value)}}).containerAppend);a.appendChild(c);a.appendChild(this.button({text:"+",action:function(){var a=parseInt(c.max||Infinity),e=parseInt(c.value)+1;c.value=Math.min(a,e);b.action(c.value)}}).containerAppend);return{input:c,containerAppend:a}};
Controls.prototype.constructors.text=function(b){var a=document.createElement("input");a.type="text";a.value=b.value;a.className=(b.classAppend||"")+"control-text-input";b.text&&(a.placeholder=b.text);b.title&&(a.title=b.title);b.max&&(a.max=b.max);b.min&&(a.min=b.min);if(b.data)for(var c in b.data)a.setAttribute("data-"+c,b.data[c]);a.addEventListener("input",function(){b.action(a.value)});return{input:a,containerAppend:a}};
Controls.prototype.constructors.color=function(b){var a=document.createElement("input");a.type="text";a.value=b.value;a.className=(b.classAppend||"")+"control-color-input";if(b.data)for(var c in b.data)a.setAttribute("data-"+c,b.data[c]);return{input:a,containerAppend:a,executeAfterAppend:function(){$(a).spectrum({showAlpha:!0,showInput:!0,showInitial:!0,preferredFormat:"rgb",showPalette:!0,maxSelectionSize:32,clickoutFiresChange:!0,move:function(a){b.action(a)}})}}};
Controls.prototype.constructors.gradient=function(b){var a=document.createElement("div");a.className=(b.classAppend||"")+"control-gradient";var c=new GradientCreator(a);c.addEventListener("change",b.action);return{input:a,containerAppend:a,gradientCreator:c}};function GradientCreator(b){this._container=b;this.setupDom();this.rerender()}
GradientCreator.prototype.INITIAL_STOPS=[{pos:0,color:"rgba(255, 0, 0, 1)"},{pos:0.15,color:"rgba(255, 255, 0, 1)"},{pos:0.3,color:"rgba(0, 255, 0, 1)"},{pos:0.5,color:"rgba(0, 255, 255, 1)"},{pos:0.65,color:"rgba(0, 0, 255, 1)"},{pos:0.8,color:"rgba(255, 0, 255, 1)"},{pos:1,color:"rgba(255, 0, 0, 1)"}];GradientCreator.prototype.setupDom=function(){for(;this._container.firstChild;)this._container.removeChild(this._container.firstChild);this.createPreviewDom();this.createColorSelector()};
GradientCreator.prototype.createPreviewDom=function(){var b=this._container.appendChild(document.createElement("div"));b.classList.add("gradient-preview");this._previewDom=b;document.addEventListener("mousemove",function(b){this._draggingStop&&(b=this.getRelativeWidth(b,this._previewDom),b=Math.min(1,Math.max(0,b)),this._draggingStop.style.left=100*b+"%",this._hasDragged=!0,this.hideColorPicker(),this.rerender())}.bind(this));document.addEventListener("touchmove",function(b){this._draggingStop&&(b=
this.getRelativeWidth(b,this._previewDom),b=Math.min(1,Math.max(0,b)),this._draggingStop.style.left=100*b+"%",this._hasDragged=!0,this.hideColorPicker(),this.rerender())}.bind(this));document.addEventListener("mouseup",function(b){delete this._draggingStop}.bind(this));document.addEventListener("touchend",function(b){delete this._draggingStop}.bind(this));document.addEventListener("click",function(b){b.target.classList.contains("gradient-stop")||this.hideColorPicker()}.bind(this));b.addEventListener("dblclick",
function(b){b=this.getRelativeWidth(b,this._previewDom);this.createStop({pos:b,color:tinycolor()})}.bind(this));this.INITIAL_STOPS.forEach(this.createStop.bind(this))};
GradientCreator.prototype.createStop=function(b){var a=this._previewDom.appendChild(document.createElement("div"));a.className="gradient-stop";a.style.background=b.color;a.style.left=100*b.pos+"%";a.color=tinycolor(b.color);a.addEventListener("mousedown",function(b){this._draggingStop=a;this._hasDragged=!1}.bind(this));a.addEventListener("touchstart",function(b){this._draggingStop=a;this._hasDragged=!1}.bind(this));a.addEventListener("click",function(b){this._hasDragged||this.changeColorOf(a)}.bind(this));
a.addEventListener("dblclick",function(b){a.parentNode.removeChild(a);b.stopPropagation&&b.stopPropagation();b.cancelBubble=!0;this.rerender()}.bind(this));this.rerender()};GradientCreator.prototype.hideColorPicker=function(){delete this._changingColorOf;for(var b=0;b<this._previewDom.children.length;b++)this._previewDom.children[b].classList.contains("sp-container")&&this._previewDom.children[b].classList.add("hide")};
GradientCreator.prototype.changeColorOf=function(b){for(var a=0;a<this._previewDom.children.length;a++)this._previewDom.children[a].classList.contains("sp-container")&&(this._previewDom.children[a].style.left=b.style.left,this._changingColorOf==b?this._previewDom.children[a].classList.add("hide"):(this._previewDom.children[a].classList.remove("hide"),$(this.spectrumInput).spectrum("set",b.color)));this._changingColorOf=b};
GradientCreator.prototype.createColorSelector=function(){var b=this._previewDom.appendChild(document.createElement("input"));b.type="color";this.spectrumInput=b;$(this.spectrumInput).spectrum({showAlpha:!0,showInput:!0,showButtons:!1,flat:!0,showInitial:!0,preferredFormat:"rgb",showPalette:!0,maxSelectionSize:32,clickoutFiresChange:!0,move:function(b){this._changingColorOf&&(this._changingColorOf.color=b,this._changingColorOf.style.background=b,this.rerender())}.bind(this)});this.hideColorPicker()};
GradientCreator.prototype.getStops=function(){for(var b=[],a=0;a<this._previewDom.children.length;a++)this._previewDom.children[a].classList.contains("gradient-stop")&&b.push({pos:parseFloat(this._previewDom.children[a].style.left.slice(0,-1))/100,color:this._previewDom.children[a].color});b.sort(function(b,a){return b.pos-a.pos});return b};
GradientCreator.prototype.getRelativeWidth=function(b,a){if(!("number"===typeof b.clientX||b.changedTouches&&b.changedTouches[0]&&"number"===typeof b.changedTouches[0].clientX))return 0;var c="number"===typeof b.clientX?b.clientX:b.changedTouches[0].clientX;a=a||b.target||document.elementFromPoint(c,clientY);var e=a.getBoundingClientRect();return(c-e.left)/e.width};
GradientCreator.prototype.rerender=function(){var b=this.getStops().map(function(b,c,e){return b.color+" "+100*b.pos+"%"});this._previewDom.style.background="linear-gradient(90deg, "+b.join(",")+")";this.dispatchEvent({type:"change",stops:this.getStops()})};var EventDispatcher=function(){};
EventDispatcher.prototype={constructor:EventDispatcher,apply:function(b){b.addEventListener=EventDispatcher.prototype.addEventListener;b.hasEventListener=EventDispatcher.prototype.hasEventListener;b.removeEventListener=EventDispatcher.prototype.removeEventListener;b.dispatchEvent=EventDispatcher.prototype.dispatchEvent},addEventListener:function(b,a){void 0===this._listeners&&(this._listeners={});var c=this._listeners;void 0===c[b]&&(c[b]=[]);-1===c[b].indexOf(a)&&c[b].push(a)},hasEventListener:function(b,
a){if(void 0===this._listeners)return!1;var c=this._listeners;return void 0!==c[b]&&-1!==c[b].indexOf(a)?!0:!1},removeEventListener:function(b,a){if(void 0!==this._listeners){var c=this._listeners[b];if(void 0!==c){var e=c.indexOf(a);-1!==e&&c.splice(e,1)}}},dispatchEvent:function(b){if(void 0!==this._listeners){var a=this._listeners[b.type];if(void 0!==a){b.target=this;for(var c=[],e=a.length,d=0;d<e;d++)c[d]=a[d];for(d=0;d<e;d++)c[d].call(this,b)}}}};EventDispatcher.prototype.apply(GradientCreator.prototype);
function TiledCanvas(b,a){this.canvas=b;this.ctx=this.canvas.getContext("2d");this.leftTopY=this.leftTopX=0;this.zoom=1;this.affecting=[[0,0],[0,0]];this.chunks={};this.settings=this.normalizeDefaults(a,this.defaultSettings);this.contextQueue=[];this.context=this.createContext();this.lastClear=Date.now()}TiledCanvas.prototype.defaultSettings={chunkSize:256,fadeTime:500};
TiledCanvas.prototype.cloneObject=function(b){var a={},c;for(c in b)a[c]="object"!==typeof b[c]||b[c]instanceof Array?b[c]:this.cloneObject(b[c]);return a};TiledCanvas.prototype.normalizeDefaults=function(b,a){b=b||{};var c=this.cloneObject(b),e;for(e in a)c[e]="object"!==typeof a[e]||a[e]instanceof Array?b[e]||a[e]:this.normalizeDefaults(b[e]||{},a[e]);return c};TiledCanvas.prototype.redrawOnce=function(){this._redrawTimeout||(this._redrawTimeout=requestAnimationFrame(this.redraw.bind(this,!1)))};
TiledCanvas.prototype.redraw=function(b){cancelAnimationFrame(this._redrawTimeout);delete this._redrawTimeout;b||(this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore());var a=Math.floor(this.leftTopX/this.settings.chunkSize);b=Math.ceil((this.leftTopX+this.canvas.width/this.zoom)/this.settings.chunkSize);for(var c=Math.floor(this.leftTopY/this.settings.chunkSize),
e=Math.ceil((this.leftTopY+this.canvas.height/this.zoom)/this.settings.chunkSize);a<b;a++)for(var d=c;d<e;d++)this.drawChunk(a,d)};
TiledCanvas.prototype.drawToCanvas=function(b,a,c){var e=Math.min(a[0],c[0]),d=Math.max(a[0],c[0]),f=Math.min(a[1],c[1]),g=Math.max(a[1],c[1]),h=g-f;c=Math.floor(e/this.settings.chunkSize);d=Math.ceil((e+(d-e))/this.settings.chunkSize);a=Math.floor(f/this.settings.chunkSize);g=Math.ceil((g+h)/this.settings.chunkSize);for(b=b.getContext("2d");c<d;c++)for(h=a;h<g;h++)this.chunks[c]&&(this.chunks[c][h]&&"empty"!==this.chunks[c][h])&&b.drawImage(this.chunks[c][h].canvas,c*this.settings.chunkSize-e,h*
this.settings.chunkSize-f)};
TiledCanvas.prototype.drawChunk=function(b,a){if(this.chunks[b]&&this.chunks[b][a]){if("empty"!=this.chunks[b][a]&&(this.ctx.drawImage(this.chunks[b][a].canvas,(b*this.settings.chunkSize-this.leftTopX)*this.zoom,(a*this.settings.chunkSize-this.leftTopY)*this.zoom,this.settings.chunkSize*this.zoom,this.settings.chunkSize*this.zoom),this.chunks[b][a].addedTime)){var c=Date.now()-this.chunks[b][a].addedTime;this.ctx.globalAlpha=Math.max(0,1-c/this.settings.fadeTime);c>this.settings.fadeTime&&delete this.chunks[b][a].addedTime;
this.redrawOnce();if(this.loadingImage){var c=this.settings.chunkSize*this.zoom,e=c*this.ctx.globalAlpha;this.ctx.drawImage(this.loadingImage,(b*this.settings.chunkSize-this.leftTopX)*this.zoom+(c-e)/2,(a*this.settings.chunkSize-this.leftTopY)*this.zoom+(c-e)/2,e,e)}this.ctx.globalAlpha=1}}else"function"==typeof this.requestUserChunk&&(this.requestChunk(b,a),this.loadingImage&&this.ctx.drawImage(this.loadingImage,(b*this.settings.chunkSize-this.leftTopX)*this.zoom,(a*this.settings.chunkSize-this.leftTopY)*
this.zoom,this.settings.chunkSize*this.zoom,this.settings.chunkSize*this.zoom))};TiledCanvas.prototype.goto=function(b,a){this.leftTopX=b;this.leftTopY=a;this.redrawOnce()};TiledCanvas.prototype.relativeZoom=function(b){this.zoom*=b;this.redrawOnce()};TiledCanvas.prototype.absoluteZoom=function(b){this.zoom=b;this.redrawOnce()};TiledCanvas.prototype.execute=function(){this.executeNoRedraw();this.redrawOnce()};
TiledCanvas.prototype.executeNoRedraw=function(){for(var b=this.affecting[0][0];b<this.affecting[1][0];b++)for(var a=this.affecting[0][1];a<this.affecting[1][1];a++)this.executeChunk(b,a);this.contextQueue=[]};TiledCanvas.prototype.clearAll=function(){this.contextQueue=[];this.requestChunkCallbackList={};this.chunks={};this.lastClear=Date.now()};
TiledCanvas.prototype.requestChunk=function(b,a,c){if("function"===typeof this.requestUserChunk)if(this.requestChunkCallbackList=this.requestChunkCallbackList||{},this.requestChunkCallbackList[b]&&this.requestChunkCallbackList[b][a])c&&this.requestChunkCallbackList[b][a].push(c);else{this.requestChunkCallbackList[b]=this.requestChunkCallbackList[b]||{};this.requestChunkCallbackList[b][a]=c?[c]:[];var e=Date.now();this.requestUserChunk(b,a,function(c){this.lastClear>e||this.setUserChunk(b,a,c)}.bind(this))}};
TiledCanvas.prototype.setUserChunk=function(b,a,c){if(!this.chunks[b]||!this.chunks[b][a]){if(c||this.requestChunkCallbackList[b]&&0!=this.requestChunkCallbackList[b][a].length){this.chunks[b]=this.chunks[b]||{};this.chunks[b][a]=this.newCtx(this.settings.chunkSize,this.settings.chunkSize,-b*this.settings.chunkSize,-a*this.settings.chunkSize);this.chunks[b][a].addedTime=Date.now();c&&this.chunks[b][a].drawImage(c,b*this.settings.chunkSize,a*this.settings.chunkSize);c=this.requestChunkCallbackList[b][a];
for(var e=0;e<c.length;e++)c[e]();this.redrawOnce()}else this.chunks[b]=this.chunks[b]||{},this.chunks[b][a]="empty";delete this.requestChunkCallbackList[b][a]}};TiledCanvas.prototype.copyArray=function(b){for(var a=[],c=0;c<b.length;c++)a[c]=b[c];return a};
TiledCanvas.prototype.executeChunk=function(b,a,c){this.chunks[b]=this.chunks[b]||[];if(!this.chunks[b][a]||"empty"==this.chunks[b][a]){if("function"==typeof this.requestUserChunk&&"empty"!==this.chunks[b][a]){this.requestChunk(b,a,function(c){this.executeChunk(b,a,c)}.bind(this,this.copyArray(c||this.contextQueue)));return}this.chunks[b][a]=this.newCtx(this.settings.chunkSize,this.settings.chunkSize,-b*this.settings.chunkSize,-a*this.settings.chunkSize)}var e=this.chunks[b][a];c=c||this.contextQueue;
for(var d=0;d<c.length;d++)"function"===typeof e[c[d][0]]?this.executeQueueOnChunk(e,c[d]):e[c[d][0]]=c[d][1]};TiledCanvas.prototype.executeQueueOnChunk=function(b,a){b[a[0]].apply(b,Array.prototype.slice.call(a,1))};
TiledCanvas.prototype.drawingRegion=function(b,a,c,e,d){d=d||0;this.affecting[0][0]=Math.floor((Math.min(b,c)-d)/this.settings.chunkSize);this.affecting[0][1]=Math.floor((Math.min(a,e)-d)/this.settings.chunkSize);this.affecting[1][0]=Math.ceil((Math.max(c,b)+d)/this.settings.chunkSize);this.affecting[1][1]=Math.ceil((Math.max(e,a)+d)/this.settings.chunkSize)};
TiledCanvas.prototype.newCtx=function(b,a,c,e){var d=document.createElement("canvas").getContext("2d");d.canvas.width=b;d.canvas.height=a;d.translate(c,e);return d};
TiledCanvas.prototype.createContext=function(){var b={},a=document.createElement("canvas").getContext("2d"),c;for(c in a)"function"===typeof a[c]?b[c]=function(b){this.contextQueue.push(arguments)}.bind(this,c):"object"!==typeof a[c]&&(b.__defineGetter__(c,function(b){for(var a=this.newCtx(),c=0;c<this.contextQueue.length;c++)"function"===typeof a[args[0]]?a[args[0]].apply(a,args.slice(1)):a[args[0]]=args[1];return a[b]}.bind(this,c)),b.__defineSetter__(c,function(b,a){this.contextQueue.push(arguments)}.bind(this,
c)));return b};
(function(b,a){"object"===typeof exports?a(exports):"function"===typeof define&&define.amd?define(["exports"],a):a(b)})(this,function(b){function a(b){this._targetElement=b;this._introItems=[];this._options={nextLabel:"Next &rarr;",prevLabel:"&larr; Back",skipLabel:"Skip",doneLabel:"Done",tooltipPosition:"bottom",tooltipClass:"",highlightClass:"",exitOnEsc:!0,exitOnOverlayClick:!0,showStepNumbers:!0,keyboardNavigation:!0,showButtons:!0,showBullets:!0,showProgress:!1,scrollToElement:!0,overlayOpacity:0.8,
positionPrecedence:["bottom","top","right","left"],disableInteraction:!1,hintPosition:"top-middle",hintButtonLabel:"Got it"}}function c(b){var a=[],c=this;if(this._options.steps)for(var h=0,k=this._options.steps.length;h<k;h++){var p=e(this._options.steps[h]);p.step=a.length+1;"string"===typeof p.element&&(p.element=document.querySelector(p.element));if("undefined"===typeof p.element||null==p.element){var l=document.querySelector(".introjsFloatingElement");null==l&&(l=document.createElement("div"),
l.className="introjsFloatingElement",document.body.appendChild(l));p.element=l;p.position="floating"}null!=p.element&&a.push(p)}else{k=b.querySelectorAll("*[data-intro]");if(1>k.length)return!1;h=0;for(p=k.length;h<p;h++){var l=k[h],m=parseInt(l.getAttribute("data-step"),10);0<m&&(a[m-1]={element:l,intro:l.getAttribute("data-intro"),step:parseInt(l.getAttribute("data-step"),10),tooltipClass:l.getAttribute("data-tooltipClass"),highlightClass:l.getAttribute("data-highlightClass"),position:l.getAttribute("data-position")||
this._options.tooltipPosition})}h=m=0;for(p=k.length;h<p;h++)if(l=k[h],null==l.getAttribute("data-step")){for(;"undefined"!=typeof a[m];)m++;a[m]={element:l,intro:l.getAttribute("data-intro"),step:m+1,tooltipClass:l.getAttribute("data-tooltipClass"),highlightClass:l.getAttribute("data-highlightClass"),position:l.getAttribute("data-position")||this._options.tooltipPosition}}}h=[];for(k=0;k<a.length;k++)a[k]&&h.push(a[k]);a=h;a.sort(function(b,a){return b.step-a.step});c._introItems=a;C.call(c,b)&&
(d.call(c),b.querySelector(".introjs-skipbutton"),b.querySelector(".introjs-nextbutton"),c._onKeyDown=function(a){if(27===a.keyCode&&!0==c._options.exitOnEsc)void 0!=c._introExitCallback&&c._introExitCallback.call(c),g.call(c,b);else if(37===a.keyCode)f.call(c);else if(39===a.keyCode)d.call(c);else if(13===a.keyCode){var e=a.target||a.srcElement;e&&0<e.className.indexOf("introjs-prevbutton")?f.call(c):e&&0<e.className.indexOf("introjs-skipbutton")?(c._introItems.length-1==c._currentStep&&"function"===
typeof c._introCompleteCallback&&c._introCompleteCallback.call(c),void 0!=c._introExitCallback&&c._introExitCallback.call(c),g.call(c,b)):d.call(c);a.preventDefault?a.preventDefault():a.returnValue=!1}},c._onResize=function(b){n.call(c,document.querySelector(".introjs-helperLayer"));n.call(c,document.querySelector(".introjs-tooltipReferenceLayer"))},window.addEventListener?(this._options.keyboardNavigation&&window.addEventListener("keydown",c._onKeyDown,!0),window.addEventListener("resize",c._onResize,
!0)):document.attachEvent&&(this._options.keyboardNavigation&&document.attachEvent("onkeydown",c._onKeyDown),document.attachEvent("onresize",c._onResize)));return!1}function e(b){if(null==b||"object"!=typeof b||"undefined"!=typeof b.nodeType)return b;var a={},c;for(c in b)a[c]="undefined"!=typeof jQuery&&b[c]instanceof jQuery?b[c]:e(b[c]);return a}function d(){this._direction="forward";"undefined"===typeof this._currentStep?this._currentStep=0:++this._currentStep;if(this._introItems.length<=this._currentStep)"function"===
typeof this._introCompleteCallback&&this._introCompleteCallback.call(this),g.call(this,this._targetElement);else{var b=this._introItems[this._currentStep];"undefined"!==typeof this._introBeforeChangeCallback&&this._introBeforeChangeCallback.call(this,b.element);q.call(this,b)}}function f(){this._direction="backward";if(0===this._currentStep)return!1;var b=this._introItems[--this._currentStep];"undefined"!==typeof this._introBeforeChangeCallback&&this._introBeforeChangeCallback.call(this,b.element);
q.call(this,b)}function g(b){var a=b.querySelector(".introjs-overlay");if(null!=a){a.style.opacity=0;setTimeout(function(){a.parentNode&&a.parentNode.removeChild(a)},500);var c=b.querySelector(".introjs-helperLayer");c&&c.parentNode.removeChild(c);(c=b.querySelector(".introjs-tooltipReferenceLayer"))&&c.parentNode.removeChild(c);(b=b.querySelector(".introjs-disableInteraction"))&&b.parentNode.removeChild(b);(b=document.querySelector(".introjsFloatingElement"))&&b.parentNode.removeChild(b);if(b=document.querySelector(".introjs-showElement"))b.className=
b.className.replace(/introjs-[a-zA-Z]+/g,"").replace(/^\s+|\s+$/g,"");if((b=document.querySelectorAll(".introjs-fixParent"))&&0<b.length)for(c=b.length-1;0<=c;c--)b[c].className=b[c].className.replace(/introjs-fixParent/g,"").replace(/^\s+|\s+$/g,"");window.removeEventListener?window.removeEventListener("keydown",this._onKeyDown,!0):document.detachEvent&&document.detachEvent("onkeydown",this._onKeyDown);this._currentStep=void 0}}function h(b,a,c,d,e){var f="",g,h;e=e||!1;a.style.top=null;a.style.right=
null;a.style.bottom=null;a.style.left=null;a.style.marginLeft=null;a.style.marginTop=null;c.style.display="inherit";"undefined"!=typeof d&&null!=d&&(d.style.top=null,d.style.left=null);if(this._introItems[this._currentStep]){f=this._introItems[this._currentStep];f="string"===typeof f.tooltipClass?f.tooltipClass:this._options.tooltipClass;a.className=("introjs-tooltip "+f).replace(/^\s+|\s+$/g,"");h=this._introItems[this._currentStep].position;if(("auto"==h||"auto"==this._options.tooltipPosition)&&
"floating"!=h){f=h;g=this._options.positionPrecedence.slice();h=B();var p=s(a).height+10,n=s(a).width+20,q=s(b),u="floating";q.left+n>h.width||0>q.left+q.width/2-n?(m(g,"bottom"),m(g,"top")):(q.height+q.top+p>h.height&&m(g,"bottom"),0>q.top-p&&m(g,"top"));q.width+q.left+n>h.width&&m(g,"right");0>q.left-n&&m(g,"left");0<g.length&&(u=g[0]);f&&"auto"!=f&&-1<g.indexOf(f)&&(u=f);h=u}f=s(b);b=s(a);g=B();switch(h){case "top":c.className="introjs-arrow bottom";k(f,e?0:15,b,g,a);a.style.bottom=f.height+20+
"px";break;case "right":a.style.left=f.width+20+"px";f.top+b.height>g.height?(c.className="introjs-arrow left-bottom",a.style.top="-"+(b.height-f.height-20)+"px"):c.className="introjs-arrow left";break;case "left":e||!0!=this._options.showStepNumbers||(a.style.top="15px");f.top+b.height>g.height?(a.style.top="-"+(b.height-f.height-20)+"px",c.className="introjs-arrow right-bottom"):c.className="introjs-arrow right";a.style.right=f.width+20+"px";break;case "floating":c.style.display="none";a.style.left=
"50%";a.style.top="50%";a.style.marginLeft="-"+b.width/2+"px";a.style.marginTop="-"+b.height/2+"px";"undefined"!=typeof d&&null!=d&&(d.style.left="-"+(b.width/2+18)+"px",d.style.top="-"+(b.height/2+18)+"px");break;case "bottom-right-aligned":c.className="introjs-arrow top-right";l(f,0,b,a);a.style.top=f.height+20+"px";break;case "bottom-middle-aligned":c.className="introjs-arrow top-middle";c=f.width/2-b.width/2;e&&(c+=5);l(f,c,b,a)&&(a.style.right=null,k(f,c,b,g,a));a.style.top=f.height+20+"px";
break;default:c.className="introjs-arrow top",k(f,0,b,g,a),a.style.top=f.height+20+"px"}}}function k(b,a,c,d,e){if(b.left+a+c.width>d.width)return e.style.left=d.width-c.width-b.left+"px",!1;e.style.left=a+"px";return!0}function l(b,a,c,d){if(0>b.left+b.width-a-c.width)return d.style.left=-b.left+"px",!1;d.style.right=a+"px";return!0}function m(b,a){-1<b.indexOf(a)&&b.splice(b.indexOf(a),1)}function n(b){if(b&&this._introItems[this._currentStep]){var a=this._introItems[this._currentStep],c=s(a.element),
d=10;u(a.element)&&(b.className+=" introjs-fixedTooltip");"floating"==a.position&&(d=0);b.setAttribute("style","width: "+(c.width+d)+"px; height:"+(c.height+d)+"px; top:"+(c.top-5)+"px;left: "+(c.left-5)+"px;")}}function r(){var b=document.querySelector(".introjs-disableInteraction");null===b&&(b=document.createElement("div"),b.className="introjs-disableInteraction",this._targetElement.appendChild(b));n.call(this,b)}function q(b){"undefined"!==typeof this._introChangeCallback&&this._introChangeCallback.call(this,
b.element);var a=this,c=document.querySelector(".introjs-helperLayer"),e=document.querySelector(".introjs-tooltipReferenceLayer"),k="introjs-helperLayer";s(b.element);"string"===typeof b.highlightClass&&(k+=" "+b.highlightClass);"string"===typeof this._options.highlightClass&&(k+=" "+this._options.highlightClass);if(null!=c){var l=e.querySelector(".introjs-helperNumberLayer"),m=e.querySelector(".introjs-tooltiptext"),q=e.querySelector(".introjs-arrow"),u=e.querySelector(".introjs-tooltip"),C=e.querySelector(".introjs-skipbutton"),
E=e.querySelector(".introjs-prevbutton"),H=e.querySelector(".introjs-nextbutton");c.className=k;u.style.opacity=0;u.style.display="none";if(null!=l){var z=this._introItems[0<=b.step-2?b.step-2:0];if(null!=z&&"forward"==this._direction&&"floating"==z.position||"backward"==this._direction&&"floating"==b.position)l.style.opacity=0}n.call(a,c);n.call(a,e);if((z=document.querySelectorAll(".introjs-fixParent"))&&0<z.length)for(k=z.length-1;0<=k;k--)z[k].className=z[k].className.replace(/introjs-fixParent/g,
"").replace(/^\s+|\s+$/g,"");z=document.querySelector(".introjs-showElement");z.className=z.className.replace(/introjs-[a-zA-Z]+/g,"").replace(/^\s+|\s+$/g,"");a._lastShowElementTimer&&clearTimeout(a._lastShowElementTimer);a._lastShowElementTimer=setTimeout(function(){null!=l&&(l.innerHTML=b.step);m.innerHTML=b.intro;u.style.display="block";h.call(a,b.element,u,q,l);e.querySelector(".introjs-bullets li > a.active").className="";e.querySelector('.introjs-bullets li > a[data-stepnumber="'+b.step+'"]').className=
"active";e.querySelector(".introjs-progress .introjs-progressbar").setAttribute("style","width:"+J.call(a)+"%;");u.style.opacity=1;l&&(l.style.opacity=1);-1===H.tabIndex?C.focus():H.focus()},350)}else{var t=document.createElement("div"),E=document.createElement("div"),c=document.createElement("div"),I=document.createElement("div"),F=document.createElement("div"),T=document.createElement("div"),y=document.createElement("div"),D=document.createElement("div");t.className=k;E.className="introjs-tooltipReferenceLayer";
n.call(a,t);n.call(a,E);this._targetElement.appendChild(t);this._targetElement.appendChild(E);c.className="introjs-arrow";F.className="introjs-tooltiptext";F.innerHTML=b.intro;T.className="introjs-bullets";!1===this._options.showBullets&&(T.style.display="none");for(var t=document.createElement("ul"),k=0,ba=this._introItems.length;k<ba;k++){var v=document.createElement("li"),M=document.createElement("a");M.onclick=function(){a.goToStep(this.getAttribute("data-stepnumber"))};k===b.step-1&&(M.className=
"active");M.href="javascript:void(0);";M.innerHTML="&nbsp;";M.setAttribute("data-stepnumber",this._introItems[k].step);v.appendChild(M);t.appendChild(v)}T.appendChild(t);y.className="introjs-progress";!1===this._options.showProgress&&(y.style.display="none");k=document.createElement("div");k.className="introjs-progressbar";k.setAttribute("style","width:"+J.call(this)+"%;");y.appendChild(k);D.className="introjs-tooltipbuttons";!1===this._options.showButtons&&(D.style.display="none");I.className="introjs-tooltip";
I.appendChild(F);I.appendChild(T);I.appendChild(y);!0==this._options.showStepNumbers&&(z=document.createElement("span"),z.className="introjs-helperNumberLayer",z.innerHTML=b.step,E.appendChild(z));I.appendChild(c);E.appendChild(I);H=document.createElement("a");H.onclick=function(){a._introItems.length-1!=a._currentStep&&d.call(a)};H.href="javascript:void(0);";H.innerHTML=this._options.nextLabel;E=document.createElement("a");E.onclick=function(){0!=a._currentStep&&f.call(a)};E.href="javascript:void(0);";
E.innerHTML=this._options.prevLabel;C=document.createElement("a");C.className="introjs-button introjs-skipbutton";C.href="javascript:void(0);";C.innerHTML=this._options.skipLabel;C.onclick=function(){a._introItems.length-1==a._currentStep&&"function"===typeof a._introCompleteCallback&&a._introCompleteCallback.call(a);a._introItems.length-1!=a._currentStep&&"function"===typeof a._introExitCallback&&a._introExitCallback.call(a);g.call(a,a._targetElement)};D.appendChild(C);1<this._introItems.length&&
(D.appendChild(E),D.appendChild(H));I.appendChild(D);h.call(a,b.element,I,c,z)}!0===this._options.disableInteraction&&r.call(a);E.removeAttribute("tabIndex");H.removeAttribute("tabIndex");0==this._currentStep&&1<this._introItems.length?(E.className="introjs-button introjs-prevbutton introjs-disabled",E.tabIndex="-1",H.className="introjs-button introjs-nextbutton",C.innerHTML=this._options.skipLabel):this._introItems.length-1==this._currentStep||1==this._introItems.length?(C.innerHTML=this._options.doneLabel,
E.className="introjs-button introjs-prevbutton",H.className="introjs-button introjs-nextbutton introjs-disabled",H.tabIndex="-1"):(E.className="introjs-button introjs-prevbutton",H.className="introjs-button introjs-nextbutton",C.innerHTML=this._options.skipLabel);H.focus();b.element.className+=" introjs-showElement";z=p(b.element,"position");"absolute"!==z&&"relative"!==z&&(b.element.className+=" introjs-relativePosition");for(z=b.element.parentNode;null!=z&&"body"!==z.tagName.toLowerCase();){c=p(z,
"z-index");I=parseFloat(p(z,"opacity"));D=p(z,"transform")||p(z,"-webkit-transform")||p(z,"-moz-transform")||p(z,"-ms-transform")||p(z,"-o-transform");if(/[0-9]+/.test(c)||1>I||"none"!==D&&void 0!==D)z.className+=" introjs-fixParent";z=z.parentNode}L(b.element)||!0!==this._options.scrollToElement||(I=b.element.getBoundingClientRect(),z=B().height,c=I.bottom-(I.bottom-I.top),I=I.bottom-z,0>c||b.element.clientHeight>z?window.scrollBy(0,c-30):window.scrollBy(0,I+100));"undefined"!==typeof this._introAfterChangeCallback&&
this._introAfterChangeCallback.call(this,b.element)}function p(b,a){var c="";b.currentStyle?c=b.currentStyle[a]:document.defaultView&&document.defaultView.getComputedStyle&&(c=document.defaultView.getComputedStyle(b,null).getPropertyValue(a));return c&&c.toLowerCase?c.toLowerCase():c}function u(b){var a=b.parentNode;return"HTML"===a.nodeName?!1:"fixed"==p(b,"position")?!0:u(a)}function B(){if(void 0!=window.innerWidth)return{width:window.innerWidth,height:window.innerHeight};var b=document.documentElement;
return{width:b.clientWidth,height:b.clientHeight}}function L(b){b=b.getBoundingClientRect();return 0<=b.top&&0<=b.left&&b.bottom+80<=window.innerHeight&&b.right<=window.innerWidth}function C(b){var a=document.createElement("div"),c="",d=this;a.className="introjs-overlay";if("body"===b.tagName.toLowerCase())c+="top: 0;bottom: 0; left: 0;right: 0;position: fixed;",a.setAttribute("style",c);else{var e=s(b);e&&(c+="width: "+e.width+"px; height:"+e.height+"px; top:"+e.top+"px;left: "+e.left+"px;",a.setAttribute("style",
c))}b.appendChild(a);a.onclick=function(){!0==d._options.exitOnOverlayClick&&(void 0!=d._introExitCallback&&d._introExitCallback.call(d),g.call(d,b))};setTimeout(function(){c+="opacity: "+d._options.overlayOpacity.toString()+";";a.setAttribute("style",c)},10);return!0}function H(){var b=this._targetElement.querySelector(".introjs-hintReference");if(b){var a=b.getAttribute("data-step");b.parentNode.removeChild(b);return a}}function E(){for(var b=0,a=this._introItems.length;b<a;b++){var c=this._introItems[b];
T.call(this,c.hintPosition,c.element,c.targetElement)}}function I(b){H.call(this);var a=this._targetElement.querySelector('.introjs-hint[data-step="'+b+'"]');a&&(a.className+=" introjs-hidehint");"undefined"!==typeof this._hintCloseCallback&&this._hintCloseCallback.call(this,b)}function z(){var b=this,a=document.querySelector(".introjs-hints");null==a&&(a=document.createElement("div"),a.className="introjs-hints");for(var c=0,d=this._introItems.length;c<d;c++){var e=this._introItems[c];if(!document.querySelector('.introjs-hint[data-step="'+
c+'"]')){var f=document.createElement("a");f.href="javascript:void(0);";(function(a,c,d){a.onclick=function(e){e=e?e:window.event;e.stopPropagation&&e.stopPropagation();null!=e.cancelBubble&&(e.cancelBubble=!0);F.call(b,a,c,d)}})(f,e,c);f.className="introjs-hint";u(e.element)&&(f.className+=" introjs-fixedhint");var g=document.createElement("div");g.className="introjs-hint-dot";var h=document.createElement("div");h.className="introjs-hint-pulse";f.appendChild(g);f.appendChild(h);f.setAttribute("data-step",
c);e.targetElement=e.element;e.element=f;T.call(this,e.hintPosition,f,e.targetElement);a.appendChild(f)}}document.body.appendChild(a);"undefined"!==typeof this._hintsAddedCallback&&this._hintsAddedCallback.call(this)}function T(b,a,c){c=s.call(this,c);switch(b){default:case "top-left":a.style.left=c.left+"px";a.style.top=c.top+"px";break;case "top-right":a.style.left=c.left+c.width+"px";a.style.top=c.top+"px";break;case "bottom-left":a.style.left=c.left+"px";a.style.top=c.top+c.height+"px";break;
case "bottom-right":a.style.left=c.left+c.width+"px";a.style.top=c.top+c.height+"px";break;case "bottom-middle":a.style.left=c.left+c.width/2+"px";a.style.top=c.top+c.height+"px";break;case "top-middle":a.style.left=c.left+c.width/2+"px",a.style.top=c.top+"px"}}function F(b,a,c){"undefined"!==typeof this._hintClickCallback&&this._hintClickCallback.call(this,b,a,c);var d=H.call(this);if(parseInt(d,10)!=c){var d=document.createElement("div"),e=document.createElement("div"),f=document.createElement("div"),
g=document.createElement("div");d.className="introjs-tooltip";d.onclick=function(b){b.stopPropagation?b.stopPropagation():b.cancelBubble=!0};e.className="introjs-tooltiptext";var k=document.createElement("p");k.innerHTML=a.hint;a=document.createElement("a");a.className="introjs-button";a.innerHTML=this._options.hintButtonLabel;a.onclick=I.bind(this,c);e.appendChild(k);e.appendChild(a);f.className="introjs-arrow";d.appendChild(f);d.appendChild(e);this._currentStep=b.getAttribute("data-step");g.className=
"introjs-tooltipReferenceLayer introjs-hintReference";g.setAttribute("data-step",b.getAttribute("data-step"));n.call(this,g);g.appendChild(d);document.body.appendChild(g);h.call(this,b,d,f,null,!0)}}function s(b){var a={};a.width=b.offsetWidth;a.height=b.offsetHeight;for(var c=0,d=0;b&&!isNaN(b.offsetLeft)&&!isNaN(b.offsetTop);)c+=b.offsetLeft,d+=b.offsetTop,b=b.offsetParent;a.top=d;a.left=c;return a}function J(){return 100*(parseInt(this._currentStep+1,10)/this._introItems.length)}var y=function(b){if("object"===
typeof b)return new a(b);if("string"===typeof b){if(b=document.querySelector(b))return new a(b);throw Error("There is no element with given selector.");}return new a(document.body)};y.version="2.0";y.fn=a.prototype={clone:function(){return new a(this)},setOption:function(b,a){this._options[b]=a;return this},setOptions:function(b){var a=this._options,c={},d;for(d in a)c[d]=a[d];for(d in b)c[d]=b[d];this._options=c;return this},start:function(){c.call(this,this._targetElement);return this},goToStep:function(b){this._currentStep=
b-2;"undefined"!==typeof this._introItems&&d.call(this);return this},nextStep:function(){d.call(this);return this},previousStep:function(){f.call(this);return this},exit:function(){g.call(this,this._targetElement);return this},refresh:function(){n.call(this,document.querySelector(".introjs-helperLayer"));n.call(this,document.querySelector(".introjs-tooltipReferenceLayer"));return this},onbeforechange:function(b){if("function"===typeof b)this._introBeforeChangeCallback=b;else throw Error("Provided callback for onbeforechange was not a function");
return this},onchange:function(b){if("function"===typeof b)this._introChangeCallback=b;else throw Error("Provided callback for onchange was not a function.");return this},onafterchange:function(b){if("function"===typeof b)this._introAfterChangeCallback=b;else throw Error("Provided callback for onafterchange was not a function");return this},oncomplete:function(b){if("function"===typeof b)this._introCompleteCallback=b;else throw Error("Provided callback for oncomplete was not a function.");return this},
onhintsadded:function(b){if("function"===typeof b)this._hintsAddedCallback=b;else throw Error("Provided callback for onhintsadded was not a function.");return this},onhintclick:function(b){if("function"===typeof b)this._hintClickCallback=b;else throw Error("Provided callback for onhintclick was not a function.");return this},onhintclose:function(b){if("function"===typeof b)this._hintCloseCallback=b;else throw Error("Provided callback for onhintclose was not a function.");return this},onexit:function(b){if("function"===
typeof b)this._introExitCallback=b;else throw Error("Provided callback for onexit was not a function.");return this},addHints:function(){a:{var b=this._targetElement;this._introItems=[];if(this._options.hints)for(var b=0,a=this._options.hints.length;b<a;b++){var c=e(this._options.hints[b]);"string"===typeof c.element&&(c.element=document.querySelector(c.element));c.hintPosition=c.hintPosition||"top-middle";null!=c.element&&this._introItems.push(c)}else{c=b.querySelectorAll("*[data-hint]");if(1>c.length)break a;
b=0;for(a=c.length;b<a;b++){var d=c[b];this._introItems.push({element:d,hint:d.getAttribute("data-hint"),hintPosition:d.getAttribute("data-hintPosition")||this._options.hintPosition,tooltipClass:d.getAttribute("data-tooltipClass"),position:d.getAttribute("data-position")||this._options.tooltipPosition})}}z.call(this);document.addEventListener?(document.addEventListener("click",H.bind(this),!1),window.addEventListener("resize",E.bind(this),!0)):document.attachEvent&&(document.attachEvent("onclick",
H.bind(this)),document.attachEvent("onresize",E.bind(this)))}return this}};return b.introJs=y});
(function(b){"function"===typeof define&&define.amd?define(["jquery"],b):"object"==typeof exports&&"object"==typeof module?module.exports=b:b(jQuery)})(function(b,a){function c(a,c,d,e){for(var f=[],g=0;g<a.length;g++){var h=a[g];if(h){var k=tinycolor(h),l=0.5>k.toHsl().l?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light",l=l+(tinycolor.equals(c,h)?" sp-thumb-active":""),h=k.toString(e.preferredFormat||"rgb"),n=p?"background-color:"+k.toRgbString():"filter:"+k.toFilter();f.push('<span title="'+
h+'" data-color="'+k.toRgbString()+'" class="'+l+'"><span class="sp-thumb-inner" style="'+n+';" /></span>')}else f.push(b("<div />").append(b('<span data-color="" style="background-color:transparent;" class="sp-clear-display"></span>').attr("title",e.noColorSelectedText)).html())}return"<div class='sp-cf "+d+"'>"+f.join("")+"</div>"}function e(a,c){var d=b.extend({},n,a);d.callbacks={move:k(d.move,c),change:k(d.change,c),show:k(d.show,c),hide:k(d.hide,c),beforeShow:k(d.beforeShow,c)};return d}function d(d,
g){function k(){t.showPaletteOnly&&(t.showPalette=!0);Ia.text(t.showPaletteOnly?t.togglePaletteMoreText:t.togglePaletteLessText);if(t.palette){za=t.palette.slice(0);qa=b.isArray(za[0])?za:[za];Aa={};for(var a=0;a<qa.length;a++)for(var c=0;c<qa[a].length;c++){var d=tinycolor(qa[a][c]).toRgbString();Aa[d]=!0}}A.toggleClass("sp-flat",V);A.toggleClass("sp-input-disabled",!t.showInput);A.toggleClass("sp-alpha-enabled",t.showAlpha);A.toggleClass("sp-clear-enabled",ha);A.toggleClass("sp-buttons-disabled",
!t.showButtons);A.toggleClass("sp-palette-buttons-disabled",!t.togglePaletteOnly);A.toggleClass("sp-palette-disabled",!t.showPalette);A.toggleClass("sp-palette-only",t.showPaletteOnly);A.toggleClass("sp-initial-disabled",!t.showInitial);A.addClass(t.className).addClass(t.containerClassName);R()}function n(){if(w&&window.localStorage){try{var a=window.localStorage[w].split(",#");1<a.length&&(delete window.localStorage[w],b.each(a,function(b,a){z(a)}))}catch(c){}try{W=window.localStorage[w].split(";")}catch(d){}}}
function z(a){if(aa){a=tinycolor(a).toRgbString();if(!Aa[a]&&-1===b.inArray(a,W))for(W.push(a);W.length>Xa;)W.shift();if(w&&window.localStorage)try{window.localStorage[w]=W.join(";")}catch(c){}}}function T(){var b=[];if(t.showPalette)for(var a=0;a<W.length;a++){var c=tinycolor(W[a]).toRgbString();Aa[c]||b.push(W[a])}return b.reverse().slice(0,t.maxSelectionSize)}function F(){var a=P(),d=b.map(qa,function(b,d){return c(b,a,"sp-palette-row sp-palette-row-"+d,t)});n();W&&d.push(c(T(),a,"sp-palette-row sp-palette-row-selection",
t));Pa.html(d.join(""))}function s(){if(t.showInitial){var b=ia,a=P();Qa.html(c([b,a],a,"sp-palette-row-initial",t))}}function J(){(0>=U||0>=M||0>=Ba)&&R();A.addClass(Ra);ca=null;K.trigger("dragstart.spectrum",[P()])}function y(){A.removeClass(Ra);K.trigger("dragstop.spectrum",[P()])}function S(){var b=da.val();null!==b&&""!==b||!ha?(b=tinycolor(b),b.isValid()?(Z(b),Q(!0)):da.addClass("sp-validation-error")):(Z(null),Q(!0))}function ka(){v?fa():la()}function la(){var a=b.Event("beforeShow.spectrum");
if(v)R();else if(K.trigger(a,[P()]),!1!==D.beforeShow(P())&&!a.isDefaultPrevented()){for(a=0;a<r.length;a++)r[a]&&r[a].hide();v=!0;b(Ja).bind("click.spectrum",pa);b(window).bind("resize.spectrum",ba);na.addClass("sp-active");A.removeClass("sp-hidden");R();Y();ia=P();s();D.show(ia);K.trigger("show.spectrum",[ia])}}function pa(b){2!=b.button&&(Ya?Q(!0):Z(ia,!0),fa())}function fa(){v&&!V&&(v=!1,b(Ja).unbind("click.spectrum",pa),b(window).unbind("resize.spectrum",ba),na.removeClass("sp-active"),A.addClass("sp-hidden"),
D.hide(P()),K.trigger("hide.spectrum",[P()]))}function Z(b,a){if(tinycolor.equals(b,P()))Y();else{var c,d;!b&&ha?ea=!0:(ea=!1,c=tinycolor(b),d=c.toHsv(),ra=d.h%360/360,sa=d.s,ta=d.v,X=d.a);Y();c&&(c.isValid()&&!a)&&(ua=Ka||c.getFormat())}}function P(b){b=b||{};return ha&&ea?null:tinycolor.fromRatio({h:ra,s:sa,v:ta,a:Math.round(100*X)/100},{format:b.format||ua})}function ma(){Y();D.move(P());K.trigger("move.spectrum",[P()])}function Y(){da.removeClass("sp-validation-error");G();var b=tinycolor.fromRatio({h:ra,
s:1,v:1});Ca.css("background-color",b.toHexString());b=ua;!(1>X)||0===X&&"name"===b||"hex"!==b&&"hex3"!==b&&"hex6"!==b&&"name"!==b||(b="rgb");var a=P({format:b}),c="";oa.removeClass("sp-clear-display");oa.css("background-color","transparent");if(!a&&ha)oa.addClass("sp-clear-display");else{var c=a.toHexString(),d=a.toRgbString();p||1===a.alpha?oa.css("background-color",d):(oa.css("background-color","transparent"),oa.css("filter",a.toFilter()));if(t.showAlpha){d=a.toRgb();d.a=0;var d=tinycolor(d).toRgbString(),
e="linear-gradient(left, "+d+", "+c+")";q?va.css("filter",tinycolor(d).toFilter({gradientType:1},c)):(va.css("background","-webkit-"+e),va.css("background","-moz-"+e),va.css("background","-ms-"+e),va.css("background","linear-gradient(to right, "+d+", "+c+")"))}c=a.toString(b)}t.showInput&&da.val(c);t.showPalette&&F();s()}function G(){var b=sa,a=ta;ha&&ea?(Da.hide(),Ea.hide(),Fa.hide()):(Da.show(),Ea.show(),Fa.show(),b*=M,a=U-a*U,b=Math.max(-N,Math.min(M-N,b-N)),a=Math.max(-N,Math.min(U-N,a-N)),Fa.css({top:a+
"px",left:b+"px"}),Da.css({left:X*ja-Sa/2+"px"}),Ea.css({top:ra*Ba-Ta+"px"}))}function Q(b){var a=P(),c="",d=!tinycolor.equals(a,ia);a&&(c=a.toString(ua),z(a));Ga&&K.val(c);b&&d&&(D.change(a),K.trigger("change",[a]))}function R(){M=Ca.width();U=Ca.height();N=Fa.height();La.width();Ba=La.height();Ta=Ea.height();ja=Ua.width();Sa=Da.width();V||(A.css("position","absolute"),t.offset?A.offset(t.offset):A.offset(f(A,wa)));G();t.showPalette&&F();K.trigger("reflow.spectrum")}function ya(){fa();Ma=!0;K.attr("disabled",
!0);wa.addClass("sp-disabled")}var t=e(g,d),V=t.flat,aa=t.showSelectionPalette,w=t.localStorageKey,O=t.theme,D=t.callbacks,ba=m(R,10),v=!1,M=0,U=0,N=0,Ba=0,ja=0,Sa=0,Ta=0,ra=0,sa=0,ta=0,X=1,za=[],qa=[],Aa={},W=t.selectionPalette.slice(0),Xa=t.maxSelectionSize,Ra="sp-dragging",ca=null,Ja=d.ownerDocument,K=b(d),Ma=!1,A=b(L,Ja).addClass(O),Za=A.find(".sp-picker-container"),Ca=A.find(".sp-color"),Fa=A.find(".sp-dragger"),La=A.find(".sp-hue"),Ea=A.find(".sp-slider"),va=A.find(".sp-alpha-inner"),Ua=A.find(".sp-alpha"),
Da=A.find(".sp-alpha-handle"),da=A.find(".sp-input"),Pa=A.find(".sp-palette"),Qa=A.find(".sp-initial"),Va=A.find(".sp-cancel"),Na=A.find(".sp-clear"),Wa=A.find(".sp-choose"),Ia=A.find(".sp-palette-toggle"),Ga=K.is("input"),$a=Ga&&u&&"color"===K.attr("type"),Oa=Ga&&!V,na=Oa?b(B).addClass(O).addClass(t.className).addClass(t.replacerClassName):b([]),wa=Oa?na:K,oa=na.find(".sp-preview-inner"),xa=t.color||Ga&&K.val(),ia=!1,Ka=t.preferredFormat,ua=Ka,Ya=!t.showButtons||t.clickoutFiresChange,ea=!xa,ha=t.allowEmpty&&
!$a;(function(){function a(c){c.data&&c.data.ignore?(Z(b(c.target).closest(".sp-thumb-el").data("color")),ma()):(Z(b(c.target).closest(".sp-thumb-el").data("color")),ma(),Q(!0),t.hideAfterPaletteSelect&&fa());return!1}q&&A.find("*:not(input)").attr("unselectable","on");k();Oa&&K.after(na).hide();ha||Na.hide();if(V)K.after(A).hide();else{var c="parent"===t.appendTo?K.parent():b(t.appendTo);1!==c.length&&(c=b("body"));c.append(A)}n();wa.bind("click.spectrum touchstart.spectrum",function(a){Ma||ka();
a.stopPropagation();b(a.target).is("input")||a.preventDefault()});(K.is(":disabled")||!0===t.disabled)&&ya();A.click(h);da.change(S);da.bind("paste",function(){setTimeout(S,1)});da.keydown(function(b){13==b.keyCode&&S()});Va.text(t.cancelText);Va.bind("click.spectrum",function(b){b.stopPropagation();b.preventDefault();Z(ia,!0);fa()});Na.attr("title",t.clearText);Na.bind("click.spectrum",function(b){b.stopPropagation();b.preventDefault();ea=!0;ma();V&&Q(!0)});Wa.text(t.chooseText);Wa.bind("click.spectrum",
function(b){b.stopPropagation();b.preventDefault();da.hasClass("sp-validation-error")||(Q(!0),fa())});Ia.text(t.showPaletteOnly?t.togglePaletteMoreText:t.togglePaletteLessText);Ia.bind("click.spectrum",function(b){b.stopPropagation();b.preventDefault();t.showPaletteOnly=!t.showPaletteOnly;t.showPaletteOnly||V||A.css("left","-="+(Za.outerWidth(!0)+5));k()});l(Ua,function(b,a,c){X=b/ja;ea=!1;c.shiftKey&&(X=Math.round(10*X)/10);ma()},J,y);l(La,function(b,a){ra=parseFloat(a/Ba);ea=!1;t.showAlpha||(X=
1);ma()},J,y);l(Ca,function(b,a,c){c.shiftKey?ca||(c=U-ta*U,ca=Math.abs(b-sa*M)>Math.abs(a-c)?"x":"y"):ca=null;c=!ca||"y"===ca;ca&&"x"!==ca||(sa=parseFloat(b/M));c&&(ta=parseFloat((U-a)/U));ea=!1;t.showAlpha||(X=1);ma()},J,y);xa?(Z(xa),Y(),ua=Ka||tinycolor(xa).format,z(xa)):Y();V&&la();c=q?"mousedown.spectrum":"click.spectrum touchstart.spectrum";Pa.delegate(".sp-thumb-el",c,a);Qa.delegate(".sp-thumb-el:nth-child(1)",c,{ignore:!0},a)})();var Ha={show:la,hide:fa,toggle:ka,reflow:R,option:function(c,
d){if(c===a)return b.extend({},t);if(d===a)return t[c];t[c]=d;k()},enable:function(){Ma=!1;K.attr("disabled",!1);wa.removeClass("sp-disabled")},disable:ya,offset:function(b){t.offset=b;R()},set:function(b){Z(b);Q()},get:P,destroy:function(){K.show();wa.unbind("click.spectrum touchstart.spectrum");A.remove();na.remove();r[Ha.id]=null},container:A};Ha.id=r.push(Ha)-1;return Ha}function f(a,c){var d=a.outerWidth(),e=a.outerHeight(),f=c.outerHeight(),g=a[0].ownerDocument,h=g.documentElement,k=h.clientWidth+
b(g).scrollLeft(),g=h.clientHeight+b(g).scrollTop(),h=c.offset();h.top+=f;h.left-=Math.min(h.left,h.left+d>k&&k>d?Math.abs(h.left+d-k):0);h.top-=Math.min(h.top,h.top+e>g&&g>e?Math.abs(e+f-0):0);return h}function g(){}function h(b){b.stopPropagation()}function k(b,a){var c=Array.prototype.slice,d=c.call(arguments,2);return function(){return b.apply(a,d.concat(c.call(arguments)))}}function l(a,c,d,e){function f(b){b.stopPropagation&&b.stopPropagation();b.preventDefault&&b.preventDefault();b.returnValue=
!1}function g(b){if(p){if(q&&9>k.documentMode&&!b.button)return h();var d=b.originalEvent&&b.originalEvent.touches,e=d?d[0].pageY:b.pageY,d=Math.max(0,Math.min((d?d[0].pageX:b.pageX)-l.left,m)),e=Math.max(0,Math.min(e-l.top,n));u&&f(b);c.apply(a,[d,e,b])}}function h(){p&&(b(k).unbind(r),b(k.body).removeClass("sp-dragging"),e.apply(a,arguments));p=!1}c=c||function(){};d=d||function(){};e=e||function(){};var k=document,p=!1,l={},n=0,m=0,u="ontouchstart"in window,r={};r.selectstart=f;r.dragstart=f;r["touchmove mousemove"]=
g;r["touchend mouseup"]=h;b(a).bind("touchstart mousedown",function(c){(c.which?3==c.which:2==c.button)||p||!1===d.apply(a,arguments)||(p=!0,n=b(a).height(),m=b(a).width(),l=b(a).offset(),b(k).bind(r),b(k.body).addClass("sp-dragging"),u||g(c),f(c))})}function m(b,a,c){var d;return function(){var e=this,f=arguments,g=function(){d=null;b.apply(e,f)};c&&clearTimeout(d);if(c||!d)d=setTimeout(g,a)}}var n={beforeShow:g,move:g,change:g,show:g,hide:g,color:!1,flat:!1,showInput:!1,allowEmpty:!1,showButtons:!0,
clickoutFiresChange:!1,showInitial:!1,showPalette:!1,showPaletteOnly:!1,hideAfterPaletteSelect:!1,togglePaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",togglePaletteMoreText:"more",togglePaletteLessText:"less",clearText:"Clear Color Selection",noColorSelectedText:"No Color Selected",preferredFormat:!1,className:"",containerClassName:"",replacerClassName:"",showAlpha:!1,theme:"sp-light",palette:["#ffffff #000000 #ff0000 #ff8000 #ffff00 #008000 #0000ff #4b0082 #9400d3".split(" ")],
selectionPalette:[],disabled:!1,offset:null},r=[],q=!!/msie/i.exec(window.navigator.userAgent),p=function(){var b=document.createElement("div").style;b.cssText="background-color:rgba(0,0,0,.5)";return!!~(""+b.backgroundColor).indexOf("rgba")||!!~(""+b.backgroundColor).indexOf("hsla")}(),u=function(){var a=b("<input type='color' value='!' />")[0];return"color"===a.type&&"!"!==a.value}(),B="<div class='sp-replacer'><div class='sp-preview'><div class='sp-preview-inner'></div></div><div class='sp-dd'>&#9660;</div></div>",
L=function(){var b="";if(q)for(var a=1;6>=a;a++)b+="<div class='sp-"+a+"'></div>";return["<div class='sp-container sp-hidden'><div class='sp-palette-container'><div class='sp-palette sp-thumb sp-cf'></div><div class='sp-palette-button-container sp-cf'><button type='button' class='sp-palette-toggle'></button></div></div><div class='sp-picker-container'><div class='sp-top sp-cf'><div class='sp-fill'></div><div class='sp-top-inner'><div class='sp-color'><div class='sp-sat'><div class='sp-val'><div class='sp-dragger'></div></div></div></div><div class='sp-clear sp-clear-display'></div><div class='sp-hue'><div class='sp-slider'></div>",
b,"</div></div><div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div></div><div class='sp-input-container sp-cf'><input class='sp-input' type='text' spellcheck='false'  /></div><div class='sp-initial sp-thumb sp-cf'></div><div class='sp-button-container sp-cf'><a class='sp-cancel' href='#'></a><button type='button' class='sp-choose'></button></div></div></div>"].join("")}();b.fn.spectrum=function(a,c){if("string"==typeof a){var e=this,f=Array.prototype.slice.call(arguments,
1);this.each(function(){var c=r[b(this).data("spectrum.id")];if(c){var d=c[a];if(!d)throw Error("Spectrum: no such method: '"+a+"'");"get"==a?e=c.get():"container"==a?e=c.container:"option"==a?e=c.option.apply(c,f):"destroy"==a?(c.destroy(),b(this).removeData("spectrum.id")):d.apply(c,f)}});return e}return this.spectrum("destroy").each(function(){var c=b.extend({},a,b(this).data()),c=d(this,c);b(this).data("spectrum.id",c.id)})};b.fn.spectrum.load=!0;b.fn.spectrum.loadOpts={};b.fn.spectrum.draggable=
l;b.fn.spectrum.defaults=n;b.spectrum={};b.spectrum.localization={};b.spectrum.palettes={};b.fn.spectrum.processNativeColorInputs=function(){u||b("input[type=color]").spectrum({preferredFormat:"hex6"})};(function(){function b(a,c,d){a=G(a,255);c=G(c,255);d=G(d,255);var e=D(a,c,d),f=O(a,c,d),g,h=(e+f)/2;if(e==f)g=f=0;else{var k=e-f,f=0.5<h?k/(2-e-f):k/(e+f);switch(e){case a:g=(c-d)/k+(c<d?6:0);break;case c:g=(d-a)/k+2;break;case d:g=(a-c)/k+4}g/=6}return{h:g,s:f,l:h}}function a(b,c,d){function e(b,
a,c){0>c&&(c+=1);1<c&&(c-=1);return c<1/6?b+6*(a-b)*c:0.5>c?a:c<2/3?b+6*(a-b)*(2/3-c):b}b=G(b,360);c=G(c,100);d=G(d,100);if(0===c)d=c=b=d;else{var f=0.5>d?d*(1+c):d+c-d*c,g=2*d-f;d=e(g,f,b+1/3);c=e(g,f,b);b=e(g,f,b-1/3)}return{r:255*d,g:255*c,b:255*b}}function c(b,a,d){b=G(b,255);a=G(a,255);d=G(d,255);var e=D(b,a,d),f=O(b,a,d),g,h=e-f;if(e==f)g=0;else{switch(e){case b:g=(a-d)/h+(a<d?6:0);break;case a:g=(d-b)/h+2;break;case d:g=(b-a)/h+4}g/=6}return{h:g,s:0===e?0:h/e,v:e}}function d(b,a,c,e){b=[Q(w(b).toString(16)),
Q(w(a).toString(16)),Q(w(c).toString(16))];return e&&b[0].charAt(0)==b[0].charAt(1)&&b[1].charAt(0)==b[1].charAt(1)&&b[2].charAt(0)==b[2].charAt(1)?b[0].charAt(0)+b[1].charAt(0)+b[2].charAt(0):b.join("")}function e(b,a,c,d){return[Q(Math.round(255*parseFloat(d)).toString(16)),Q(w(b).toString(16)),Q(w(a).toString(16)),Q(w(c).toString(16))].join("")}function f(b,a){a=0===a?0:a||10;var c=v(b).toHsl();c.s-=a/100;c.s=O(1,D(0,c.s));return v(c)}function g(b,a){a=0===a?0:a||10;var c=v(b).toHsl();c.s+=a/100;
c.s=O(1,D(0,c.s));return v(c)}function h(b){return v(b).desaturate(100)}function k(b,a){a=0===a?0:a||10;var c=v(b).toHsl();c.l+=a/100;c.l=O(1,D(0,c.l));return v(c)}function p(b,a){a=0===a?0:a||10;var c=v(b).toRgb();c.r=D(0,O(255,c.r-w(255*-(a/100))));c.g=D(0,O(255,c.g-w(255*-(a/100))));c.b=D(0,O(255,c.b-w(255*-(a/100))));return v(c)}function l(b,a){a=0===a?0:a||10;var c=v(b).toHsl();c.l-=a/100;c.l=O(1,D(0,c.l));return v(c)}function n(b,a){var c=v(b).toHsl(),d=(w(c.h)+a)%360;c.h=0>d?360+d:d;return v(c)}
function m(b){b=v(b).toHsl();b.h=(b.h+180)%360;return v(b)}function q(b){var a=v(b).toHsl(),c=a.h;return[v(b),v({h:(c+120)%360,s:a.s,l:a.l}),v({h:(c+240)%360,s:a.s,l:a.l})]}function u(b){var a=v(b).toHsl(),c=a.h;return[v(b),v({h:(c+90)%360,s:a.s,l:a.l}),v({h:(c+180)%360,s:a.s,l:a.l}),v({h:(c+270)%360,s:a.s,l:a.l})]}function r(b){var a=v(b).toHsl(),c=a.h;return[v(b),v({h:(c+72)%360,s:a.s,l:a.l}),v({h:(c+216)%360,s:a.s,l:a.l})]}function L(b,a,c){a=a||6;c=c||30;var d=v(b).toHsl();c=360/c;b=[v(b)];for(d.h=
(d.h-(c*a>>1)+720)%360;--a;)d.h=(d.h+c)%360,b.push(v(d));return b}function B(b,a){a=a||6;for(var c=v(b).toHsv(),d=c.h,e=c.s,c=c.v,f=[],g=1/a;a--;)f.push(v({h:d,s:e,v:c})),c=(c+g)%1;return f}function Y(b){b=parseFloat(b);if(isNaN(b)||0>b||1<b)b=1;return b}function G(b,a){"string"==typeof b&&(-1!=b.indexOf(".")&&1===parseFloat(b))&&(b="100%");var c="string"===typeof b&&-1!=b.indexOf("%");b=O(a,D(0,parseFloat(b)));c&&(b=parseInt(b*a,10)/100);return 1E-6>aa.abs(b-a)?1:b%a/parseFloat(a)}function Q(b){return 1==
b.length?"0"+b:""+b}function R(b){1>=b&&(b=100*b+"%");return b}var ya=/^[\s,#]+/,t=/\s+$/,V=0,aa=Math,w=aa.round,O=aa.min,D=aa.max,ba=aa.random,v=function ja(b,c){var d,e,f,g,h;b=b?b:"";c=c||{};if(b instanceof ja)return b;if(!(this instanceof ja))return new ja(b,c);e=b;h={r:0,g:0,b:0};var k=1;f=d=!1;if("string"==typeof e)a:{e=e.replace(ya,"").replace(t,"").toLowerCase();var p=!1;if(M[e])e=M[e],p=!0;else if("transparent"==e){e={r:0,g:0,b:0,a:0,format:"name"};break a}e=(g=N.rgb.exec(e))?{r:g[1],g:g[2],
b:g[3]}:(g=N.rgba.exec(e))?{r:g[1],g:g[2],b:g[3],a:g[4]}:(g=N.hsl.exec(e))?{h:g[1],s:g[2],l:g[3]}:(g=N.hsla.exec(e))?{h:g[1],s:g[2],l:g[3],a:g[4]}:(g=N.hsv.exec(e))?{h:g[1],s:g[2],v:g[3]}:(g=N.hsva.exec(e))?{h:g[1],s:g[2],v:g[3],a:g[4]}:(g=N.hex8.exec(e))?{a:parseInt(g[1],16)/255,r:parseInt(g[2],16),g:parseInt(g[3],16),b:parseInt(g[4],16),format:p?"name":"hex8"}:(g=N.hex6.exec(e))?{r:parseInt(g[1],16),g:parseInt(g[2],16),b:parseInt(g[3],16),format:p?"name":"hex"}:(g=N.hex3.exec(e))?{r:parseInt(g[1]+
""+g[1],16),g:parseInt(g[2]+""+g[2],16),b:parseInt(g[3]+""+g[3],16),format:p?"name":"hex"}:!1}if("object"==typeof e){if(e.hasOwnProperty("r")&&e.hasOwnProperty("g")&&e.hasOwnProperty("b"))h={r:255*G(e.r,255),g:255*G(e.g,255),b:255*G(e.b,255)},d=!0,f="%"===String(e.r).substr(-1)?"prgb":"rgb";else if(e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("v")){e.s=R(e.s);e.v=R(e.v);f=e.h;p=e.s;h=e.v;f=6*G(f,360);p=G(p,100);h=G(h,100);d=aa.floor(f);var l=f-d;f=h*(1-p);g=h*(1-l*p);p=h*(1-(1-l)*
p);d%=6;h={r:255*[h,g,f,f,p,h][d],g:255*[p,h,h,g,f,f][d],b:255*[f,f,p,h,h,g][d]};d=!0;f="hsv"}else e.hasOwnProperty("h")&&(e.hasOwnProperty("s")&&e.hasOwnProperty("l"))&&(e.s=R(e.s),e.l=R(e.l),h=a(e.h,e.s,e.l),d=!0,f="hsl");e.hasOwnProperty("a")&&(k=e.a)}k=Y(k);e=e.format||f;f=O(255,D(h.r,0));g=O(255,D(h.g,0));h=O(255,D(h.b,0));this._originalInput=b;this._r=f;this._g=g;this._b=h;this._a=k;this._roundA=w(100*this._a)/100;this._format=c.format||e;this._gradientType=c.gradientType;1>this._r&&(this._r=
w(this._r));1>this._g&&(this._g=w(this._g));1>this._b&&(this._b=w(this._b));this._ok=d;this._tc_id=V++};v.prototype={isDark:function(){return 128>this.getBrightness()},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var b=this.toRgb();return(299*b.r+587*b.g+114*b.b)/1E3},setAlpha:function(b){this._a=Y(b);this._roundA=
w(100*this._a)/100;return this},toHsv:function(){var b=c(this._r,this._g,this._b);return{h:360*b.h,s:b.s,v:b.v,a:this._a}},toHsvString:function(){var b=c(this._r,this._g,this._b),a=w(360*b.h),d=w(100*b.s),b=w(100*b.v);return 1==this._a?"hsv("+a+", "+d+"%, "+b+"%)":"hsva("+a+", "+d+"%, "+b+"%, "+this._roundA+")"},toHsl:function(){var a=b(this._r,this._g,this._b);return{h:360*a.h,s:a.s,l:a.l,a:this._a}},toHslString:function(){var a=b(this._r,this._g,this._b),c=w(360*a.h),d=w(100*a.s),a=w(100*a.l);return 1==
this._a?"hsl("+c+", "+d+"%, "+a+"%)":"hsla("+c+", "+d+"%, "+a+"%, "+this._roundA+")"},toHex:function(b){return d(this._r,this._g,this._b,b)},toHexString:function(b){return"#"+this.toHex(b)},toHex8:function(){return e(this._r,this._g,this._b,this._a)},toHex8String:function(){return"#"+this.toHex8()},toRgb:function(){return{r:w(this._r),g:w(this._g),b:w(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+w(this._r)+", "+w(this._g)+", "+w(this._b)+")":"rgba("+w(this._r)+", "+w(this._g)+
", "+w(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:w(100*G(this._r,255))+"%",g:w(100*G(this._g,255))+"%",b:w(100*G(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+w(100*G(this._r,255))+"%, "+w(100*G(this._g,255))+"%, "+w(100*G(this._b,255))+"%)":"rgba("+w(100*G(this._r,255))+"%, "+w(100*G(this._g,255))+"%, "+w(100*G(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":1>this._a?!1:U[d(this._r,this._g,
this._b,!0)]||!1},toFilter:function(b){var a="#"+e(this._r,this._g,this._b,this._a),c=a,d=this._gradientType?"GradientType = 1, ":"";b&&(c=v(b).toHex8String());return"progid:DXImageTransform.Microsoft.gradient("+d+"startColorstr="+a+",endColorstr="+c+")"},toString:function(b){var a=!!b;b=b||this._format;var c=!1,d=1>this._a&&0<=this._a;if(!a&&d&&("hex"===b||"hex6"===b||"hex3"===b||"name"===b))return"name"===b&&0===this._a?this.toName():this.toRgbString();"rgb"===b&&(c=this.toRgbString());"prgb"===
b&&(c=this.toPercentageRgbString());if("hex"===b||"hex6"===b)c=this.toHexString();"hex3"===b&&(c=this.toHexString(!0));"hex8"===b&&(c=this.toHex8String());"name"===b&&(c=this.toName());"hsl"===b&&(c=this.toHslString());"hsv"===b&&(c=this.toHsvString());return c||this.toHexString()},_applyModification:function(b,a){var c=b.apply(null,[this].concat([].slice.call(a)));this._r=c._r;this._g=c._g;this._b=c._b;this.setAlpha(c._a);return this},lighten:function(){return this._applyModification(k,arguments)},
brighten:function(){return this._applyModification(p,arguments)},darken:function(){return this._applyModification(l,arguments)},desaturate:function(){return this._applyModification(f,arguments)},saturate:function(){return this._applyModification(g,arguments)},greyscale:function(){return this._applyModification(h,arguments)},spin:function(){return this._applyModification(n,arguments)},_applyCombination:function(b,a){return b.apply(null,[this].concat([].slice.call(a)))},analogous:function(){return this._applyCombination(L,
arguments)},complement:function(){return this._applyCombination(m,arguments)},monochromatic:function(){return this._applyCombination(B,arguments)},splitcomplement:function(){return this._applyCombination(r,arguments)},triad:function(){return this._applyCombination(q,arguments)},tetrad:function(){return this._applyCombination(u,arguments)}};v.fromRatio=function(b,a){if("object"==typeof b){var c={},d;for(d in b)b.hasOwnProperty(d)&&(c[d]="a"===d?b[d]:R(b[d]));b=c}return v(b,a)};v.equals=function(b,
a){return b&&a?v(b).toRgbString()==v(a).toRgbString():!1};v.random=function(){return v.fromRatio({r:ba(),g:ba(),b:ba()})};v.mix=function(b,a,c){c=0===c?0:c||50;b=v(b).toRgb();a=v(a).toRgb();c/=100;var d=2*c-1,e=a.a-b.a,d=((-1==d*e?d:(d+e)/(1+d*e))+1)/2,e=1-d;return v({r:a.r*d+b.r*e,g:a.g*d+b.g*e,b:a.b*d+b.b*e,a:a.a*c+b.a*(1-c)})};v.readability=function(b,a){var c=v(b),d=v(a),e=c.toRgb(),f=d.toRgb(),c=c.getBrightness(),d=d.getBrightness(),e=Math.max(e.r,f.r)-Math.min(e.r,f.r)+Math.max(e.g,f.g)-Math.min(e.g,
f.g)+Math.max(e.b,f.b)-Math.min(e.b,f.b);return{brightness:Math.abs(c-d),color:e}};v.isReadable=function(b,a){var c=v.readability(b,a);return 125<c.brightness&&500<c.color};v.mostReadable=function(b,a){for(var c=null,d=0,e=!1,f=0;f<a.length;f++){var g=v.readability(b,a[f]),h=125<g.brightness&&500<g.color,g=3*(g.brightness/125)+g.color/500;if(h&&!e||h&&e&&g>d||!h&&!e&&g>d)e=h,d=g,c=v(a[f])}return c};var M=v.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",
beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",
darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",
indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",
magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",
paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",
thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},U=v.hexNames=function(b){var a={},c;for(c in b)b.hasOwnProperty(c)&&(a[b[c]]=c);return a}(M),N={rgb:RegExp("rgb[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),rgba:RegExp("rgba[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),
hsl:RegExp("hsl[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),hsla:RegExp("hsla[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),hsv:RegExp("hsv[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),
hsva:RegExp("hsva[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex8:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};window.tinycolor=v})();b(function(){b.fn.spectrum.load&&b.fn.spectrum.processNativeColorInputs()})});
function Paint(b,a){this.eventHandlers={};this.settings=this.utils.merge(this.utils.copy(a),this.defaultSettings);this.container=b;this.boundingBoxList=[];this.scale=[1,1];this.rotation=0;this.favoritesContainer=null;this.addCanvas(b);this.resize();this.controlContainer=b.appendChild(document.createElement("div"));this.controlContainer.className="control-container";this.controls=new Controls(this.controlContainer,this.createControlArray());this.addCoordDom(b);this.changeTool("brush");this.setColor(new tinycolor);
this.changeToolSize(5,!0);$(this.controls.byName["tool-color"].input).spectrum("set",this.current_color);this.localDrawings=[];this.paths={};this.localUserPaths=[];this.publicdrawings=[];window.addEventListener("resize",this.resize.bind(this));window.addEventListener("keypress",this.keypress.bind(this));window.addEventListener("keydown",this.keydown.bind(this));window.addEventListener("keyup",this.keyup.bind(this))}Paint.prototype.MAX_RANDOM_COORDS=65536;
Paint.prototype.defaultSettings={maxSize:50,maxLineLength:200};Paint.prototype.defaultShortcuts={};
Paint.prototype.redrawAll=function(){for(var b=0;b<this.canvasArray.length;b++){var a=this.canvasArray[b].getContext("2d");a.save();a.setTransform(1,0,0,1,0,0);a.clearRect(0,0,a.canvas.width,a.canvas.height);a.restore();a.setTransform(this.scale[0],0,0,this.scale[1],this.canvasArray[b].width/2,this.canvasArray[b].height/2);a.rotate(this.rotation*Math.PI/180);a.translate(-this.canvasArray[b].width/2,-this.canvasArray[b].height/2)}this.background.redrawOnce();this.public.redrawOnce();this.local.redrawOnce();
this.redrawPaths()};Paint.prototype.setHorizontalMirror=function(b){this.scale[0]=b?-1:1;this.redrawAll();this.dispatchEvent({type:"canvaschange",rotation:this.rotation,scale:this.scale})};Paint.prototype.setVerticalMirror=function(b){this.scale[1]=b?-1:1;this.redrawAll();this.dispatchEvent({type:"canvaschange",rotation:this.rotation,scale:this.scale})};Paint.prototype.setRotation=function(b){this.rotation=b%360;this.redrawAll();this.dispatchEvent({type:"canvaschange",rotation:this.rotation,scale:this.scale})};
Paint.prototype.addCanvas=function(b){var a=b.appendChild(this.createCanvas("background")),c=b.appendChild(this.createCanvas("public")),e=b.appendChild(this.createCanvas("local"));b=b.appendChild(this.createCanvas("effect"));var d=a.getContext("2d");d.mozImageSmoothingEnabled=!1;d.webkitImageSmoothingEnabled=!1;d.msImageSmoothingEnabled=!1;d.imageSmoothingEnabled=!1;this.background=new TiledCanvas(a);this.public=new TiledCanvas(c);this.public.requestUserChunk=function(b,a,c){c();this.background.requestChunk(b,
a)}.bind(this);this.local=new TiledCanvas(e);this.effectsCanvas=b;this.effectsCanvasCtx=b.getContext("2d");b.addEventListener("mousedown",this.exectool.bind(this));b.addEventListener("mousemove",this.exectool.bind(this));b.addEventListener("mouseup",this.exectool.bind(this));b.addEventListener("mouseleave",this.exectool.bind(this));b.addEventListener("touchstart",this.exectool.bind(this));b.addEventListener("touchmove",this.exectool.bind(this));b.addEventListener("touchend",this.exectool.bind(this));
this.canvasArray=[a,c,e,b];this.lastCanvas=e;this.pathCanvas=this.newCanvasOnTop("paths");this.pathContext=this.pathCanvas.getContext("2d")};
Paint.prototype.addCoordDom=function(b){this.coordDiv=b.appendChild(document.createElement("div"));this.coordDiv.className="mouse-coords";this.coordDiv.setAttribute("data-intro","Here you can jump to any coordinates you would like to see. The random button brings you to a random location.");this.coordDiv.appendChild(document.createTextNode("x:"));b=this.coordDiv.appendChild(document.createElement("input"));this.coordDiv.appendChild(document.createTextNode("y:"));var a=this.coordDiv.appendChild(document.createElement("input"));
b.type="number";a.type="number";b.min=-this.MAX_RANDOM_COORDS;a.min=-this.MAX_RANDOM_COORDS;b.max=this.MAX_RANDOM_COORDS;a.max=this.MAX_RANDOM_COORDS;b.addEventListener("input",function(b){this.goto(parseInt(b.target.value)-this.canvasArray[0].width/this.public.zoom/2||0,this.public.leftTopY)}.bind(this));a.addEventListener("input",function(b){this.goto(this.public.leftTopX,parseInt(b.target.value)-this.canvasArray[0].height/this.public.zoom/2||0)}.bind(this));b=this.coordDiv.appendChild(document.createElement("div"));
b.className="control-button random-button";a=b.appendChild(document.createElement("img"));a.src="images/icons/randomlocation.png";a.alt="Jump to random location";a.title="Jump to random location";b.addEventListener("click",function(){var b=this.MAX_RANDOM_COORDS;this.goto(2*Math.random()*b-b,2*Math.random()*b-b)}.bind(this));this.coordDiv.appendChild(document.createElement("span")).innerHTML="&nbsp;";b=this.coordDiv.appendChild(document.createElement("div"));b.className="control-button favorites-button";
a=b.appendChild(document.createElement("img"));a.src="images/icons/locations.png";a.alt="Open Favorites Menu";a.title="Open Favorites Menu";b.addEventListener("click",function(){$(".favorites-window").is(":visible")?$(".favorites-window").hide():(drawTogether.updateFavoriteDom(),$(".favorites-window").show())}.bind(this));b=this.coordDiv.appendChild(document.createElement("div"));b.className="favorites-window";this.favoritesContainer=b.appendChild(document.createElement("div"));this.favoritesContainer.className=
"favorites-container"};Paint.prototype.searchAndUpdateIndividualFavoriteDom=function(b,a,c,e,d,f,g,h){f=this.favoritesContainer.chindren;for(d=f.length;0<=d;d--)updateIndividualFavoriteDom(b,a,c,e,f[d])};
Paint.prototype.updateIndividualFavoriteDom=function(b,a,c,e,d){null!==b&&(d.dataset.x=b);null!==a&&(d.dataset.y=a);null!==c&&(d.dataset.name=c);null!==e&&(d.dataset.owner=e);e=d.getElementsByClassName("fav-coor-button")[0];var f=d.getElementsByClassName("fav-rename-input")[0];""===(c||d.dataset.name)?(f.value="",e.innerHTML=(b||d.dataset.x)+","+(a||d.dataset.y),e.title=""):(f.value=c||d.dataset.name,e.innerHTML=c||d.dataset.name,e.title=(b||d.dataset.x)+","+(a||d.dataset.y))};
Paint.prototype.insertOneFavorite=function(b,a,c,e){var d=this.favoritesContainer.appendChild(document.createElement("div"));d.className="favorite-container";d.dataset.x=b;d.dataset.y=a;d.dataset.name=c;d.dataset.owner=e;e=d.appendChild(document.createElement("div"));e.className="fav-button fav-minus-button";e.innerHTML="-";e.addEventListener("click",function(b){if(b.srcElement.classList.contains("fav-button-confirmation")){b.srcElement.classList.remove("fav-button-confirmation");var a=b.srcElement.parentElement;
drawTogether.removeFavorite(a.dataset.x,a.dataset.y,a.dataset.name,a)}else b.srcElement.classList.add("fav-button-confirmation"),b.srcElement.innerHTML="?",setTimeout(function(){b.srcElement.innerHTML="-";b.srcElement.classList.remove("fav-button-confirmation")}.bind(b.srcElement),4E3)}.bind(this));e=d.appendChild(document.createElement("div"));e.className="fav-button fav-plus-button";e.innerHTML="+";e.addEventListener("click",function(b){var a=[this.paint.public.canvas.width/this.paint.public.zoom,
this.paint.public.canvas.height/this.paint.public.zoom],c=b.srcElement.parentElement.dataset.x,d=b.srcElement.parentElement.dataset.y,e=b.srcElement.parentElement.dataset.name,m=parseInt(this.paint.public.leftTopX+a[0]/2),a=parseInt(this.paint.public.leftTopY+a[1]/2);console.log(m,a);b.srcElement.classList.contains("fav-button-confirmation")?(b.srcElement.classList.remove("fav-button-confirmation"),console.log("set"),this.setCoordFavorite(m,a,c,d,e,b.srcElement.parentElement)):(b.srcElement.classList.add("fav-button-confirmation"),
b.srcElement.innerHTML="?",setTimeout(function(){b.srcElement.innerHTML="+";b.srcElement.classList.remove("fav-button-confirmation")}.bind(b.srcElement),4E3))}.bind(drawTogether));e.addEventListener("mouseover",function(b){var a=[this.paint.public.canvas.width/this.paint.public.zoom,this.paint.public.canvas.height/this.paint.public.zoom],c=parseInt(this.paint.public.leftTopX+a[0]/2),a=parseInt(this.paint.public.leftTopY+a[1]/2);console.log(c,a);b.srcElement.title="Change to "+c+","+a+" ?"}.bind(drawTogether));
e=d.appendChild(document.createElement("div"));e.className="fav-button fav-pencil-button";e.innerHTML="\u270e";e=e.appendChild(document.createElement("div"));e.className="fav-rename-container";e=e.appendChild(document.createElement("input"));e.className="fav-rename-input";e.type="text";e.placeholder="Rename";e.addEventListener("input",function(b){void 0!==drawTogether._favoriteRenameDelayTimeout&&clearTimeout(drawTogether._favoriteRenameDelayTimeout);drawTogether._favoriteRenameDelayTimeout=setTimeout(function(){var b=
this.srcElement.parentElement.parentElement.parentElement;drawTogether.renameFavorite(b.dataset.x,b.dataset.y,this.srcElement.value,b)}.bind(b),1500)}.bind(this));d=d.appendChild(document.createElement("div"));d.className="fav-button fav-coor-button";d.addEventListener("click",function(b){var a=parseInt(b.srcElement.parentElement.dataset.x);b=parseInt(b.srcElement.parentElement.dataset.y);console.log(a,b);drawTogether.moveScreenToPosition([a,b],0)}.bind(this));0<c.length?(d.innerHTML=c,d.title=b+
","+a,e.value=c):d.innerHTML=b+","+a};
Paint.prototype.updateFavoriteDom=function(b){for(;this.favoritesContainer.firstChild;)this.favoritesContainer.removeChild(this.favoritesContainer.firstChild);var a=this.favoritesContainer.appendChild(document.createElement("div"));a.className="fav-button fav-add-new-fav";a.innerHTML="^";a.title="Add new Favorite.";a.addEventListener("click",function(b){drawTogether.createFavorite(0,0,"")}.bind(this));for(x=b.length-1;0<=x;x--)this.insertOneFavorite(b[x].x,b[x].y,b[x].name,b[x].owner)};
Paint.prototype.setMouseCoords=function(b,a){for(var c=!1,e=0;e<this.coordDiv.children.length;e++)if("number"==this.coordDiv.children[e].type){this.coordDiv.children[e].value=c?a.toFixed():b.toFixed();if(c)break;c=!0}};Paint.prototype.newCanvasOnTop=function(b){b=this.createCanvas(b||"foreign");this.lastCanvas.parentNode.insertBefore(b,this.lastCanvas.nextSibling);this.lastCanvas=b;this.canvasArray.push(b);b.leftTopX=this.public.leftTopX;b.leftTopY=this.public.leftTopY;this.resize();return b};
Paint.prototype.clear=function(){this.public.clearAll();this.background.clearAll();this.local.clearAll();this.paths={};this.localUserPaths=[];this.publicdrawings=[];this.goto(0,0)};
Paint.prototype.goto=function(b,a){"number"!==typeof b&&console.warn("worldX in goto was not a number!");"number"!==typeof a&&console.warn("worldY in goto was not a number!");b!==b&&console.warn("worldX was NaN");a!==a&&console.warn("worldY was NaN");this.background.goto(b,a);this.local.goto(b,a);this.public.goto(b,a);for(var c=0;c<this.canvasArray.length;c++)this.canvasArray[c].leftTopX=this.public.leftTopX,this.canvasArray[c].leftTopY=this.public.leftTopY;this.redrawPaths();this.dispatchEvent({type:"move",
leftTopX:b,leftTopY:a})};Paint.prototype.finalizeAll=function(b){this.drawDrawings("background",this.publicdrawings.slice(0,this.publicdrawings.length-(b||0)));this.publicdrawings.splice(0,this.publicdrawings.length-(b||0));this.public.clearAll();this.drawDrawings("public",this.publicdrawings)};Paint.prototype.createCanvas=function(b){var a=document.createElement("canvas");a.className="paint-canvas paint-canvas-"+b;return a};
Paint.prototype.resize=function(){for(var b=0;b<this.canvasArray.length;b++)this.canvasArray[b].width=this.canvasArray[b].offsetWidth,this.canvasArray[b].height=this.canvasArray[b].offsetHeight;this.redrawAll();for(b=0;b<this.boundingBoxList.length;b++)this.boundingBoxList[b].boundingBoxCache=this.boundingBoxList[b].getBoundingClientRect()};
Paint.prototype.keypress=function(b){var a=b.keyCode||b.which;b.target==document.body&&(console.log("Keypress",b),99==a&&(console.log("Pressed C, toggling color selector."),$(this.controls.byName["tool-color"].input).spectrum("toggle")),47<a&&58>a&&(b=a-48,this.setColor(tinycolor(this.current_color.toRgb()).setAlpha(b/9))),91!=a&&44!=a&&45!=a&&219!=a&&186!=a&&96!=a||this.changeToolSize(--this.current_size,!0),93!=a&&46!=a&&221!=a&&187!=a&&43!=a&&61!=a||this.changeToolSize(++this.current_size,!0),
114==a&&this.setRotation(this.rotation+1),101==a&&this.setRotation(this.rotation-1),109==a&&this.setHorizontalMirror(1==this.scale[0]),107==a&&this.setVerticalMirror(1==this.scale[1]),b={98:"brush",103:"grab",108:"line",112:"picker",116:"text",118:"picker",122:"zoom"},b[a]&&(console.log("Switching tool to "+b[a]),this.changeTool(b[a])))};
Paint.prototype.keydown=function(b){var a=b.keyCode||b.which;b.target==document.body&&(console.log("Keydown",b),27==a&&(this.setRotation(0),this.setHorizontalMirror(!1),this.setVerticalMirror(!1)),"grab"!==this.current_tool&&32==a&&(this.previous_tool=this.current_tool,this.changeTool("grab")),"picker"!==this.current_tool&&18==a&&(this.previous_tool=this.current_tool,this.changeTool("picker")),b.ctrlKey&&90==b.keyCode&&(this.undo(),b.preventDefault()))};
Paint.prototype.keyup=function(b){var a=b.keyCode||b.which;b.target==document.body&&(console.log("Keyup",b),"grab"==this.current_tool&&(32==a&&this.previous_tool)&&this.changeTool(this.previous_tool),"picker"==this.current_tool&&(18==a&&this.previous_tool)&&this.changeTool(this.previous_tool))};
Paint.prototype.exportImage=function(b,a){var c=document.createElement("canvas");c.width=Math.abs(b[0]-a[0]);c.height=Math.abs(b[1]-a[1]);this.background.drawToCanvas(c,b,a);this.public.drawToCanvas(c,b,a);return c.toDataURL()};Paint.prototype.redrawLocalDrawings=function(){this.redrawLocals()};Paint.prototype.redrawPaths=function(){this.redrawPathsTimeout&&100<Date.now()-this.lastPathRedraw||(this.redrawPathsTimeout=requestAnimationFrame(this._redrawPaths.bind(this)))};
Paint.prototype._redrawPaths=function(){this.pathContext.clearRect(0,0,this.pathContext.canvas.width,this.pathContext.canvas.height);delete this.redrawPathsTimeout;for(var b in this.paths)this.drawPath(this.paths[b]);for(b=0;b<this.localUserPaths.length;b++)this.drawPath(this.localUserPaths[b])};
Paint.prototype.drawPathTiledCanvas=function(b,a,c){var e=b.points[0][0],d=b.points[0][1],f=b.points[0][0],g=b.points[0][1];a.beginPath();a.moveTo(b.points[0][0],b.points[0][1]);for(var h=1;h<b.points.length;h++)a.lineTo(b.points[h][0],b.points[h][1]),e=Math.min(b.points[h][0],e),d=Math.min(b.points[h][1],d),f=Math.max(b.points[h][0],f),g=Math.max(b.points[h][1],g);a.strokeStyle=b.color.toRgbString();a.lineWidth=2*b.size;a.lineJoin="round";a.lineCap="round";a.stroke();c.drawingRegion(e,d,f,g,b.size);
c.execute()};
Paint.prototype.drawPath=function(b,a,c){a=a||this.pathContext;if(b.points&&b.points[0])if(c)this.drawPathTiledCanvas(b,a,c);else{a.beginPath();c=b.points[0][0]-this.public.leftTopX;var e=b.points[0][1]-this.public.leftTopY;a.moveTo(c*this.public.zoom,e*this.public.zoom);for(var d=Infinity,f=-Infinity,g=1;g<b.points.length;g++)c=b.points[g][0]-this.public.leftTopX,e=b.points[g][1]-this.public.leftTopY,a.lineTo(c*this.public.zoom,e*this.public.zoom),c<d&&(d=c),c>f&&(f=c);if("gradient"==b.color.type){c=
a.createLinearGradient(d,0,f,0);for(e=0;e<b.color.length;e++)c.addColorStop(b.color[e].pos,b.color[e].color);a.strokeStyle=c}else b.color=tinycolor(b.color),a.strokeStyle=b.color.toRgbString();a.lineWidth=2*b.size*this.public.zoom;a.lineJoin="round";a.lineCap="round";a.stroke()}};Paint.prototype.redrawLocals=function(b){this.local.clearAll();this.localDrawings.forEach(this.drawDrawing.bind(this,"local"));this.local.redrawOnce()};
Paint.prototype.removeLocalDrawing=function(b){b=this.localDrawings.indexOf(b);this.localDrawings.splice(b,1);this.redrawLocalDrawings()};Paint.prototype.addPublicDrawings=function(b){for(var a=0;a<b.length;a++)this.addPublicDrawing(b[a])};Paint.prototype.addPublicDrawing=function(b){this.publicdrawings.push(b);this.drawDrawing("public",b)};
Paint.prototype.undodrawings=function(b,a){for(var c=this.publicdrawings.length-1;0<=c;c--)if(this.publicdrawings[c].id==b||this.publicdrawings[c].socketid==b)if(this.publicdrawings.splice(c,1),!a)break;this.public.clearAll();this.drawDrawings("public",this.publicdrawings)};Paint.prototype.undo=function(){this.dispatchEvent({type:"undo"})};Paint.prototype.addPath=function(b,a){this.paths[b]=a;this.paths[b].points=this.paths[b].points||[];this.redrawPaths()};
Paint.prototype.addPathPoint=function(b,a){this.paths[b]?(this.paths[b].points.push(a),this.redrawPaths()):console.error("Path ",b," not known. Can't add point.")};Paint.prototype.finalizePath=function(b){this.paths[b]&&(this.drawPath(this.paths[b],this.public.context,this.public),this.publicdrawings.push(this.paths[b]),this.removePath(b))};Paint.prototype.removePath=function(b){delete this.paths[b];this.redrawPaths()};
Paint.prototype.removePathPoint=function(b,a){for(var c=this.paths.points.length-1;0<=c;c++)if(this.paths.points[c]==a)return this.paths.points.splice(c,1),this.redrawPaths(),!0;return!1};Paint.prototype.addUserDrawing=function(b){this.drawDrawing("local",b);this.localDrawings.push(b);this.dispatchEvent({type:"userdrawing",drawing:b,removeDrawing:this.removeLocalDrawing.bind(this,b)})};
Paint.prototype.addUserPath=function(){this.localUserPaths.push({type:"path",color:this.current_color,size:this.current_size});this.dispatchEvent({type:"startuserpath",props:this.localUserPaths[this.localUserPaths.length-1]})};Paint.prototype.addUserPathPoint=function(b){var a=this.localUserPaths[this.localUserPaths.length-1];a.points=a.points||[];a.points.push(b);this.dispatchEvent({type:"userpathpoint",point:b,removePathPoint:this.removeUserPathPoint.bind(this,a,b)});this.redrawPaths()};
Paint.prototype.endUserPath=function(){this.dispatchEvent({type:"enduserpath",removePath:this.removeUserPath.bind(this,this.localUserPaths[this.localUserPaths.length-1])})};Paint.prototype.removeUserPathPoint=function(b,a){for(var c=0;c<b.points.length;c++)if(b.points[c]==a){b.points.splice(c,1);break}};
Paint.prototype.removeUserPath=function(b,a,c){b.socketid=c;this.publicdrawings.push(b);for(c=0;c<this.localUserPaths.length;c++)if(this.localUserPaths[c]==b)return a&&this.drawPath(b,this.public.context,this.public),this.localUserPaths.splice(c,1),this.redrawPaths(),!0;return!1};
Paint.prototype.drawDrawings=function(b,a){for(var c=0;c<a.length;c++)"function"==typeof this.drawFunctions[a[c].type]?this.drawFunctions[a[c].type].call(this,this[b].context,a[c],this[b]):a[c].points?this.drawFunctions.path.call(this,this[b].context,a[c],this[b]):console.error("Unkown drawing",a[c]);this[b].redrawOnce()};Paint.prototype.drawDrawing=function(b,a){this.drawFunctions[a.type].call(this,this[b].context,a,this[b]);this[b].redrawOnce()};
Paint.prototype.exectool=function(b){b&&"function"==typeof b.preventDefault&&b.preventDefault();if("function"==typeof this.tools[this.current_tool])this.tools[this.current_tool](this,b);if("object"==typeof b){var a=this.getCoords(b),a=this.scaledCoords(a,b);a[0]=this.local.leftTopX+a[0]/this.local.zoom;a[1]=this.local.leftTopY+a[1]/this.local.zoom;this.setMouseCoords(a[0],a[1])}document.activeElement&&document.activeElement!==this.textToolInput&&document.activeElement.blur()};
Paint.prototype.changeTool=function(b){this.exectool("remove");this.current_tool=b;this.effectsCanvasCtx.clearRect(0,0,this.effectsCanvas.width,this.effectsCanvas.height);for(var a in this.controls.byName)this.controls.byName[a].input.classList.remove("paint-selected-tool");this.controls.byName[b].input.classList.add("paint-selected-tool");this.exectool("setup")};
Paint.prototype._changeColor=function(b){this.current_color=tinycolor(b);this.currentColorMode="color";this.effectsCanvasCtx.clearRect(0,0,this.effectsCanvas.width,this.effectsCanvas.height)};Paint.prototype._changeGradient=function(b){this.current_color=b.stops;this.current_color.type="gradient";this.effectsCanvasCtx.clearRect(0,0,this.effectsCanvas.width,this.effectsCanvas.height)};
Paint.prototype.changeToolSize=function(b,a){if(!this.brushing&&(b>this.settings.maxSize&&(b=this.settings.maxSize),1>b&&(b=1),this.current_size=parseInt(b),this.effectsCanvasCtx.clearRect(0,0,this.effectsCanvas.width,this.effectsCanvas.height),a&&(this.controls.byName["tool-size"].input.value=b),this.lastMovePoint)){var c=this.effectsCanvasCtx;c.beginPath();c.arc(this.lastMovePoint[0],this.lastMovePoint[1],this.current_size*this.local.zoom,0,2*Math.PI,!0);c.fillStyle=this.current_color.toRgbString();
c.fill()}};Paint.prototype.setColor=function(b){this.brushing||(console.log(this.brushing),this._changeColor(b),$(this.controls.byName["tool-color"].input).spectrum("set",this.current_color))};
Paint.prototype.createControlArray=function(){return[{name:"grab",type:"button",image:"images/icons/grab.png",title:"Change tool to grab",value:"grab",action:this.changeTool.bind(this),data:{intro:"You can use this tool to move around."}},{name:"line",type:"button",image:"images/icons/line.png",title:"Change tool to line",value:"line",action:this.changeTool.bind(this),data:{intro:"With this tool you can make a line, the next one is a normal brush. You can also put text."}},{name:"brush",type:"button",
image:"images/icons/brush.png",title:"Change tool to brush",value:"brush",action:this.changeTool.bind(this)},{name:"text",type:"button",image:"images/icons/text.png",title:"Change tool to text",value:"text",action:this.changeTool.bind(this)},{name:"picker",type:"button",image:"images/icons/picker.png",title:"Change tool to picker",value:"picker",action:this.changeTool.bind(this),data:{intro:"Click on the canvas and your color will be changed to that value."}},{name:"zoom",type:"button",image:"images/icons/zoom.png",
title:"Change tool to zoom",value:"zoom",action:this.changeTool.bind(this),data:{intro:"Click and drag to zoom in to whatever is inside the box."}},{name:"select",type:"button",image:"images/icons/select.png",title:"Change tool to select",value:"select",action:this.changeTool.bind(this),data:{intro:"Click and drag to select an area."}},{name:"undo",type:"button",image:"images/icons/undo.png",title:"Undo drawing",action:this.undo.bind(this),data:{intro:"Made a mistake? No worry just click here!"}},
{name:"tool-size",type:"integer",range:!0,text:"Tool size",min:1,max:50,value:5,title:"Change the size of the tool",action:this.changeToolSize.bind(this),data:{intro:"This changes your brush, line and text size."}},{name:"zoom-in",type:"button",image:"images/icons/zoomin.png",title:"Zoom in",value:1.2,action:this.zoom.bind(this),data:{intro:"These buttons allow you to zoom in or out of the center. Respectivly zoom in, reset zoom and zoom out."}},{name:"zoom-reset",type:"button",image:"images/icons/zoomreset.png",
title:"Reset zoom",value:1,action:this.zoomAbsolute.bind(this)},{name:"zoom-out",type:"button",image:"images/icons/zoomout.png",title:"Zoom out",value:1/1.2,action:this.zoom.bind(this)},{name:"tool-color",type:"color",text:"Tool color",value:"#FFFFFF",title:"Change the color of the tool",action:this._changeColor.bind(this)}]};
Paint.prototype.zoom=function(b){var a=this.public.leftTopX+this.canvasArray[0].width/this.public.zoom/2-this.canvasArray[0].width/(this.public.zoom*b)/2,c=this.public.leftTopY+this.canvasArray[0].height/this.public.zoom/2-this.canvasArray[0].height/(this.public.zoom*b)/2;this.public.relativeZoom(b);this.background.relativeZoom(b);this.local.relativeZoom(b);this.goto(a,c);this.effectsCanvasCtx.clearRect(0,0,this.effectsCanvas.width,this.effectsCanvas.height);this.redrawPaths()};
Paint.prototype.zoomAbsolute=function(b){var a=this.public.leftTopX+this.canvasArray[0].width/this.public.zoom/2-this.canvasArray[0].width/b/2,c=this.public.leftTopY+this.canvasArray[0].height/this.public.zoom/2-this.canvasArray[0].height/b/2;this.public.absoluteZoom(b);this.background.absoluteZoom(b);this.local.absoluteZoom(b);this.goto(a,c);this.effectsCanvasCtx.clearRect(0,0,this.effectsCanvas.width,this.effectsCanvas.height);this.redrawPaths()};
Paint.prototype.getCoords=function(b){if(!("number"===typeof b.clientX||b.changedTouches&&b.changedTouches[0])||!("number"===typeof b.clientY||b.changedTouches&&b.changedTouches[0]))return[0,0];var a="number"===typeof b.clientX?b.clientX:b.changedTouches[0].clientX,c="number"===typeof b.clientY?b.clientY:b.changedTouches[0].clientY;b=b.target||document.elementFromPoint(a,c);-1==this.boundingBoxList.indexOf(b)&&this.boundingBoxList.push(b);b.boundingBoxCache=b.boundingBoxCache||b.getBoundingClientRect();
return[a-b.boundingBoxCache.left,c-b.boundingBoxCache.top]};Paint.prototype.getColorAt=function(b){for(var a=0;a<this.canvasArray.length;a++)this.tempPixelCtx.drawImage(this.canvasArray[a],b[0],b[1],1,1,0,0,1,1);b=this.tempPixelCtx.getImageData(0,0,1,1).data;return tinycolor(this.rgbToHex(b[0],b[1],b[2]))};
Paint.prototype.scaledCoords=function(b,a){var c=[b[0],b[1]],e=a.target||document.elementFromPoint(b[0],b[1]);if(0!==this.rotation||1!==this.scale[0]||1!==this.scale[1]){c[0]-=e.offsetWidth/2;c[1]-=e.offsetHeight/2;c[0]*=this.scale[0];c[1]*=this.scale[1];var d=c[0],f=Math.cos(-this.rotation*Math.PI/180),g=Math.sin(-this.rotation*Math.PI/180);c[0]=c[0]*f-c[1]*g;c[1]=d*g+c[1]*f;c[0]+=e.offsetWidth/2;c[1]+=e.offsetHeight/2}return c};
Paint.prototype.rgbToHex=function(b,a,c){return"#"+("000000"+(b<<16|a<<8|c).toString(16)).slice(-6)};Paint.prototype.tempPixelCtx=document.createElement("canvas").getContext("2d");
Paint.prototype.tools={zoom:function(b,a){if("remove"==a)delete b.lastZoomPoint,b.effectsCanvas.style.cursor="","function"==typeof b.effectsCanvasCtx.setLineDash&&b.effectsCanvasCtx.setLineDash([]);else{b.effectsCanvas.style.cursor="zoom-in";var c=b.getCoords(a),e=b.scaledCoords(c,a);"mousedown"!=a.type&&"touchstart"!=a.type||b.lastZoomPoint||(b.lastZoomPoint=e);if("mouseup"==a.type||"touchend"==a.type){if(b.lastZoomPoint[0]==e[0]&&b.lastZoomPoint[1]==e[1])return;var d=Math.round(b.local.leftTopX+
b.lastZoomPoint[0]/b.local.zoom),f=Math.round(b.local.leftTopY+b.lastZoomPoint[1]/b.local.zoom),g=Math.round(b.local.leftTopX+e[0]/b.local.zoom),h=Math.round(b.local.leftTopY+e[1]/b.local.zoom),c=Math.min(d,g),k=Math.min(f,h),d=Math.abs(d-g),f=Math.abs(f-h),h=Math.min(b.canvasArray[0].width/d,b.canvasArray[1].height/f),d=(b.canvasArray[0].width-h*d)/2,f=(b.canvasArray[1].height-h*f)/2;b.zoomAbsolute(h);b.goto(c-d/h,k-f/h);delete b.lastZoomPoint;b.effectsCanvasCtx.clearRect(0,0,b.effectsCanvas.width,
b.effectsCanvas.height)}"mousemove"!=a.type&&"touchmove"!=a.type||!b.lastZoomPoint||(b.effectsCanvasCtx.clearRect(0,0,b.effectsCanvas.width,b.effectsCanvas.height),d=e[0],f=e[1],g=b.lastZoomPoint[0],h=b.lastZoomPoint[1],c=Math.min(d,g),k=Math.min(f,h),d=Math.abs(d-g),f=Math.abs(f-h),e=b.effectsCanvasCtx,e.beginPath(),"function"==typeof e.setLineDash&&e.setLineDash([6]),e.rect(c,k,d,f),e.lineWidth=3,e.strokeStyle="gray",e.stroke())}},select:function(b,a){if("remove"==a)delete b.lastSelectPoint,b.effectsCanvas.style.cursor=
"","function"==typeof b.effectsCanvasCtx.setLineDash&&b.effectsCanvasCtx.setLineDash([]);else{b.effectsCanvas.style.cursor="cell";var c=b.getCoords(a),c=b.scaledCoords(c,a);"mousedown"!=a.type&&"touchstart"!=a.type||b.lastSelectPoint||(b.lastSelectPoint=c);if("mouseup"==a.type||"touchend"==a.type){if(b.lastSelectPoint[0]==c[0]&&b.lastSelectPoint[1]==c[1])return;var e=Math.round(b.local.leftTopX+b.lastSelectPoint[0]/b.local.zoom),d=Math.round(b.local.leftTopY+b.lastSelectPoint[1]/b.local.zoom),f=Math.round(b.local.leftTopX+
c[0]/b.local.zoom),g=Math.round(b.local.leftTopY+c[1]/b.local.zoom);b.dispatchEvent({type:"select",from:[e,d],to:[f,g]});delete b.lastSelectPoint;b.effectsCanvasCtx.clearRect(0,0,b.effectsCanvas.width,b.effectsCanvas.height)}if(("mousemove"==a.type||"touchmove"==a.type)&&b.lastSelectPoint){b.effectsCanvasCtx.clearRect(0,0,b.effectsCanvas.width,b.effectsCanvas.height);var e=c[0],d=c[1],f=b.lastSelectPoint[0],g=b.lastSelectPoint[1],c=Math.min(e,f),h=Math.min(d,g),e=Math.abs(e-f),d=Math.abs(d-g),g=b.effectsCanvasCtx;
g.beginPath();"function"==typeof g.setLineDash&&g.setLineDash([4]);g.rect(c,h,e,d);g.lineWidth=2;g.strokeStyle="darkgray";g.stroke()}}},grab:function(b,a){if("remove"==a||"mouseup"==a.type||"touchend"==a.type||"mouseleave"===a.type)delete b.lastGrabCoords,b.effectsCanvas.style.cursor="";else{var c=b.getCoords(a),c=b.scaledCoords(c,a);b.lastGrabCoords||"mousedown"!=a.type&&"touchstart"!=a.type||(b.lastGrabCoords=c,b.effectsCanvas.style.cursor="move");"mousemove"!=a.type&&"touchmove"!=a.type||!b.lastGrabCoords||
(b.goto(b.local.leftTopX+(b.lastGrabCoords[0]-c[0])/b.local.zoom,b.local.leftTopY+(b.lastGrabCoords[1]-c[1])/b.local.zoom),b.lastGrabCoords=c)}},line:function(b,a){if("remove"==a)delete b.lastLinePoint,b.effectsCanvas.style.cursor="";else{var c=b.getCoords(a),c=b.scaledCoords(c,a);"mousedown"!=a.type&&"touchstart"!=a.type||b.lastLinePoint||(b.lastLinePoint=c);if("mouseup"==a.type||"touchend"==a.type){if(b.lastLinePoint[0]==c[0]&&b.lastLinePoint[1]==c[1])return;b.addUserDrawing({type:"line",x:Math.round(b.local.leftTopX+
b.lastLinePoint[0]/b.local.zoom),y:Math.round(b.local.leftTopY+b.lastLinePoint[1]/b.local.zoom),x1:Math.round(b.local.leftTopX+c[0]/b.local.zoom),y1:Math.round(b.local.leftTopY+c[1]/b.local.zoom),size:2*b.current_size,color:b.current_color});delete b.lastLinePoint;b.effectsCanvasCtx.clearRect(0,0,b.effectsCanvas.width,b.effectsCanvas.height)}if(("mousemove"==a.type||"touchmove"==a.type)&&b.lastLinePoint){b.effectsCanvasCtx.clearRect(0,0,b.effectsCanvas.width,b.effectsCanvas.height);var e=b.effectsCanvasCtx;
e.beginPath();e.arc(b.lastLinePoint[0],b.lastLinePoint[1],b.current_size*b.local.zoom,0,2*Math.PI,!0);e.fillStyle=b.current_color.toRgbString();e.fill();e.beginPath();e.moveTo(b.lastLinePoint[0],b.lastLinePoint[1]);e.lineTo(c[0],c[1]);e.strokeStyle=b.current_color.toRgbString();e.lineWidth=2*b.current_size*b.local.zoom;e.stroke();e.beginPath();e.arc(c[0],c[1],b.current_size*b.local.zoom,0,2*Math.PI,!0);e.fillStyle=b.current_color.toRgbString();e.fill()}}},brush:function(b,a,c){if("remove"==a)delete b.lastMovePoint,
delete b.lockcolor,delete b.brushing;else{b.lastMovePoint=b.lastMovePoint||[0,0];c=b.getCoords(a);c=b.scaledCoords(c,a);if("mousedown"==a.type||"touchstart"==a.type)b.brushing=!0,b.addUserPath(),b.addUserPathPoint([Math.round(b.local.leftTopX+c[0]/b.local.zoom),Math.round(b.local.leftTopY+c[1]/b.local.zoom)]);if("mouseup"==a.type||"touchend"==a.type||"mouseleave"==a.type)b.endUserPath(),b.brushing=!1;if("mousemove"==a.type||"touchmove"==a.type)b.effectsCanvasCtx.clearRect(b.lastMovePoint[0]-2*b.current_size*
b.local.zoom,b.lastMovePoint[1]-2*b.current_size*b.local.zoom,4*b.current_size*b.local.zoom,4*b.current_size*b.local.zoom),a=b.effectsCanvasCtx,a.beginPath(),a.arc(c[0],c[1],b.current_size*b.local.zoom,0,2*Math.PI,!0),a.fillStyle="gradient"==b.current_color.type?b.current_color[0]?b.current_color[0].color.toRgbString():"black":b.current_color.toRgbString(),a.fill(),b.lastMovePoint[0]=c[0],b.lastMovePoint[1]=c[1],b.brushing&&b.addUserPathPoint([Math.round(b.local.leftTopX+c[0]/b.local.zoom),Math.round(b.local.leftTopY+
c[1]/b.local.zoom)])}},picker:function(b,a){if("remove"==a)delete b.picking,b.effectsCanvas.style.cursor="";else{var c=b.getCoords(a);"mousedown"!=a.type&&"touchstart"!=a.type||b.picking||(b.picking=!0,b.setColor(b.getColorAt(c).setAlpha(b.current_color.getAlpha())),b.effectsCanvas.style.cursor="crosshair");if("mouseup"==a.type||"touchend"==a.type)delete b.picking,b.effectsCanvas.style.cursor="";("mousemove"==a.type||"touchmove"==a.type)&&b.picking&&b.setColor(b.getColorAt(c).setAlpha(b.current_color.getAlpha()))}},
block:function(b,a){this.brush(b,a,"block")},text:function(b,a){if("remove"==a)delete b.lastMovePoint,delete b.lastToolText,b.textToolInput&&b.container.removeChild(b.textToolInput),delete b.textToolInput;else{var c=b.getCoords(a),c=b.scaledCoords(c,a);b.textToolInput||(b.textToolInput=document.createElement("input"),b.textToolInput.className="paint-texttool",b.textToolInput.placeholder="Type some text",b.container.appendChild(b.textToolInput),b.textToolInput.addEventListener("input",function(){this.exectool("redraw")}.bind(b)));
b.textToolInput.focus();"mouseup"!=a.type&&"touchend"!=a.type||!b.textToolInput.value||(b.addUserDrawing({type:"text",text:b.textToolInput.value.slice(0,256)||"",x:Math.round(b.local.leftTopX+c[0]/b.local.zoom),y:Math.round(b.local.leftTopY+c[1]/b.local.zoom),size:b.current_size,color:b.current_color}),b.textToolInput.value="");if("mousemove"==a.type||"touchmove"==a.type)b.lastMovePoint=b.lastMovePoint||[0,0],b.effectsCanvasCtx.font=b.current_size*b.local.zoom+"px Verdana, Geneva, sans-serif",b.effectsCanvasCtx.clearRect(b.lastMovePoint[0],
b.lastMovePoint[1]-1.5*b.current_size*b.local.zoom,b.effectsCanvasCtx.measureText(b.lastToolText).width,2*b.current_size*b.local.zoom),b.effectsCanvasCtx.fillStyle=b.current_color.toRgbString(),b.effectsCanvasCtx.fillText(b.textToolInput.value.slice(0,256),c[0],c[1]),b.lastToolText=b.textToolInput.value.slice(0,256),b.lastMovePoint=c;"redraw"==a&&(b.effectsCanvasCtx.font=b.current_size*b.local.zoom+"px Verdana, Geneva, sans-serif",b.effectsCanvasCtx.clearRect(b.lastMovePoint[0],b.lastMovePoint[1]-
1.5*b.current_size*b.local.zoom,b.effectsCanvasCtx.measureText(b.lastToolText).width,2*b.current_size*b.local.zoom),b.effectsCanvasCtx.fillStyle=b.current_color.toRgbString(),b.effectsCanvasCtx.fillText(b.textToolInput.value.slice(0,256),b.lastMovePoint[0],b.lastMovePoint[1]),b.lastToolText=b.textToolInput.value.slice(0,256))}}};
Paint.prototype.drawFunctions={brush:function(b,a,c){b.beginPath();b.arc(a.x,a.y,a.size,0,2*Math.PI,!0);b.fillStyle=a.color.toRgbString();b.fill();c&&(c.drawingRegion(a.x,a.y,a.x,a.y,a.size),c.executeNoRedraw())},block:function(b,a,c){b.fillStyle=a.color.toRgbString();b.fillRect(a.x,a.y,a.size,a.size);c&&(c.drawingRegion(a.x,a.y,a.x,a.y,a.size),c.executeNoRedraw())},line:function(b,a,c){b.beginPath();b.moveTo(a.x,a.y);b.lineTo(a.x1,a.y1);b.strokeStyle=a.color.toRgbString();b.lineWidth=a.size;b.lineCap=
"round";b.stroke();c&&(c.drawingRegion(a.x,a.y,a.x1,a.y1,a.size),c.executeNoRedraw())},path:function(b,a,c){this.drawPath(a,b,c)},text:function(b,a,c){b.font=a.size+"px Verdana, Geneva, sans-serif";b.fillStyle=a.color.toRgbString();b.fillText(a.text,a.x,a.y);c&&(b=document.createElement("canvas").getContext("2d"),b.font=a.size+"pt Verdana, Geneva, sans-serif",b=b.measureText(a.text).width,c.drawingRegion(a.x,a.y-a.size,a.x+b,a.y,a.size),c.executeNoRedraw())}};
Paint.prototype.utils={copy:function(b){var a={},c;for(c in b)a[c]="object"==typeof b[c]?this.copy(b[c]):b[c];return a},merge:function(b,a){"object"!=typeof b&&(b={});for(var c in a)"object"==typeof a[c]?b[c]=this.merge(b[c],a[c]):"undefined"==typeof b[c]&&(b[c]=a[c]);return b},sqDistance:function(b,a){var c=b[0]-a[0],e=b[1]-a[1];return c*c+e*e}};EventDispatcher=function(){};
EventDispatcher.prototype={constructor:EventDispatcher,apply:function(b){b.addEventListener=EventDispatcher.prototype.addEventListener;b.hasEventListener=EventDispatcher.prototype.hasEventListener;b.removeEventListener=EventDispatcher.prototype.removeEventListener;b.dispatchEvent=EventDispatcher.prototype.dispatchEvent},addEventListener:function(b,a){void 0===this._listeners&&(this._listeners={});var c=this._listeners;void 0===c[b]&&(c[b]=[]);-1===c[b].indexOf(a)&&c[b].push(a)},hasEventListener:function(b,
a){if(void 0===this._listeners)return!1;var c=this._listeners;return void 0!==c[b]&&-1!==c[b].indexOf(a)?!0:!1},removeEventListener:function(b,a){if(void 0!==this._listeners){var c=this._listeners[b];if(void 0!==c){var e=c.indexOf(a);-1!==e&&c.splice(e,1)}}},dispatchEvent:function(b){if(void 0!==this._listeners){var a=this._listeners[b.type];if(void 0!==a){b.target=this;for(var c=[],e=a.length,d=0;d<e;d++)c[d]=a[d];for(d=0;d<e;d++)c[d].call(this,b)}}}};EventDispatcher.prototype.apply(Paint.prototype);(function(){for(var b=0,a=["ms","moz","webkit","o"],c=0;c<a.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[a[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[a[c]+"CancelAnimationFrame"]||window[a[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a,c){var f=(new Date).getTime(),g=Math.max(0,16-(f-b)),h=window.setTimeout(function(){a(f+g)},g);b=f+g;return h});window.cancelAnimationFrame||(window.cancelAnimationFrame=
function(b){clearTimeout(b)})})();Function.prototype.bind||(Function.prototype.bind=function(b){if("function"!==typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var a=Array.prototype.slice.call(arguments,1),c=this,e=function(){},d=function(){return c.apply(this instanceof e?this:b,a.concat(Array.prototype.slice.call(arguments)))};this.prototype&&(e.prototype=this.prototype);d.prototype=new e;return d});(function(){var b={_topZ:500,_panel:null,_titleBar:null,_content:null,_startX:0,_startY:0,_hidden:!1,_collapsed:!1,_controls:null,_keyCode:-1,_draggable:!0,_collapsible:!0,_globalChangeHandler:null,_callbacks:{},create:function(b,c,e){var d=Object.create(this);d._init(b,c,e);return d},_init:function(b,c,e){this._bindHandlers();this._createPanel(b,c);this._createTitleBar(e||"QuickSettings");this._createContent();document.body.appendChild(this._panel)},_bindHandlers:function(){this._startDrag=this._startDrag.bind(this);
this._drag=this._drag.bind(this);this._endDrag=this._endDrag.bind(this);this._doubleClickTitle=this._doubleClickTitle.bind(this);this._onKeyUp=this._onKeyUp.bind(this)},_createPanel:function(a,c){this._panel=document.createElement("div");this._panel.className="msettings_main";this._panel.style.zIndex=++b._topZ;this.setPosition(a||0,c||0);this._controls={}},_createTitleBar:function(b){this._titleBar=document.createElement("div");this._titleBar.textContent=b;this._titleBar.className="msettings_title_bar";
this._titleBar.addEventListener("mousedown",this._startDrag);this._titleBar.addEventListener("touchstart",this._startDrag);this._titleBar.addEventListener("dblclick",this._doubleClickTitle);this._panel.appendChild(this._titleBar)},_createContent:function(){this._content=document.createElement("div");this._content.className="msettings_content";this._panel.appendChild(this._content)},setPosition:function(b,c){this._panel.style.left=b+"px";this._panel.style.top=Math.max(c,0)+"px"},setSize:function(b,
c){this._panel.style.width=b+"px";this._content.style.width=b+"px";this._content.style.height=c-this._titleBar.offsetHeight+"px"},setWidth:function(b){this._panel.style.width=b+"px";this._content.style.width=b+"px"},setDraggable:function(b){this._draggable=b;this._titleBar.style.cursor=this._draggable||this._collapsible?"pointer":"default"},setCollapsible:function(b){this._collapsible=b;this._titleBar.style.cursor=this._draggable||this._collapsible?"pointer":"default"},_startDrag:function(a){this._draggable&&
(this._panel.style.zIndex=++b._topZ,document.addEventListener("touchmove",this._drag),document.addEventListener("mousemove",this._drag),document.addEventListener("touchend",this._endDrag),document.addEventListener("mouseup",this._endDrag),this._startX=a.clientX||a.changedTouches[0].clientX,this._startY=a.clientY||a.changedTouches[0].clientY);a.preventDefault()},_drag:function(b){var c=parseInt(this._panel.style.left),e=parseInt(this._panel.style.top),d=b.clientX||b.changedTouches[0].clientX,f=b.clientY||
b.changedTouches[0].clientY;this.setPosition(c+d-this._startX,e+f-this._startY);this._startX=d;this._startY=f;b.preventDefault()},_endDrag:function(b){document.removeEventListener("touchmove",this._drag);document.removeEventListener("mousemove",this._drag);document.removeEventListener("touchend",this._endDrag);document.removeEventListener("mouseup",this._endDrag);b.preventDefault()},_doubleClickTitle:function(){this._collapsible&&this.toggleCollapsed()},setGlobalChangeHandler:function(b){this._globalChangeHandler=
b},addCallbackHandler:function(b,c){if("function"!==typeof c)throw"addCallbackHandler expects a function as second argument";this._callbacks[b]=this._callbacks[b]||[];-1===this._callbacks[b].indexOf(c)&&this._callbacks[b].push(c)},removeCallbackHandler:function(b,c){for(var e=this._callbacks[b].indexOf(c);-1!==e;)this._callbacks[b].splice(e,1),e=this._callbacks[b].indexOf(c)},_callCallbacks:function(b,c){this._callbacks[b]=this._callbacks[b]||[];for(var e=0;e<this._callbacks[b].length;e++)this._callbacks[b][e](c)},
toggleCollapsed:function(){this._collapsed?this.expand():this.collapse()},collapse:function(){this._panel.removeChild(this._content);this._collapsed=!0},expand:function(){this._panel.appendChild(this._content);this._collapsed=!1},hide:function(){this._panel.style.display="none";this._hidden=!0},show:function(){this._panel.style.display="";this._panel.style.zIndex=++b._topZ;this._hidden=!1},_createContainer:function(){var b=document.createElement("div");b.className="msettings_container";return b},
_createLabel:function(b){var c=document.createElement("div");c.innerHTML=b;c.className="msettings_label";return c},setKey:function(b){this._keyCode=b.toUpperCase().charCodeAt(0);document.body.addEventListener("keyup",this.onKeyUp)},_onKeyUp:function(b){b.keyCode===this._keyCode&&this.toggleVisibility()},toggleVisibility:function(){this._hidden?this.show():this.hide()},bindRange:function(b,c,e,d,f,g){this.addRange(b,c,e,d,f,function(c){g[b]=c})},addControl:function(b){if("string"!==typeof b.type)throw"AddControl needs an object with a type";
var c=localStorage.getItem("quicksettings-"+b.title)||b.value||b.color||b.text,e=b.callback||function(){};switch(b.type.toLowerCase()){case "range":this.addRange(b.title,b.min,b.max,parseFloat(c),b.step,e);break;case "color":this.addColor(b.title,c,e);break;case "boolean":this.addBoolean(b.title,"string"==typeof c?"true"==c:c,e);break;case "text":this.addText(b.title,c,e);break;case "textarea":this.addTextArea(b);break;case "dropdown":this.addDropDown(b.title,b.items,e,c)}this.addCallbackHandler(b.title,
function(c){localStorage.setItem("quicksettings-"+b.title,c.index||c.value)})},addRange:function(b,c,e,d,f,g){var h=this._createContainer(),k=document.createElement("input");k.type="range";k.id=b;k.min=c||0;k.max=e||100;k.step=f||1;k.value=d||0;k.className="msettings_range";var l=this._createLabel("<b>"+b+":</b> "+k.value);h.appendChild(l);h.appendChild(k);this._content.appendChild(h);this._controls[b]={container:h,control:k,label:l,callback:g};c="input";this._isIE()&&(c="change");var m=this._globalChangeHandler,
n=this;k.addEventListener(c,function(){l.innerHTML="<b>"+b+":</b> "+k.value;g&&g(parseFloat(k.value));m&&m();n._callCallbacks(b,{value:parseFloat(k.value)})})},_isIE:function(){return-1!=navigator.userAgent.indexOf("rv:11")||-1!=navigator.userAgent.indexOf("MSIE")?!0:!1},getRangeValue:function(b){return this._controls[b].control.value},setRangeValue:function(b,c,e){var d=this._controls[b];d.control.value=c;d.label.innerHTML="<b>"+b+":</b> "+d.control.value;e&&(d.callback&&d.callback(parseFloat(d.control.value)),
this._globalChangeHandler&&this._globalChangeHandler())},setRangeParameters:function(b,c,e,d){b=this._controls[b];b.control.min=c;b.control.max=e;b.control.step=d},bindBoolean:function(b,c,e){this.addBoolean(b,c,function(c){e[b]=c})},addBoolean:function(b,c,e){var d=this._createContainer(),f=document.createElement("span");f.className="msettings_checkbox_label";f.textContent=b;var g=document.createElement("input");g.type="checkbox";g.id=b;g.checked=c;g.className="msettings_checkbox";d.appendChild(g);
d.appendChild(f);this._content.appendChild(d);this._controls[b]={container:d,control:g,callback:e};var h=this._globalChangeHandler,k=this;g.addEventListener("change",function(){e&&e(g.checked);h&&h();k._callCallbacks(b,{value:g.checked})});f.addEventListener("click",function(){g.disabled||(g.checked=!g.checked,e&&e(g.checked),h&&h(),k._callCallbacks(b,{value:g.checked}))})},getBoolean:function(b){return this._controls[b].control.checked},setBoolean:function(b,c,e){this._controls[b].control.checked=
c;e&&(this._controls[b].callback&&this._controls[b].callback(c),this._globalChangeHandler&&this._globalChangeHandler(),this._callCallbacks(b,{value:c}))},addButton:function(b,c){var e=this._createContainer(),d=document.createElement("input");d.type="button";d.id=b;d.value=b;d.className="msettings_button";e.appendChild(d);this._content.appendChild(e);this._controls[b]={container:e,control:d};var f=this._globalChangeHandler,g=this;d.addEventListener("click",function(){c&&c(d);f&&f();g._callCallbacks(b,
{button:d})})},bindColor:function(b,c,e){this.addColor(b,c,function(c){e[b]=c})},addColor:function(b,c,e){var d=this._createContainer(),f=this._createLabel("<b>"+b+":</b> "+c),g=document.createElement("input");try{g.type="color"}catch(h){g.type="text"}g.id=b;g.value=c||"#ff0000";g.className="msettings_color";d.appendChild(f);d.appendChild(g);this._content.appendChild(d);this._controls[b]={container:d,control:g,label:f,callback:e};var k=this._globalChangeHandler,l=this;g.addEventListener("input",function(){f.innerHTML=
"<b>"+b+":</b> "+g.value;e&&e(g.value);k&&k();l._callCallbacks(b,{value:g.value})})},getColor:function(b){return this._controls[b].control.value},setColor:function(b,c,e){var d=this._controls[b];d.control.value=c;d.label.innerHTML="<b>"+b+":</b> "+d.control.value;e&&(d.callback&&d.callback(d.control.value),this._globalChangeHandler&&this._globalChangeHandler(),this._callCallbacks(b,{value:c}))},bindText:function(b,c,e){this.addText(b,c,function(c){e[b]=c})},addText:function(b,c,e){var d=this._createContainer(),
f=this._createLabel("<b>"+b+"</b>"),g=document.createElement("input");g.type="text";g.id=b;g.value=c||"";g.className="msettings_text_input";d.appendChild(f);d.appendChild(g);this._content.appendChild(d);this._controls[b]={container:d,control:g,label:f,callback:e};var h=this._globalChangeHandler,k=this;g.addEventListener("input",function(){e&&e(g.value);h&&h();k._callCallbacks(b,{value:g.value})})},addTextArea:function(b,c,e){var d=this._createContainer(),f=this._createLabel("<b>"+b+"</b>"),g=document.createElement("textarea");
g.id=b;g.rows=5;g.value=c||"";g.className="msettings_textarea";d.appendChild(f);d.appendChild(g);this._content.appendChild(d);this._controls[b]={container:d,control:g,label:f,callback:e};var h=this._globalChangeHandler,k=this;g.addEventListener("input",function(){e&&e(g.value);h&&h();k._callCallbacks(b,{value:g.value})})},setTextAreaRows:function(b,c){this._controls[b].control.rows=c},getText:function(b){return this._controls[b].control.value},setText:function(b,c,e){var d=this._controls[b];d.control.value=
c;e&&(d.callback&&d.callback(c),this._globalChangeHandler&&this._globalChangeHandler(),this._callCallbacks(b,{value:c}))},addInfo:function(b,c){var e=this._createContainer();e.innerHTML=c;this._controls[b]={container:e};this._content.appendChild(e)},bindDropDown:function(b,c,e){this.addDropDown(b,c,function(c){e[b]=c.value})},addDropDown:function(b,c,e,d){for(var f=this._createContainer(),g=this._createLabel("<b>"+b+"</b>"),h=document.createElement("select"),k=0;k<c.length;k++){var l=document.createElement("option");
l.label=c[k];h.add(l)}d&&(h.selectedIndex=d);var m=this._globalChangeHandler,n=this;h.addEventListener("change",function(){var c=h.selectedIndex,d=h.options;e&&e({index:c,value:d[c].label});m&&m();n._callCallbacks(b,{index:c,value:d[c].label})});h.className="msettings_select";f.appendChild(g);f.appendChild(h);this._content.appendChild(f);this._controls[b]={container:f,control:h,label:g,callback:e}},getDropDownValue:function(b){b=this._controls[b].control;var c=b.selectedIndex;return{index:c,value:b.options[c].label}},
setDropDownIndex:function(b,c,e){var d=this._controls[b],f=d.control.options;d.control.selectedIndex=c;e&&(d.callback&&d.callback({index:c,value:f[c].label}),this._globalChangeHandler&&this._globalChangeHandler(),this._callCallbacks(b,{index:c,value:f[c].label}))},getInfo:function(b){return this._controls[b].container.innerHTML},setInfo:function(b,c){this._controls[b].container.innerHTML=c},addImage:function(b,c){var e=this._createContainer(),d=this._createLabel("<b>"+b+"</b>");img=document.createElement("img");
img.className="msettings_image";img.src=c;e.appendChild(d);e.appendChild(img);this._content.appendChild(e);this._controls[b]={container:e,control:img,label:d}},setImageURL:function(b,c){this._controls[b].control.src=c},addProgressBar:function(b,c,e,d){var f=this._createContainer(),g=this._createLabel("");progress=document.createElement("progress");progress.className="msettings_progress";progress.max=c;progress.value=e;g.innerHTML=d?"<b>"+b+":<b> "+e+" / "+c:"<b>"+b+"<b>";f.appendChild(g);f.appendChild(progress);
this._content.appendChild(f);this._controls[b]={container:f,control:progress,showNumbers:d,label:g}},getProgress:function(b){return this._controls[b].control.value},setProgress:function(b,c){var e=this._controls[b].control;e.value=c;this._controls[b].label.innerHTML=this._controls[b].showNumbers?"<b>"+b+":<b> "+e.value+" / "+e.max:"<b>"+b+"<b>"},addElement:function(b,c){var e=this._createContainer(),d=this._createLabel("<b>"+b+"</b>");e.appendChild(d);e.appendChild(c);this._content.appendChild(e);
this._controls[b]={container:e,label:d}},addHTML:function(b,c){var e=document.createElement("div");e.innerHTML=c;this.addElement(b,e)},removeControl:function(b){if(this._controls[b])var c=this._controls[b].container;c&&c.parentElement&&c.parentElement.removeChild(c);this._controls[b]=null},enableControl:function(b){this._controls[b].control&&(this._controls[b].control.disabled=!1)},disableControl:function(b){this._controls[b].control&&(this._controls[b].control.disabled=!0)}};"function"===typeof define&&
define.amd?define(b):window.QuickSettings=b})();(function(b,a){var c=c||function(c){var d={element:null,dragger:null,disable:"none",addBodyClasses:!0,hyperextensible:!0,resistance:0.5,flickThreshold:50,transitionSpeed:0.3,easing:"ease",maxPosition:266,minPosition:-266,tapToClose:!0,touchToDrag:!0,slideIntent:40,minDragDistance:5},f={simpleStates:{opening:null,towards:null,hyperExtending:null,halfway:null,flick:null,translation:{absolute:0,relative:0,sinceDirectionChange:0,percentage:0}}},g={},h={hasTouch:"ontouchstart"in a.documentElement||b.navigator.msPointerEnabled,
eventType:function(b){return{down:h.hasTouch?"touchstart":"mousedown",move:h.hasTouch?"touchmove":"mousemove",up:h.hasTouch?"touchend":"mouseup",out:h.hasTouch?"touchcancel":"mouseout"}[b]},page:function(b,a){return h.hasTouch&&a.touches.length&&a.touches[0]?a.touches[0]["page"+b]:a["page"+b]},klass:{has:function(b,a){return-1!==b.className.indexOf(a)},add:function(b,a){!h.klass.has(b,a)&&d.addBodyClasses&&(b.className+=" "+a)},remove:function(b,a){d.addBodyClasses&&(b.className=b.className.replace(a,
"").replace(/^\s+|\s+$/g,""))}},dispatchEvent:function(b){if("function"===typeof g[b])return g[b].call()},vendor:function(){var b=a.createElement("div"),c=["webkit","Moz","O","ms"],d;for(d in c)if("undefined"!==typeof b.style[c[d]+"Transition"])return c[d]},transitionCallback:function(){return"Moz"===f.vendor||"ms"===f.vendor?"transitionend":f.vendor+"TransitionEnd"},canTransform:function(){return"undefined"!==typeof d.element.style[f.vendor+"Transform"]},deepExtend:function(b,a){for(var c in a)a[c]&&
a[c].constructor&&a[c].constructor===Object?(b[c]=b[c]||{},h.deepExtend(b[c],a[c])):b[c]=a[c];return b},angleOfDrag:function(b,a){var c;c=Math.atan2(-(f.startDragY-a),f.startDragX-b);0>c&&(c+=2*Math.PI);c=Math.floor(c*(180/Math.PI)-180);0>c&&-180<c&&(c=360-Math.abs(c));return Math.abs(c)},events:{addEvent:function(b,a,c){if(b.addEventListener)return b.addEventListener(a,c,!1);if(b.attachEvent)return b.attachEvent("on"+a,c)},removeEvent:function(b,a,c){if(b.addEventListener)return b.removeEventListener(a,
c,!1);if(b.attachEvent)return b.detachEvent("on"+a,c)},prevent:function(b){b.preventDefault?b.preventDefault():b.returnValue=!1}},parentUntil:function(b,a){for(var c="string"===typeof a;b.parentNode;){if(c&&b.getAttribute&&b.getAttribute(a)||!c&&b===a)return b;b=b.parentNode}return null}},k={translate:{get:{matrix:function(a){if(h.canTransform()){var c=b.getComputedStyle(d.element)[f.vendor+"Transform"].match(/\((.*)\)/);return c?(c=c[1].split(","),16===c.length&&(a+=8),parseInt(c[a],10)):0}return parseInt(d.element.style.left,
10)}},easeCallback:function(){d.element.style[f.vendor+"Transition"]="";f.translation=k.translate.get.matrix(4);f.easing=!1;clearInterval(f.animatingInterval);0===f.easingTo&&(h.klass.remove(a.body,"snapjs-right"),h.klass.remove(a.body,"snapjs-left"));h.dispatchEvent("animated");h.events.removeEvent(d.element,h.transitionCallback(),k.translate.easeCallback)},easeTo:function(b){h.canTransform()?(f.easing=!0,f.easingTo=b,d.element.style[f.vendor+"Transition"]="all "+d.transitionSpeed+"s "+d.easing,
f.animatingInterval=setInterval(function(){h.dispatchEvent("animating")},1),h.events.addEvent(d.element,h.transitionCallback(),k.translate.easeCallback)):f.translation=b;k.translate.x(b);0===b&&(d.element.style[f.vendor+"Transform"]="")},x:function(c){if(!("left"===d.disable&&0<c||"right"===d.disable&&0>c)){if(!d.hyperextensible)if(c===d.maxPosition||c>d.maxPosition)c=d.maxPosition;else if(c===d.minPosition||c<d.minPosition)c=d.minPosition;c=parseInt(c,10);isNaN(c)&&(c=0);h.canTransform()?d.element.style[f.vendor+
"Transform"]="translate3d("+c+"px, 0,0)":(d.element.style.width=(b.innerWidth||a.documentElement.clientWidth)+"px",d.element.style.left=c+"px",d.element.style.right="")}}},drag:{listen:function(){f.translation=0;f.easing=!1;h.events.addEvent(d.element,h.eventType("down"),k.drag.startDrag);h.events.addEvent(d.element,h.eventType("move"),k.drag.dragging);h.events.addEvent(d.element,h.eventType("up"),k.drag.endDrag)},stopListening:function(){h.events.removeEvent(d.element,h.eventType("down"),k.drag.startDrag);
h.events.removeEvent(d.element,h.eventType("move"),k.drag.dragging);h.events.removeEvent(d.element,h.eventType("up"),k.drag.endDrag)},startDrag:function(b){var a=b.target?b.target:b.srcElement;if(h.parentUntil(a,"data-snap-ignore"))h.dispatchEvent("ignore");else if(!d.dragger||h.parentUntil(a,d.dragger)||f.translation===d.minPosition||f.translation===d.maxPosition)h.dispatchEvent("start"),d.element.style[f.vendor+"Transition"]="",f.isDragging=!0,f.hasIntent=null,f.intentChecked=!1,f.startDragX=h.page("X",
b),f.startDragY=h.page("Y",b),f.dragWatchers={current:0,last:0,hold:0,state:""},f.simpleStates={opening:null,towards:null,hyperExtending:null,halfway:null,flick:null,translation:{absolute:0,relative:0,sinceDirectionChange:0,percentage:0}}},dragging:function(b){if(f.isDragging&&d.touchToDrag){var c=h.page("X",b),e=h.page("Y",b),g=f.translation,q=k.translate.get.matrix(4),p=c-f.startDragX,u=0<q,B=p;if(!f.intentChecked||f.hasIntent){d.addBodyClasses&&(0<q?(h.klass.add(a.body,"snapjs-left"),h.klass.remove(a.body,
"snapjs-right")):0>q&&(h.klass.add(a.body,"snapjs-right"),h.klass.remove(a.body,"snapjs-left")));if(!1===f.hasIntent||null===f.hasIntent){var e=h.angleOfDrag(c,e),L=0<=e&&e<=d.slideIntent||360>=e&&e>360-d.slideIntent;f.hasIntent=180<=e&&e<=180+d.slideIntent||180>=e&&e>=180-d.slideIntent||L?!0:!1;f.intentChecked=!0}d.minDragDistance>=Math.abs(c-f.startDragX)||!1===f.hasIntent||(h.events.prevent(b),h.dispatchEvent("drag"),f.dragWatchers.current=c,f.dragWatchers.last>c?("left"!==f.dragWatchers.state&&
(f.dragWatchers.state="left",f.dragWatchers.hold=c),f.dragWatchers.last=c):f.dragWatchers.last<c&&("right"!==f.dragWatchers.state&&(f.dragWatchers.state="right",f.dragWatchers.hold=c),f.dragWatchers.last=c),u?(d.maxPosition<q&&(b=(q-d.maxPosition)*d.resistance,B=p-b),f.simpleStates={opening:"left",towards:f.dragWatchers.state,hyperExtending:d.maxPosition<q,halfway:q>d.maxPosition/2,flick:Math.abs(f.dragWatchers.current-f.dragWatchers.hold)>d.flickThreshold,translation:{absolute:q,relative:p,sinceDirectionChange:f.dragWatchers.current-
f.dragWatchers.hold,percentage:100*(q/d.maxPosition)}}):(d.minPosition>q&&(b=(q-d.minPosition)*d.resistance,B=p-b),f.simpleStates={opening:"right",towards:f.dragWatchers.state,hyperExtending:d.minPosition>q,halfway:q<d.minPosition/2,flick:Math.abs(f.dragWatchers.current-f.dragWatchers.hold)>d.flickThreshold,translation:{absolute:q,relative:p,sinceDirectionChange:f.dragWatchers.current-f.dragWatchers.hold,percentage:100*(q/d.minPosition)}}),k.translate.x(B+g))}}},endDrag:function(b){if(f.isDragging){h.dispatchEvent("end");
var a=k.translate.get.matrix(4);0===f.dragWatchers.current&&0!==a&&d.tapToClose?(h.dispatchEvent("close"),h.events.prevent(b),k.translate.easeTo(0),f.isDragging=!1,f.startDragX=0):("left"===f.simpleStates.opening?f.simpleStates.halfway||f.simpleStates.hyperExtending||f.simpleStates.flick?f.simpleStates.flick&&"left"===f.simpleStates.towards?k.translate.easeTo(0):(f.simpleStates.flick&&"right"===f.simpleStates.towards||f.simpleStates.halfway||f.simpleStates.hyperExtending)&&k.translate.easeTo(d.maxPosition):
k.translate.easeTo(0):"right"===f.simpleStates.opening&&(f.simpleStates.halfway||f.simpleStates.hyperExtending||f.simpleStates.flick?f.simpleStates.flick&&"right"===f.simpleStates.towards?k.translate.easeTo(0):(f.simpleStates.flick&&"left"===f.simpleStates.towards||f.simpleStates.halfway||f.simpleStates.hyperExtending)&&k.translate.easeTo(d.minPosition):k.translate.easeTo(0)),f.isDragging=!1,f.startDragX=h.page("X",b))}}}};this.open=function(b){h.dispatchEvent("open");h.klass.remove(a.body,"snapjs-expand-left");
h.klass.remove(a.body,"snapjs-expand-right");"left"===b?(f.simpleStates.opening="left",f.simpleStates.towards="right",h.klass.add(a.body,"snapjs-left"),h.klass.remove(a.body,"snapjs-right"),k.translate.easeTo(d.maxPosition)):"right"===b&&(f.simpleStates.opening="right",f.simpleStates.towards="left",h.klass.remove(a.body,"snapjs-left"),h.klass.add(a.body,"snapjs-right"),k.translate.easeTo(d.minPosition))};this.close=function(){h.dispatchEvent("close");k.translate.easeTo(0)};this.expand=function(c){var d=
b.innerWidth||a.documentElement.clientWidth;"left"===c?(h.dispatchEvent("expandLeft"),h.klass.add(a.body,"snapjs-expand-left"),h.klass.remove(a.body,"snapjs-expand-right")):(h.dispatchEvent("expandRight"),h.klass.add(a.body,"snapjs-expand-right"),h.klass.remove(a.body,"snapjs-expand-left"),d*=-1);k.translate.easeTo(d)};this.on=function(b,a){g[b]=a;return this};this.off=function(b){g[b]&&(g[b]=!1)};this.enable=function(){h.dispatchEvent("enable");k.drag.listen()};this.disable=function(){h.dispatchEvent("disable");
k.drag.stopListening()};this.settings=function(b){h.deepExtend(d,b)};this.state=function(){var b=k.translate.get.matrix(4);return{state:b===d.maxPosition?"left":b===d.minPosition?"right":"closed",info:f.simpleStates}};c.element&&(h.deepExtend(d,c),f.vendor=h.vendor(),k.drag.listen())};"undefined"!==typeof module&&module.exports&&(module.exports=c);"undefined"===typeof ender&&(this.Snap=c);"function"===typeof define&&define.amd&&define("snap",[],function(){return c})}).call(this,window,document);!function(b){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=b();else if("function"==typeof define&&define.amd)define([],b);else{var a;"undefined"!=typeof window?a=window:"undefined"!=typeof global?a=global:"undefined"!=typeof self&&(a=self);a.io=b()}}(function(){return function a(c,e,d){function f(h,l){if(!e[h]){if(!c[h]){var m="function"==typeof require&&require;if(!l&&m)return m(h,!0);if(g)return g(h,!0);throw Error("Cannot find module '"+h+"'");}m=e[h]={exports:{}};c[h][0].call(m.exports,
function(a){var d=c[h][1][a];return f(d?d:a)},m,m.exports,a,c,e,d)}return e[h].exports}for(var g="function"==typeof require&&require,h=0;h<d.length;h++)f(d[h]);return f}({1:[function(a,c,e){c.exports=a("./lib/")},{"./lib/":2}],2:[function(a,c,e){function d(a,c){"object"==typeof a&&(c=a,a=void 0);c=c||{};var d=f(a),e=d.source,g=d.id;c.forceNew||c["force new connection"]||!1===c.multiplex?(k("ignoring socket cache for %s",e),e=h(e,c)):(l[g]||(k("new io instance for %s",e),l[g]=h(e,c)),e=l[g]);return e.socket(d.path)}
var f=a("./url"),g=a("socket.io-parser"),h=a("./manager"),k=a("debug")("socket.io-client");c.exports=e=d;var l=e.managers={};e.protocol=g.protocol;e.connect=d;e.Manager=a("./manager");e.Socket=a("./socket")},{"./manager":3,"./socket":5,"./url":6,debug:9,"socket.io-parser":40}],3:[function(a,c,e){function d(a,c){if(!(this instanceof d))return new d(a,c);a&&"object"==typeof a&&(c=a,a=void 0);c=c||{};c.path=c.path||"/socket.io";this.nsps={};this.subs=[];this.opts=c;this.reconnection(!1!==c.reconnection);
this.reconnectionAttempts(c.reconnectionAttempts||Infinity);this.reconnectionDelay(c.reconnectionDelay||1E3);this.reconnectionDelayMax(c.reconnectionDelayMax||5E3);this.timeout(null==c.timeout?2E4:c.timeout);this.readyState="closed";this.uri=a;this.attempts=this.connected=0;this.encoding=!1;this.packetBuffer=[];this.encoder=new h.Encoder;this.decoder=new h.Decoder;(this.autoConnect=!1!==c.autoConnect)&&this.open()}a("./url");var f=a("engine.io-client"),g=a("./socket");e=a("component-emitter");var h=
a("socket.io-parser"),k=a("./on"),l=a("component-bind");a("object-component");var m=a("debug")("socket.io-client:manager");c.exports=d;d.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var a in this.nsps)this.nsps[a].emit.apply(this.nsps[a],arguments)};e(d.prototype);d.prototype.reconnection=function(a){if(!arguments.length)return this._reconnection;this._reconnection=!!a;return this};d.prototype.reconnectionAttempts=function(a){if(!arguments.length)return this._reconnectionAttempts;
this._reconnectionAttempts=a;return this};d.prototype.reconnectionDelay=function(a){if(!arguments.length)return this._reconnectionDelay;this._reconnectionDelay=a;return this};d.prototype.reconnectionDelayMax=function(a){if(!arguments.length)return this._reconnectionDelayMax;this._reconnectionDelayMax=a;return this};d.prototype.timeout=function(a){if(!arguments.length)return this._timeout;this._timeout=a;return this};d.prototype.maybeReconnectOnOpen=function(){this.openReconnect||(this.reconnecting||
!this._reconnection||0!==this.attempts)||(this.openReconnect=!0,this.reconnect())};d.prototype.open=d.prototype.connect=function(a){m("readyState %s",this.readyState);if(~this.readyState.indexOf("open"))return this;m("opening %s",this.uri);var c=this.engine=f(this.uri,this.opts),d=this;this.readyState="opening";var e=k(c,"open",function(){d.onopen();a&&a()}),g=k(c,"error",function(c){m("connect_error");d.cleanup();d.readyState="closed";d.emitAll("connect_error",c);if(a){var e=Error("Connection error");
e.data=c;a(e)}d.maybeReconnectOnOpen()});if(!1!==this._timeout){var h=this._timeout;m("connect attempt will timeout after %d",h);var l=setTimeout(function(){m("connect attempt timed out after %d",h);e.destroy();c.close();c.emit("error","timeout");d.emitAll("connect_timeout",h)},h);this.subs.push({destroy:function(){clearTimeout(l)}})}this.subs.push(e);this.subs.push(g);return this};d.prototype.onopen=function(){m("open");this.cleanup();this.readyState="open";this.emit("open");var a=this.engine;this.subs.push(k(a,
"data",l(this,"ondata")));this.subs.push(k(this.decoder,"decoded",l(this,"ondecoded")));this.subs.push(k(a,"error",l(this,"onerror")));this.subs.push(k(a,"close",l(this,"onclose")))};d.prototype.ondata=function(a){this.decoder.add(a)};d.prototype.ondecoded=function(a){this.emit("packet",a)};d.prototype.onerror=function(a){m("error",a);this.emitAll("error",a)};d.prototype.socket=function(a){var c=this.nsps[a];if(!c){c=new g(this,a);this.nsps[a]=c;var d=this;c.on("connect",function(){d.connected++})}return c};
d.prototype.destroy=function(a){--this.connected||this.close()};d.prototype.packet=function(a){m("writing packet %j",a);var c=this;c.encoding?c.packetBuffer.push(a):(c.encoding=!0,this.encoder.encode(a,function(a){for(var d=0;d<a.length;d++)c.engine.write(a[d]);c.encoding=!1;c.processPacketQueue()}))};d.prototype.processPacketQueue=function(){if(0<this.packetBuffer.length&&!this.encoding){var a=this.packetBuffer.shift();this.packet(a)}};d.prototype.cleanup=function(){for(var a;a=this.subs.shift();)a.destroy();
this.packetBuffer=[];this.encoding=!1;this.decoder.destroy()};d.prototype.close=d.prototype.disconnect=function(){this.skipReconnect=!0;this.engine.close()};d.prototype.onclose=function(a){m("close");this.cleanup();this.readyState="closed";this.emit("close",a);this._reconnection&&!this.skipReconnect&&this.reconnect()};d.prototype.reconnect=function(){if(this.reconnecting)return this;var a=this;this.attempts++;if(this.attempts>this._reconnectionAttempts)m("reconnect failed"),this.emitAll("reconnect_failed"),
this.reconnecting=!1;else{var c=this.attempts*this.reconnectionDelay(),c=Math.min(c,this.reconnectionDelayMax());m("will wait %dms before reconnect attempt",c);this.reconnecting=!0;var d=setTimeout(function(){m("attempting reconnect");a.emitAll("reconnect_attempt",a.attempts);a.emitAll("reconnecting",a.attempts);a.open(function(c){c?(m("reconnect attempt error"),a.reconnecting=!1,a.reconnect(),a.emitAll("reconnect_error",c.data)):(m("reconnect success"),a.onreconnect())})},c);this.subs.push({destroy:function(){clearTimeout(d)}})}};
d.prototype.onreconnect=function(){var a=this.attempts;this.attempts=0;this.reconnecting=!1;this.emitAll("reconnect",a)}},{"./on":4,"./socket":5,"./url":6,"component-bind":7,"component-emitter":8,debug:9,"engine.io-client":10,"object-component":37,"socket.io-parser":40}],4:[function(a,c,e){c.exports=function(a,c,e){a.on(c,e);return{destroy:function(){a.removeListener(c,e)}}}},{}],5:[function(a,c,e){function d(a,c){this.io=a;this.nsp=c;this.json=this;this.ids=0;this.acks={};this.io.autoConnect&&this.open();
this.receiveBuffer=[];this.sendBuffer=[];this.connected=!1;this.disconnected=!0;this.subEvents()}var f=a("socket.io-parser");e=a("component-emitter");var g=a("to-array"),h=a("./on"),k=a("component-bind"),l=a("debug")("socket.io-client:socket"),m=a("has-binary");a("indexof");c.exports=d;var n={connect:1,connect_error:1,connect_timeout:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1},r=e.prototype.emit;e(d.prototype);d.prototype.subEvents=function(){var a=
this.io;this.subs=[h(a,"open",k(this,"onopen")),h(a,"packet",k(this,"onpacket")),h(a,"close",k(this,"onclose"))]};d.prototype.open=d.prototype.connect=function(){if(this.connected)return this;this.io.open();if("open"==this.io.readyState)this.onopen();return this};d.prototype.send=function(){var a=g(arguments);a.unshift("message");this.emit.apply(this,a);return this};d.prototype.emit=function(a){if(n.hasOwnProperty(a))return r.apply(this,arguments),this;var c=g(arguments),d=f.EVENT;m(c)&&(d=f.BINARY_EVENT);
d={type:d,data:c};"function"==typeof c[c.length-1]&&(l("emitting packet with ack id %d",this.ids),this.acks[this.ids]=c.pop(),d.id=this.ids++);this.connected?this.packet(d):this.sendBuffer.push(d);return this};d.prototype.packet=function(a){a.nsp=this.nsp;this.io.packet(a)};d.prototype.onopen=function(){l("transport is open - connecting");"/"!=this.nsp&&this.packet({type:f.CONNECT})};d.prototype.onclose=function(a){l("close (%s)",a);this.connected=!1;this.disconnected=!0;this.emit("disconnect",a)};
d.prototype.onpacket=function(a){if(a.nsp==this.nsp)switch(a.type){case f.CONNECT:this.onconnect();break;case f.EVENT:this.onevent(a);break;case f.BINARY_EVENT:this.onevent(a);break;case f.ACK:this.onack(a);break;case f.BINARY_ACK:this.onack(a);break;case f.DISCONNECT:this.ondisconnect();break;case f.ERROR:this.emit("error",a.data)}};d.prototype.onevent=function(a){var c=a.data||[];l("emitting event %j",c);null!=a.id&&(l("attaching ack callback to event"),c.push(this.ack(a.id)));this.connected?r.apply(this,
c):this.receiveBuffer.push(c)};d.prototype.ack=function(a){var c=this,d=!1;return function(){if(!d){d=!0;var e=g(arguments);l("sending ack %j",e);var h=m(e)?f.BINARY_ACK:f.ACK;c.packet({type:h,id:a,data:e})}}};d.prototype.onack=function(a){l("calling ack %s with %j",a.id,a.data);this.acks[a.id].apply(this,a.data);delete this.acks[a.id]};d.prototype.onconnect=function(){this.connected=!0;this.disconnected=!1;this.emit("connect");this.emitBuffered()};d.prototype.emitBuffered=function(){var a;for(a=
0;a<this.receiveBuffer.length;a++)r.apply(this,this.receiveBuffer[a]);this.receiveBuffer=[];for(a=0;a<this.sendBuffer.length;a++)this.packet(this.sendBuffer[a]);this.sendBuffer=[]};d.prototype.ondisconnect=function(){l("server disconnect (%s)",this.nsp);this.destroy();this.onclose("io server disconnect")};d.prototype.destroy=function(){for(var a=0;a<this.subs.length;a++)this.subs[a].destroy();this.io.destroy(this)};d.prototype.close=d.prototype.disconnect=function(){if(!this.connected)return this;
l("performing disconnect (%s)",this.nsp);this.packet({type:f.DISCONNECT});this.destroy();this.onclose("io client disconnect");return this}},{"./on":4,"component-bind":7,"component-emitter":8,debug:9,"has-binary":32,indexof:36,"socket.io-parser":40,"to-array":44}],6:[function(a,c,e){(function(d){var e=a("parseuri"),g=a("debug")("socket.io-client:url");c.exports=function(a,c){var l=a;c=c||d.location;null==a&&(a=c.protocol+"//"+c.hostname);"string"==typeof a&&("/"==a.charAt(0)&&"undefined"!=typeof c&&
(a=c.hostname+a),/^(https?|wss?):\/\//.test(a)||(g("protocol-less url %s",a),a="undefined"!=typeof c?c.protocol+"//"+a:"https://"+a),g("parse %s",a),l=e(a));l.port||(/^(http|ws)$/.test(l.protocol)?l.port="80":/^(http|ws)s$/.test(l.protocol)&&(l.port="443"));l.path=l.path||"/";l.id=l.protocol+"://"+l.host+":"+l.port;l.href=l.protocol+"://"+l.host+(c&&c.port==l.port?"":":"+l.port);return l}}).call(this,"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{debug:9,parseuri:38}],7:[function(a,
c,e){var d=[].slice;c.exports=function(a,c){"string"==typeof c&&(c=a[c]);if("function"!=typeof c)throw Error("bind() requires a function");var e=d.call(arguments,2);return function(){return c.apply(a,e.concat(d.call(arguments)))}}},{}],8:[function(a,c,e){function d(a){if(a){for(var c in d.prototype)a[c]=d.prototype[c];return a}}c.exports=d;d.prototype.on=d.prototype.addEventListener=function(a,c){this._callbacks=this._callbacks||{};(this._callbacks[a]=this._callbacks[a]||[]).push(c);return this};
d.prototype.once=function(a,c){function d(){e.off(a,d);c.apply(this,arguments)}var e=this;this._callbacks=this._callbacks||{};d.fn=c;this.on(a,d);return this};d.prototype.off=d.prototype.removeListener=d.prototype.removeAllListeners=d.prototype.removeEventListener=function(a,c){this._callbacks=this._callbacks||{};if(0==arguments.length)return this._callbacks={},this;var d=this._callbacks[a];if(!d)return this;if(1==arguments.length)return delete this._callbacks[a],this;for(var e,l=0;l<d.length;l++)if(e=
d[l],e===c||e.fn===c){d.splice(l,1);break}return this};d.prototype.emit=function(a){this._callbacks=this._callbacks||{};var c=[].slice.call(arguments,1),d=this._callbacks[a];if(d)for(var d=d.slice(0),e=0,l=d.length;e<l;++e)d[e].apply(this,c);return this};d.prototype.listeners=function(a){this._callbacks=this._callbacks||{};return this._callbacks[a]||[]};d.prototype.hasListeners=function(a){return!!this.listeners(a).length}},{}],9:[function(a,c,e){function d(a){return d.enabled(a)?function(c){c instanceof
Error&&(c=c.stack||c.message);var e=new Date,f=e-(d[a]||e);d[a]=e;c=a+" "+c+" +"+d.humanize(f);window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}:function(){}}c.exports=d;d.names=[];d.skips=[];d.enable=function(a){try{localStorage.debug=a}catch(c){}for(var e=(a||"").split(/[\s,]+/),f=e.length,m=0;m<f;m++)a=e[m].replace("*",".*?"),"-"===a[0]?d.skips.push(RegExp("^"+a.substr(1)+"$")):d.names.push(RegExp("^"+a+"$"))};d.disable=function(){d.enable("")};d.humanize=
function(a){return 36E5<=a?(a/36E5).toFixed(1)+"h":6E4<=a?(a/6E4).toFixed(1)+"m":1E3<=a?(a/1E3|0)+"s":a+"ms"};d.enabled=function(a){for(var c=0,e=d.skips.length;c<e;c++)if(d.skips[c].test(a))return!1;c=0;for(e=d.names.length;c<e;c++)if(d.names[c].test(a))return!0;return!1};try{window.localStorage&&d.enable(localStorage.debug)}catch(f){}},{}],10:[function(a,c,e){c.exports=a("./lib/")},{"./lib/":11}],11:[function(a,c,e){c.exports=a("./socket");c.exports.parser=a("engine.io-parser")},{"./socket":12,
"engine.io-parser":21}],12:[function(a,c,e){(function(d){function e(a,c){if(!(this instanceof e))return new e(a,c);c=c||{};a&&"object"==typeof a&&(c=a,a=null);a&&(a=n(a),c.host=a.host,c.secure="https"==a.protocol||"wss"==a.protocol,c.port=a.port,a.query&&(c.query=a.query));this.secure=null!=c.secure?c.secure:d.location&&"https:"==location.protocol;if(c.host){var g=c.host.split(":");c.hostname=g.shift();g.length&&(c.port=g.pop())}this.agent=c.agent||!1;this.hostname=c.hostname||(d.location?location.hostname:
"localhost");this.port=c.port||(d.location&&location.port?location.port:this.secure?443:80);this.query=c.query||{};"string"==typeof this.query&&(this.query=q.decode(this.query));this.upgrade=!1!==c.upgrade;this.path=(c.path||"/engine.io").replace(/\/$/,"")+"/";this.forceJSONP=!!c.forceJSONP;this.jsonp=!1!==c.jsonp;this.forceBase64=!!c.forceBase64;this.enablesXDR=!!c.enablesXDR;this.timestampParam=c.timestampParam||"t";this.timestampRequests=c.timestampRequests;this.transports=c.transports||["polling",
"websocket"];this.readyState="";this.writeBuffer=[];this.callbackBuffer=[];this.policyPort=c.policyPort||843;this.rememberUpgrade=c.rememberUpgrade||!1;this.open();this.binaryType=null;this.onlyBinaryUpgrades=c.onlyBinaryUpgrades}var g=a("./transports"),h=a("component-emitter"),k=a("debug")("engine.io-client:socket"),l=a("indexof"),m=a("engine.io-parser"),n=a("parseuri"),r=a("parsejson"),q=a("parseqs");c.exports=e;e.priorWebsocketSuccess=!1;h(e.prototype);e.protocol=m.protocol;e.Socket=e;e.Transport=
a("./transport");e.transports=a("./transports");e.parser=a("engine.io-parser");e.prototype.createTransport=function(a){k('creating transport "%s"',a);var c=this.query,d={},e;for(e in c)c.hasOwnProperty(e)&&(d[e]=c[e]);d.EIO=m.protocol;d.transport=a;this.id&&(d.sid=this.id);return new g[a]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:d,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,
timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this})};e.prototype.open=function(){var a;if(this.rememberUpgrade&&e.priorWebsocketSuccess&&-1!=this.transports.indexOf("websocket"))a="websocket";else{if(0==this.transports.length){var c=this;setTimeout(function(){c.emit("error","No transports available")},0);return}a=this.transports[0]}this.readyState="opening";try{a=this.createTransport(a)}catch(d){this.transports.shift();this.open();return}a.open();this.setTransport(a)};e.prototype.setTransport=
function(a){k("setting transport %s",a.name);var c=this;this.transport&&(k("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners());this.transport=a;a.on("drain",function(){c.onDrain()}).on("packet",function(a){c.onPacket(a)}).on("error",function(a){c.onError(a)}).on("close",function(){c.onClose("transport close")})};e.prototype.probe=function(a){function c(){if(F.onlyBinaryUpgrades){var d=!this.supportsBinary&&F.transport.supportsBinary;r=r||d}r||(k('probe transport "%s" opened',
a),q.send([{type:"ping",data:"probe"}]),q.once("packet",function(c){r||("pong"==c.type&&"probe"==c.data?(k('probe transport "%s" pong',a),F.upgrading=!0,F.emit("upgrading",q),e.priorWebsocketSuccess="websocket"==q.name,k('pausing current transport "%s"',F.transport.name),F.transport.pause(function(){r||("closed"==F.readyState||"closing"==F.readyState)||(k("changing transport and sending upgrade packet"),n(),F.setTransport(q),q.send([{type:"upgrade"}]),F.emit("upgrade",q),q=null,F.upgrading=!1,F.flush())})):
(k('probe transport "%s" failed',a),c=Error("probe error"),c.transport=q.name,F.emit("upgradeError",c)))}))}function d(){r||(r=!0,n(),q.close(),q=null)}function g(c){var e=Error("probe error: "+c);e.transport=q.name;d();k('probe transport "%s" failed because of error: %s',a,c);F.emit("upgradeError",e)}function h(){g("transport closed")}function m(){g("socket closed")}function l(a){q&&a.name!=q.name&&(k('"%s" works - aborting "%s"',a.name,q.name),d())}function n(){q.removeListener("open",c);q.removeListener("error",
g);q.removeListener("close",h);F.removeListener("close",m);F.removeListener("upgrading",l)}k('probing transport "%s"',a);var q=this.createTransport(a,{probe:1}),r=!1,F=this;e.priorWebsocketSuccess=!1;q.once("open",c);q.once("error",g);q.once("close",h);this.once("close",m);this.once("upgrading",l);q.open()};e.prototype.onOpen=function(){k("socket open");this.readyState="open";e.priorWebsocketSuccess="websocket"==this.transport.name;this.emit("open");this.flush();if("open"==this.readyState&&this.upgrade&&
this.transport.pause){k("starting upgrade probes");for(var a=0,c=this.upgrades.length;a<c;a++)this.probe(this.upgrades[a])}};e.prototype.onPacket=function(a){if("opening"==this.readyState||"open"==this.readyState)switch(k('socket receive: type "%s", data "%s"',a.type,a.data),this.emit("packet",a),this.emit("heartbeat"),a.type){case "open":this.onHandshake(r(a.data));break;case "pong":this.setPing();break;case "error":var c=Error("server error");c.code=a.data;this.emit("error",c);break;case "message":this.emit("data",
a.data),this.emit("message",a.data)}else k('packet received with socket readyState "%s"',this.readyState)};e.prototype.onHandshake=function(a){this.emit("handshake",a);this.id=a.sid;this.transport.query.sid=a.sid;this.upgrades=this.filterUpgrades(a.upgrades);this.pingInterval=a.pingInterval;this.pingTimeout=a.pingTimeout;this.onOpen();"closed"!=this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))};e.prototype.onHeartbeat=function(a){clearTimeout(this.pingTimeoutTimer);
var c=this;c.pingTimeoutTimer=setTimeout(function(){if("closed"!=c.readyState)c.onClose("ping timeout")},a||c.pingInterval+c.pingTimeout)};e.prototype.setPing=function(){var a=this;clearTimeout(a.pingIntervalTimer);a.pingIntervalTimer=setTimeout(function(){k("writing ping packet - expecting pong within %sms",a.pingTimeout);a.ping();a.onHeartbeat(a.pingTimeout)},a.pingInterval)};e.prototype.ping=function(){this.sendPacket("ping")};e.prototype.onDrain=function(){for(var a=0;a<this.prevBufferLen;a++)if(this.callbackBuffer[a])this.callbackBuffer[a]();
this.writeBuffer.splice(0,this.prevBufferLen);this.callbackBuffer.splice(0,this.prevBufferLen);this.prevBufferLen=0;0==this.writeBuffer.length?this.emit("drain"):this.flush()};e.prototype.flush=function(){"closed"!=this.readyState&&(this.transport.writable&&!this.upgrading&&this.writeBuffer.length)&&(k("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))};e.prototype.write=e.prototype.send=function(a,
c){this.sendPacket("message",a,c);return this};e.prototype.sendPacket=function(a,c,d){a={type:a,data:c};this.emit("packetCreate",a);this.writeBuffer.push(a);this.callbackBuffer.push(d);this.flush()};e.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState)this.onClose("forced close"),k("socket closing - telling transport to close"),this.transport.close();return this};e.prototype.onError=function(a){k("socket error %j",a);e.priorWebsocketSuccess=!1;this.emit("error",a);this.onClose("transport error",
a)};e.prototype.onClose=function(a,c){if("opening"==this.readyState||"open"==this.readyState){k('socket close with reason: "%s"',a);var d=this;clearTimeout(this.pingIntervalTimer);clearTimeout(this.pingTimeoutTimer);setTimeout(function(){d.writeBuffer=[];d.callbackBuffer=[];d.prevBufferLen=0},0);this.transport.removeAllListeners("close");this.transport.close();this.transport.removeAllListeners();this.readyState="closed";this.id=null;this.emit("close",a,c)}};e.prototype.filterUpgrades=function(a){for(var c=
[],d=0,e=a.length;d<e;d++)~l(this.transports,a[d])&&c.push(a[d]);return c}}).call(this,"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./transport":13,"./transports":14,"component-emitter":8,debug:9,"engine.io-parser":21,indexof:36,parsejson:28,parseqs:29,parseuri:30}],13:[function(a,c,e){function d(a){this.path=a.path;this.hostname=a.hostname;this.port=a.port;this.secure=a.secure;this.query=a.query;this.timestampParam=a.timestampParam;this.timestampRequests=a.timestampRequests;
this.readyState="";this.agent=a.agent||!1;this.socket=a.socket;this.enablesXDR=a.enablesXDR}var f=a("engine.io-parser");a=a("component-emitter");c.exports=d;a(d.prototype);d.timestamps=0;d.prototype.onError=function(a,c){var d=Error(a);d.type="TransportError";d.description=c;this.emit("error",d);return this};d.prototype.open=function(){if("closed"==this.readyState||""==this.readyState)this.readyState="opening",this.doOpen();return this};d.prototype.close=function(){if("opening"==this.readyState||
"open"==this.readyState)this.doClose(),this.onClose();return this};d.prototype.send=function(a){if("open"==this.readyState)this.write(a);else throw Error("Transport not open");};d.prototype.onOpen=function(){this.readyState="open";this.writable=!0;this.emit("open")};d.prototype.onData=function(a){a=f.decodePacket(a,this.socket.binaryType);this.onPacket(a)};d.prototype.onPacket=function(a){this.emit("packet",a)};d.prototype.onClose=function(){this.readyState="closed";this.emit("close")}},{"component-emitter":8,
"engine.io-parser":21}],14:[function(a,c,e){(function(c){var f=a("xmlhttprequest"),g=a("./polling-xhr"),h=a("./polling-jsonp"),k=a("./websocket");e.polling=function(a){var e=!1,k=!1,r=!1!==a.jsonp;c.location&&(k="https:"==location.protocol,(e=location.port)||(e=k?443:80),e=a.hostname!=location.hostname||e!=a.port,k=a.secure!=k);a.xdomain=e;a.xscheme=k;if("open"in new f(a)&&!a.forceJSONP)return new g(a);if(!r)throw Error("JSONP disabled");return new h(a)};e.websocket=k}).call(this,"undefined"!==typeof self?
self:"undefined"!==typeof window?window:{})},{"./polling-jsonp":15,"./polling-xhr":16,"./websocket":18,xmlhttprequest:19}],15:[function(a,c,e){(function(d){function e(){}function g(a){h.call(this,a);this.query=this.query||{};n||(d.___eio||(d.___eio=[]),n=d.___eio);this.index=n.length;var c=this;n.push(function(a){c.onData(a)});this.query.j=this.index;d.document&&d.addEventListener&&d.addEventListener("beforeunload",function(){c.script&&(c.script.onerror=e)})}var h=a("./polling"),k=a("component-inherit");
c.exports=g;var l=/\n/g,m=/\\n/g,n;k(g,h);g.prototype.supportsBinary=!1;g.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);this.form&&(this.form.parentNode.removeChild(this.form),this.form=null);h.prototype.doClose.call(this)};g.prototype.doPoll=function(){var a=this,c=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);c.async=!0;c.src=this.uri();c.onerror=function(c){a.onError("jsonp poll error",
c)};var d=document.getElementsByTagName("script")[0];d.parentNode.insertBefore(c,d);this.script=c;"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var a=document.createElement("iframe");document.body.appendChild(a);document.body.removeChild(a)},100)};g.prototype.doWrite=function(a,c){function d(){e();c()}function e(){if(f.iframe)try{f.form.removeChild(f.iframe)}catch(a){f.onError("jsonp polling iframe removal error",a)}try{n=document.createElement('<iframe src="javascript:0" name="'+
f.iframeId+'">')}catch(c){n=document.createElement("iframe"),n.name=f.iframeId,n.src="javascript:0"}n.id=f.iframeId;f.form.appendChild(n);f.iframe=n}var f=this;if(!this.form){var g=document.createElement("form"),h=document.createElement("textarea"),k=this.iframeId="eio_iframe_"+this.index,n;g.className="socketio";g.style.position="absolute";g.style.top="-1000px";g.style.left="-1000px";g.target=k;g.method="POST";g.setAttribute("accept-charset","utf-8");h.name="d";g.appendChild(h);document.body.appendChild(g);
this.form=g;this.area=h}this.form.action=this.uri();e();a=a.replace(m,"\\\n");this.area.value=a.replace(l,"\\n");try{this.form.submit()}catch(I){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"==f.iframe.readyState&&d()}:this.iframe.onload=d}}).call(this,"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./polling":17,"component-inherit":20}],16:[function(a,c,e){(function(d){function e(){}function g(a){m.call(this,a);if(d.location){var c="https:"==
location.protocol,e=location.port;e||(e=c?443:80);this.xd=a.hostname!=d.location.hostname||e!=a.port;this.xs=a.secure!=c}}function h(a){this.method=a.method||"GET";this.uri=a.uri;this.xd=!!a.xd;this.xs=!!a.xs;this.async=!1!==a.async;this.data=void 0!=a.data?a.data:null;this.agent=a.agent;this.isBinary=a.isBinary;this.supportsBinary=a.supportsBinary;this.enablesXDR=a.enablesXDR;this.create()}function k(){for(var a in h.requests)h.requests.hasOwnProperty(a)&&h.requests[a].abort()}var l=a("xmlhttprequest"),
m=a("./polling"),n=a("component-emitter"),r=a("component-inherit"),q=a("debug")("engine.io-client:polling-xhr");c.exports=g;c.exports.Request=h;r(g,m);g.prototype.supportsBinary=!0;g.prototype.request=function(a){a=a||{};a.uri=this.uri();a.xd=this.xd;a.xs=this.xs;a.agent=this.agent||!1;a.supportsBinary=this.supportsBinary;a.enablesXDR=this.enablesXDR;return new h(a)};g.prototype.doWrite=function(a,c){var d=this.request({method:"POST",data:a,isBinary:"string"!==typeof a&&void 0!==a}),e=this;d.on("success",
c);d.on("error",function(a){e.onError("xhr post error",a)});this.sendXhr=d};g.prototype.doPoll=function(){q("xhr poll");var a=this.request(),c=this;a.on("data",function(a){c.onData(a)});a.on("error",function(a){c.onError("xhr poll error",a)});this.pollXhr=a};n(h.prototype);h.prototype.create=function(){var a=this.xhr=new l({agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR}),c=this;try{q("xhr open %s: %s",this.method,this.uri);a.open(this.method,this.uri,this.async);this.supportsBinary&&
(a.responseType="arraybuffer");if("POST"==this.method)try{this.isBinary?a.setRequestHeader("Content-type","application/octet-stream"):a.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}"withCredentials"in a&&(a.withCredentials=!0);this.hasXDR()?(a.onload=function(){c.onLoad()},a.onerror=function(){c.onError(a.responseText)}):a.onreadystatechange=function(){if(4==a.readyState)if(200==a.status||1223==a.status)c.onLoad();else setTimeout(function(){c.onError(a.status)},0)};q("xhr data %s",
this.data);a.send(this.data)}catch(f){setTimeout(function(){c.onError(f)},0);return}d.document&&(this.index=h.requestsCount++,h.requests[this.index]=this)};h.prototype.onSuccess=function(){this.emit("success");this.cleanup()};h.prototype.onData=function(a){this.emit("data",a);this.onSuccess()};h.prototype.onError=function(a){this.emit("error",a);this.cleanup()};h.prototype.cleanup=function(){if("undefined"!=typeof this.xhr&&null!==this.xhr){this.hasXDR()?this.xhr.onload=this.xhr.onerror=e:this.xhr.onreadystatechange=
e;try{this.xhr.abort()}catch(a){}d.document&&delete h.requests[this.index];this.xhr=null}};h.prototype.onLoad=function(){var a;try{var c;try{c=this.xhr.getResponseHeader("Content-Type")}catch(d){}a="application/octet-stream"===c?this.xhr.response:this.supportsBinary?"ok":this.xhr.responseText}catch(e){this.onError(e)}if(null!=a)this.onData(a)};h.prototype.hasXDR=function(){return"undefined"!==typeof d.XDomainRequest&&!this.xs&&this.enablesXDR};h.prototype.abort=function(){this.cleanup()};d.document&&
(h.requestsCount=0,h.requests={},d.attachEvent?d.attachEvent("onunload",k):d.addEventListener&&d.addEventListener("beforeunload",k))}).call(this,"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./polling":17,"component-emitter":8,"component-inherit":20,debug:9,xmlhttprequest:19}],17:[function(a,c,e){function d(a){var c=a&&a.forceBase64;if(!l||c)this.supportsBinary=!1;f.call(this,a)}var f=a("../transport"),g=a("parseqs"),h=a("engine.io-parser");e=a("component-inherit");var k=
a("debug")("engine.io-client:polling");c.exports=d;var l=function(){return null!=(new (a("xmlhttprequest"))({agent:this.agent,xdomain:!1})).responseType}();e(d,f);d.prototype.name="polling";d.prototype.doOpen=function(){this.poll()};d.prototype.pause=function(a){function c(){k("paused");d.readyState="paused";a()}var d=this;this.readyState="pausing";if(this.polling||!this.writable){var e=0;this.polling&&(k("we are currently polling - waiting to pause"),e++,this.once("pollComplete",function(){k("pre-pause polling complete");
--e||c()}));this.writable||(k("we are currently writing - waiting to pause"),e++,this.once("drain",function(){k("pre-pause writing complete");--e||c()}))}else c()};d.prototype.poll=function(){k("polling");this.polling=!0;this.doPoll();this.emit("poll")};d.prototype.onData=function(a){var c=this;k("polling got data %s",a);h.decodePayload(a,this.socket.binaryType,function(a,d,e){if("opening"==c.readyState)c.onOpen();if("close"==a.type)return c.onClose(),!1;c.onPacket(a)});"closed"!=this.readyState&&
(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():k('ignoring poll - transport state "%s"',this.readyState))};d.prototype.doClose=function(){function a(){k("writing close packet");c.write([{type:"close"}])}var c=this;"open"==this.readyState?(k("transport open - closing"),a()):(k("transport not open - deferring close"),this.once("open",a))};d.prototype.write=function(a){var c=this;this.writable=!1;var d=function(){c.writable=!0;c.emit("drain")},c=this;h.encodePayload(a,
this.supportsBinary,function(a){c.doWrite(a,d)})};d.prototype.uri=function(){var a=this.query||{},c=this.secure?"https":"http",d="";!1!==this.timestampRequests&&(a[this.timestampParam]=+new Date+"-"+f.timestamps++);this.supportsBinary||a.sid||(a.b64=1);a=g.encode(a);this.port&&("https"==c&&443!=this.port||"http"==c&&80!=this.port)&&(d=":"+this.port);a.length&&(a="?"+a);return c+"://"+this.hostname+d+this.path+a}},{"../transport":13,"component-inherit":20,debug:9,"engine.io-parser":21,parseqs:29,xmlhttprequest:19}],
18:[function(a,c,e){function d(a){a&&a.forceBase64&&(this.supportsBinary=!1);f.call(this,a)}var f=a("../transport"),g=a("engine.io-parser"),h=a("parseqs");e=a("component-inherit");var k=a("debug")("engine.io-client:websocket"),l=a("ws");c.exports=d;e(d,f);d.prototype.name="websocket";d.prototype.supportsBinary=!0;d.prototype.doOpen=function(){if(this.check()){var a=this.uri();this.ws=new l(a,void 0,{agent:this.agent});void 0===this.ws.binaryType&&(this.supportsBinary=!1);this.ws.binaryType="arraybuffer";
this.addEventListeners()}};d.prototype.addEventListeners=function(){var a=this;this.ws.onopen=function(){a.onOpen()};this.ws.onclose=function(){a.onClose()};this.ws.onmessage=function(c){a.onData(c.data)};this.ws.onerror=function(c){a.onError("websocket error",c)}};"undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(d.prototype.onData=function(a){var c=this;setTimeout(function(){f.prototype.onData.call(c,a)},0)});d.prototype.write=function(a){var c=this;this.writable=!1;
for(var d=0,e=a.length;d<e;d++)g.encodePacket(a[d],this.supportsBinary,function(a){try{c.ws.send(a)}catch(d){k("websocket closed before onclose event")}});setTimeout(function(){c.writable=!0;c.emit("drain")},0)};d.prototype.onClose=function(){f.prototype.onClose.call(this)};d.prototype.doClose=function(){"undefined"!==typeof this.ws&&this.ws.close()};d.prototype.uri=function(){var a=this.query||{},c=this.secure?"wss":"ws",d="";this.port&&("wss"==c&&443!=this.port||"ws"==c&&80!=this.port)&&(d=":"+
this.port);this.timestampRequests&&(a[this.timestampParam]=+new Date);this.supportsBinary||(a.b64=1);a=h.encode(a);a.length&&(a="?"+a);return c+"://"+this.hostname+d+this.path+a};d.prototype.check=function(){return!!l&&!("__initialize"in l&&this.name===d.prototype.name)}},{"../transport":13,"component-inherit":20,debug:9,"engine.io-parser":21,parseqs:29,ws:31}],19:[function(a,c,e){var d=a("has-cors");c.exports=function(a){var c=a.xdomain,e=a.xscheme;a=a.enablesXDR;try{if("undefined"!=typeof XDomainRequest&&
!e&&a)return new XDomainRequest}catch(k){}try{if("undefined"!=typeof XMLHttpRequest&&(!c||d))return new XMLHttpRequest}catch(l){}if(!c)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(m){}}},{"has-cors":34}],20:[function(a,c,e){c.exports=function(a,c){var e=function(){};e.prototype=c.prototype;a.prototype=new e;a.prototype.constructor=a}},{}],21:[function(a,c,e){(function(c){function f(a,c,d){if(!c)return e.encodeBase64Packet(a,d);var f=new FileReader;f.onload=function(){a.data=f.result;e.encodePacket(a,
c,!0,d)};return f.readAsArrayBuffer(a.data)}function g(a,c,d){var e=Array(a.length);d=m(a.length,d);for(var f=function(a,d,f){c(d,function(c,d){e[a]=d;f(c,e)})},g=0;g<a.length;g++)f(g,a[g],d)}var h=a("./keys"),k=a("arraybuffer.slice"),l=a("base64-arraybuffer"),m=a("after"),n=a("utf8"),r=navigator.userAgent.match(/Android/i);e.protocol=3;var q=e.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},p=h(q),u={type:"error",data:"parser error"},B=a("blob");e.encodePacket=function(a,g,h,k){"function"==
typeof g&&(k=g,g=!1);"function"==typeof h&&(k=h,h=null);var l=void 0===a.data?void 0:a.data.buffer||a.data;if(c.ArrayBuffer&&l instanceof ArrayBuffer){if(g){h=a.data;g=new Uint8Array(h);h=new Uint8Array(1+h.byteLength);h[0]=q[a.type];for(a=0;a<g.length;a++)h[a+1]=g[a];a=k(h.buffer)}else a=e.encodeBase64Packet(a,k);return a}if(B&&l instanceof c.Blob)return g?r?a=f(a,g,k):(g=new Uint8Array(1),g[0]=q[a.type],a=new B([g.buffer,a.data]),a=k(a)):a=e.encodeBase64Packet(a,k),a;g=q[a.type];void 0!==a.data&&
(g+=h?n.encode(String(a.data)):String(a.data));return k(""+g)};e.encodeBase64Packet=function(a,f){var g="b"+e.packets[a.type];if(B&&a.data instanceof B){var h=new FileReader;h.onload=function(){var a=h.result.split(",")[1];f(g+a)};return h.readAsDataURL(a.data)}var k;try{k=String.fromCharCode.apply(null,new Uint8Array(a.data))}catch(l){k=new Uint8Array(a.data);for(var q=Array(k.length),m=0;m<k.length;m++)q[m]=k[m];k=String.fromCharCode.apply(null,q)}g+=c.btoa(k);return f(g)};e.decodePacket=function(a,
c,d){if("string"==typeof a||void 0===a){if("b"==a.charAt(0))return e.decodeBase64Packet(a.substr(1),c);if(d)try{a=n.decode(a)}catch(f){return u}d=a.charAt(0);return Number(d)==d&&p[d]?1<a.length?{type:p[d],data:a.substring(1)}:{type:p[d]}:u}d=(new Uint8Array(a))[0];a=k(a,1);B&&"blob"===c&&(a=new B([a]));return{type:p[d],data:a}};e.decodeBase64Packet=function(a,e){var f=p[a.charAt(0)];if(!c.ArrayBuffer)return{type:f,data:{base64:!0,data:a.substr(1)}};var g=l.decode(a.substr(1));"blob"===e&&B&&(g=new B([g]));
return{type:f,data:g}};e.encodePayload=function(a,c,d){"function"==typeof c&&(d=c,c=null);if(c)return B&&!r?e.encodePayloadAsBlob(a,d):e.encodePayloadAsArrayBuffer(a,d);if(!a.length)return d("0:");g(a,function(a,d){e.encodePacket(a,c,!0,function(a){d(null,a.length+":"+a)})},function(a,c){return d(c.join(""))})};e.decodePayload=function(a,c,d){if("string"!=typeof a)return e.decodePayloadAsBinary(a,c,d);"function"===typeof c&&(d=c,c=null);var f;if(""==a)return d(u,0,1);f="";for(var g,h,k=0,l=a.length;k<
l;k++)if(h=a.charAt(k),":"!=h)f+=h;else{if(""==f||f!=(g=Number(f)))return d(u,0,1);h=a.substr(k+1,g);if(f!=h.length)return d(u,0,1);if(h.length){f=e.decodePacket(h,c,!0);if(u.type==f.type&&u.data==f.data)return d(u,0,1);if(!1===d(f,k+g,l))return}k+=g;f=""}if(""!=f)return d(u,0,1)};e.encodePayloadAsArrayBuffer=function(a,c){if(!a.length)return c(new ArrayBuffer(0));g(a,function(a,c){e.encodePacket(a,!0,!0,function(a){return c(null,a)})},function(a,d){var e=d.reduce(function(a,c){var d;d="string"===
typeof c?c.length:c.byteLength;return a+d.toString().length+d+2},0),f=new Uint8Array(e),g=0;d.forEach(function(a){var c="string"===typeof a,d=a;if(c){for(var d=new Uint8Array(a.length),e=0;e<a.length;e++)d[e]=a.charCodeAt(e);d=d.buffer}c?f[g++]=0:f[g++]=1;a=d.byteLength.toString();for(e=0;e<a.length;e++)f[g++]=parseInt(a[e]);f[g++]=255;d=new Uint8Array(d);for(e=0;e<d.length;e++)f[g++]=d[e]});return c(f.buffer)})};e.encodePayloadAsBlob=function(a,c){g(a,function(a,c){e.encodePacket(a,!0,!0,function(a){var d=
new Uint8Array(1);d[0]=1;if("string"===typeof a){for(var e=new Uint8Array(a.length),f=0;f<a.length;f++)e[f]=a.charCodeAt(f);a=e.buffer;d[0]=0}for(var e=(a instanceof ArrayBuffer?a.byteLength:a.size).toString(),g=new Uint8Array(e.length+1),f=0;f<e.length;f++)g[f]=parseInt(e[f]);g[e.length]=255;B&&(a=new B([d.buffer,g.buffer,a]),c(null,a))})},function(a,d){return c(new B(d))})};e.decodePayloadAsBinary=function(a,c,d){"function"===typeof c&&(d=c,c=null);for(var f=[],g=!1;0<a.byteLength;){for(var h=new Uint8Array(a),
l=0===h[0],q="",m=1;255!=h[m];m++){if(310<q.length){g=!0;break}q+=h[m]}if(g)return d(u,0,1);a=k(a,2+q.length);q=parseInt(q);h=k(a,0,q);if(l)try{h=String.fromCharCode.apply(null,new Uint8Array(h))}catch(p){for(l=new Uint8Array(h),h="",m=0;m<l.length;m++)h+=String.fromCharCode(l[m])}f.push(h);a=k(a,q)}var n=f.length;f.forEach(function(a,f){d(e.decodePacket(a,c,!0),f,n)})}}).call(this,"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./keys":22,after:23,"arraybuffer.slice":24,
"base64-arraybuffer":25,blob:26,utf8:27}],22:[function(a,c,e){c.exports=Object.keys||function(a){var c=[],e=Object.prototype.hasOwnProperty,h;for(h in a)e.call(a,h)&&c.push(h);return c}},{}],23:[function(a,c,e){function d(){}c.exports=function(a,c,e){function k(a,d){if(0>=k.count)throw Error("after called too many times");--k.count;a?(l=!0,c(a),c=e):0!==k.count||l||c(null,d)}var l=!1;e=e||d;k.count=a;return 0===a?c():k}},{}],24:[function(a,c,e){c.exports=function(a,c,e){var h=a.byteLength;c=c||0;
e=e||h;if(a.slice)return a.slice(c,e);0>c&&(c+=h);0>e&&(e+=h);e>h&&(e=h);if(c>=h||c>=e||0===h)return new ArrayBuffer(0);a=new Uint8Array(a);for(var h=new Uint8Array(e-c),k=0;c<e;c++,k++)h[k]=a[c];return h.buffer}},{}],25:[function(a,c,e){(function(a){e.encode=function(c){c=new Uint8Array(c);var e,h=c.length,k="";for(e=0;e<h;e+=3)k+=a[c[e]>>2],k+=a[(c[e]&3)<<4|c[e+1]>>4],k+=a[(c[e+1]&15)<<2|c[e+2]>>6],k+=a[c[e+2]&63];2===h%3?k=k.substring(0,k.length-1)+"=":1===h%3&&(k=k.substring(0,k.length-2)+"==");
return k};e.decode=function(c){var e=0.75*c.length,h=c.length,k=0,l,m,n,r;"="===c[c.length-1]&&(e--,"="===c[c.length-2]&&e--);for(var q=new ArrayBuffer(e),p=new Uint8Array(q),e=0;e<h;e+=4)l=a.indexOf(c[e]),m=a.indexOf(c[e+1]),n=a.indexOf(c[e+2]),r=a.indexOf(c[e+3]),p[k++]=l<<2|m>>4,p[k++]=(m&15)<<4|n>>2,p[k++]=(n&3)<<6|r&63;return q}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],26:[function(a,c,e){(function(a){function e(a,c){c=c||{};for(var d=new g,f=0;f<a.length;f++)d.append(a[f]);
return c.type?d.getBlob(c.type):d.getBlob()}var g=a.BlobBuilder||a.WebKitBlobBuilder||a.MSBlobBuilder||a.MozBlobBuilder,h;try{h=2==(new Blob(["hi"])).size}catch(k){h=!1}var l=g&&g.prototype.append&&g.prototype.getBlob;a=h?a.Blob:l?e:void 0;c.exports=a}).call(this,"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],27:[function(a,c,e){(function(a){(function(f){function g(a){for(var c=[],d=0,e=a.length,f,g;d<e;)f=a.charCodeAt(d++),55296<=f&&56319>=f&&d<e?(g=a.charCodeAt(d++),
56320==(g&64512)?c.push(((f&1023)<<10)+(g&1023)+65536):(c.push(f),d--)):c.push(f);return c}function h(){if(u>=p)throw Error("Invalid byte index");var a=q[u]&255;u++;if(128==(a&192))return a&63;throw Error("Invalid continuation byte");}function k(){var a,c,d,e;if(u>p)throw Error("Invalid byte index");if(u==p)return!1;a=q[u]&255;u++;if(0==(a&128))return a;if(192==(a&224)){c=h();a=(a&31)<<6|c;if(128<=a)return a;throw Error("Invalid continuation byte");}if(224==(a&240)){c=h();d=h();a=(a&15)<<12|c<<6|
d;if(2048<=a)return a;throw Error("Invalid continuation byte");}if(240==(a&248)&&(c=h(),d=h(),e=h(),a=(a&15)<<18|c<<12|d<<6|e,65536<=a&&1114111>=a))return a;throw Error("Invalid UTF-8 detected");}var l="object"==typeof e&&e,m="object"==typeof c&&c&&c.exports==l&&c,n="object"==typeof a&&a;if(n.global===n||n.window===n)f=n;var r=String.fromCharCode,q,p,u,n={version:"2.0.0",encode:function(a){a=g(a);for(var c=a.length,d=-1,e,f="";++d<c;){e=a[d];if(0==(e&4294967168))e=r(e);else{var h="";0==(e&4294965248)?
h=r(e>>6&31|192):0==(e&4294901760)?(h=r(e>>12&15|224),h+=r(e>>6&63|128)):0==(e&4292870144)&&(h=r(e>>18&7|240),h+=r(e>>12&63|128),h+=r(e>>6&63|128));e=h+=r(e&63|128)}f+=e}return f},decode:function(a){q=g(a);p=q.length;u=0;a=[];for(var c;!1!==(c=k());)a.push(c);c=a.length;for(var d=-1,e,f="";++d<c;)e=a[d],65535<e&&(e-=65536,f+=r(e>>>10&1023|55296),e=56320|e&1023),f+=r(e);return f}};if(l&&!l.nodeType)if(m)m.exports=n;else{f={}.hasOwnProperty;for(var B in n)f.call(n,B)&&(l[B]=n[B])}else f.utf8=n})(this)}).call(this,
"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],28:[function(a,c,e){(function(a){var e=/^[\],:{}\s]*$/,g=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,h=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,k=/(?:^|:|,)(?:\s*\[)+/g,l=/^\s+/,m=/\s+$/;c.exports=function(c){if("string"!=typeof c||!c)return null;c=c.replace(l,"").replace(m,"");if(a.JSON&&JSON.parse)return JSON.parse(c);if(e.test(c.replace(g,"@").replace(h,"]").replace(k,"")))return(new Function("return "+
c))()}}).call(this,"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],29:[function(a,c,e){e.encode=function(a){var c="",e;for(e in a)a.hasOwnProperty(e)&&(c.length&&(c+="&"),c+=encodeURIComponent(e)+"="+encodeURIComponent(a[e]));return c};e.decode=function(a){var c={};a=a.split("&");for(var e=0,h=a.length;e<h;e++){var k=a[e].split("=");c[decodeURIComponent(k[0])]=decodeURIComponent(k[1])}return c}},{}],30:[function(a,c,e){var d=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,
f="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");c.exports=function(a){var c=a,e=a.indexOf("["),l=a.indexOf("]");-1!=e&&-1!=l&&(a=a.substring(0,e)+a.substring(e,l).replace(/:/g,";")+a.substring(l,a.length));a=d.exec(a||"");for(var m={},n=14;n--;)m[f[n]]=a[n]||"";-1!=e&&-1!=l&&(m.source=c,m.host=m.host.substring(1,m.host.length-1).replace(/;/g,":"),m.authority=m.authority.replace("[","").replace("]","").replace(/;/g,":"),m.ipv6uri=
!0);return m}},{}],31:[function(a,c,e){function d(a,c,d){return c?new f(a,c):new f(a)}a=function(){return this}();var f=a.WebSocket||a.MozWebSocket;c.exports=f?d:null;f&&(d.prototype=f.prototype)},{}],32:[function(a,c,e){(function(d){var e=a("isarray");c.exports=function(a){function c(a){if(!a)return!1;if(d.Buffer&&d.Buffer.isBuffer(a)||d.ArrayBuffer&&a instanceof ArrayBuffer||d.Blob&&a instanceof Blob||d.File&&a instanceof File)return!0;if(e(a))for(var g=0;g<a.length;g++){if(c(a[g]))return!0}else if(a&&
"object"==typeof a)for(g in a.toJSON&&(a=a.toJSON()),a)if(a.hasOwnProperty(g)&&c(a[g]))return!0;return!1}return c(a)}}).call(this,"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{isarray:33}],33:[function(a,c,e){c.exports=Array.isArray||function(a){return"[object Array]"==Object.prototype.toString.call(a)}},{}],34:[function(a,c,e){a=a("global");try{c.exports="XMLHttpRequest"in a&&"withCredentials"in new a.XMLHttpRequest}catch(d){c.exports=!1}},{global:35}],35:[function(a,c,
e){c.exports=function(){return this}()},{}],36:[function(a,c,e){var d=[].indexOf;c.exports=function(a,c){if(d)return a.indexOf(c);for(var e=0;e<a.length;++e)if(a[e]===c)return e;return-1}},{}],37:[function(a,c,e){var d=Object.prototype.hasOwnProperty;e.keys=Object.keys||function(a){var c=[],e;for(e in a)d.call(a,e)&&c.push(e);return c};e.values=function(a){var c=[],e;for(e in a)d.call(a,e)&&c.push(a[e]);return c};e.merge=function(a,c){for(var e in c)d.call(c,e)&&(a[e]=c[e]);return a};e.length=function(a){return e.keys(a).length};
e.isEmpty=function(a){return 0==e.length(a)}},{}],38:[function(a,c,e){var d=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,f="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");c.exports=function(a){a=d.exec(a||"");for(var c={},e=14;e--;)c[f[e]]=a[e]||
"";return c}},{}],39:[function(a,c,e){(function(c){var f=a("isarray"),g=a("./is-buffer");e.deconstructPacket=function(a){function c(a){if(!a)return a;if(g(a)){var d={_placeholder:!0,num:e.length};e.push(a);return d}if(f(a)){for(var d=Array(a.length),h=0;h<a.length;h++)d[h]=c(a[h]);return d}if("object"==typeof a&&!(a instanceof Date)){d={};for(h in a)d[h]=c(a[h]);return d}return a}var e=[];a.data=c(a.data);a.attachments=e.length;return{packet:a,buffers:e}};e.reconstructPacket=function(a,c){function e(a){if(a&&
a._placeholder)return c[a.num];if(f(a))for(var d=0;d<a.length;d++)a[d]=e(a[d]);else if(a&&"object"==typeof a)for(d in a)a[d]=e(a[d]);return a}a.data=e(a.data);a.attachments=void 0;return a};e.removeBlobs=function(a,e){function l(a,h,p){if(!a)return a;if(c.Blob&&a instanceof Blob||c.File&&a instanceof File){m++;var u=new FileReader;u.onload=function(){p?p[h]=this.result:n=this.result;--m||e(n)};u.readAsArrayBuffer(a)}else if(f(a))for(u=0;u<a.length;u++)l(a[u],u,a);else if(a&&"object"==typeof a&&!g(a))for(u in a)l(a[u],
u,a)}var m=0,n=a;l(n);m||e(n)}}).call(this,"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./is-buffer":41,isarray:42}],40:[function(a,c,e){function d(){}function f(a){var c,d=!1;c=""+a.type;if(e.BINARY_EVENT==a.type||e.BINARY_ACK==a.type)c+=a.attachments,c+="-";a.nsp&&"/"!=a.nsp&&(d=!0,c+=a.nsp);null!=a.id&&(d&&(c+=",",d=!1),c+=a.id);null!=a.data&&(d&&(c+=","),c+=m.stringify(a.data));l("encoded %j as %s",a,c);return c}function g(a,c){n.removeBlobs(a,function(a){var e=n.deconstructPacket(a);
a=f(e.packet);e=e.buffers;e.unshift(a);c(e)})}function h(){this.reconstructor=null}function k(a){this.reconPack=a;this.buffers=[]}var l=a("debug")("socket.io-parser"),m=a("json3");a("isarray");c=a("component-emitter");var n=a("./binary"),r=a("./is-buffer");e.protocol=4;e.types="CONNECT DISCONNECT EVENT BINARY_EVENT ACK BINARY_ACK ERROR".split(" ");e.CONNECT=0;e.DISCONNECT=1;e.EVENT=2;e.ACK=3;e.ERROR=4;e.BINARY_EVENT=5;e.BINARY_ACK=6;e.Encoder=d;e.Decoder=h;d.prototype.encode=function(a,c){l("encoding packet %j",
a);if(e.BINARY_EVENT==a.type||e.BINARY_ACK==a.type)g(a,c);else{var d=f(a);c([d])}};c(h.prototype);h.prototype.add=function(a){if("string"==typeof a){a:{var c={},d=0;c.type=Number(a.charAt(0));if(null==e.types[c.type])a={type:e.ERROR,data:"parser error"};else{if(e.BINARY_EVENT==c.type||e.BINARY_ACK==c.type){for(c.attachments="";"-"!=a.charAt(++d);)c.attachments+=a.charAt(d);c.attachments=Number(c.attachments)}if("/"==a.charAt(d+1))for(c.nsp="";++d;){var f=a.charAt(d);if(","==f)break;c.nsp+=f;if(d+
1==a.length)break}else c.nsp="/";f=a.charAt(d+1);if(""!=f&&Number(f)==f){for(c.id="";++d;){f=a.charAt(d);if(null==f||Number(f)!=f){--d;break}c.id+=a.charAt(d);if(d+1==a.length)break}c.id=Number(c.id)}if(a.charAt(++d))try{c.data=m.parse(a.substr(d))}catch(g){a={type:e.ERROR,data:"parser error"};break a}l("decoded %s as %j",a,c);a=c}}e.BINARY_EVENT==a.type||e.BINARY_ACK==a.type?(this.reconstructor=new k(a),0==this.reconstructor.reconPack.attachments&&this.emit("decoded",a)):this.emit("decoded",a)}else if(r(a)||
a.base64)if(this.reconstructor){if(a=this.reconstructor.takeBinaryData(a))this.reconstructor=null,this.emit("decoded",a)}else throw Error("got binary data when not reconstructing a packet");else throw Error("Unknown type: "+a);};h.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()};k.prototype.takeBinaryData=function(a){this.buffers.push(a);return this.buffers.length==this.reconPack.attachments?(a=n.reconstructPacket(this.reconPack,this.buffers),this.finishedReconstruction(),
a):null};k.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]}},{"./binary":39,"./is-buffer":41,"component-emitter":8,debug:9,isarray:42,json3:43}],41:[function(a,c,e){(function(a){c.exports=function(c){return a.Buffer&&a.Buffer.isBuffer(c)||a.ArrayBuffer&&c instanceof ArrayBuffer}}).call(this,"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],42:[function(a,c,e){c.exports=a(33)},{}],43:[function(a,c,e){(function(a){function c(a){if(c[a]!==l)return c[a];
var d;if("bug-string-char-index"==a)d="a"!="a"[0];else if("json"==a)d=c("json-stringify")&&c("json-parse");else{var e;if("json-stringify"==a){d=n.stringify;var h="function"==typeof d&&r;if(h){(e=function(){return 1}).toJSON=e;try{h="0"===d(0)&&"0"===d(new Number)&&'""'==d(new String)&&d(g)===l&&d(l)===l&&d()===l&&"1"===d(e)&&"[1]"==d([e])&&"[null]"==d([l])&&"null"==d(null)&&"[null,null,null]"==d([l,g,null])&&'{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}'==d({a:[e,!0,!1,null,"\x00\b\n\f\r\t"]})&&
"1"===d(null,e)&&"[\n 1,\n 2\n]"==d([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==d(new Date(-864E13))&&'"+275760-09-13T00:00:00.000Z"'==d(new Date(864E13))&&'"-000001-01-01T00:00:00.000Z"'==d(new Date(-621987552E5))&&'"1969-12-31T23:59:59.999Z"'==d(new Date(-1))}catch(k){h=!1}}d=h}if("json-parse"==a){d=n.parse;if("function"==typeof d)try{if(0===d("0")&&!d(!1)){e=d('{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}');var m=5==e.a.length&&1===e.a[0];if(m){try{m=!d('"\t"')}catch(q){}if(m)try{m=1!==
d("01")}catch(p){}if(m)try{m=1!==d("1.")}catch(u){}}}}catch(t){m=!1}d=m}}return c[a]=!!d}var g={}.toString,h,k,l,m="object"==typeof JSON&&JSON,n="object"==typeof e&&e&&!e.nodeType&&e;n&&m?(n.stringify=m.stringify,n.parse=m.parse):n=a.JSON=m||{};var r=new Date(-0xc782b5b800cec);try{r=-109252==r.getUTCFullYear()&&0===r.getUTCMonth()&&1===r.getUTCDate()&&10==r.getUTCHours()&&37==r.getUTCMinutes()&&6==r.getUTCSeconds()&&708==r.getUTCMilliseconds()}catch(q){}if(!c("json")){var p=c("bug-string-char-index");
if(!r)var u=Math.floor,B=[0,31,59,90,120,151,181,212,243,273,304,334],L=function(a,c){return B[c]+365*(a-1970)+u((a-1969+(c=+(1<c)))/4)-u((a-1901+c)/100)+u((a-1601+c)/400)};(h={}.hasOwnProperty)||(h=function(a){var c={},d;(c.__proto__=null,c.__proto__={toString:1},c).toString!=g?h=function(a){var c=this.__proto__;a=a in(this.__proto__=null,this);this.__proto__=c;return a}:(d=c.constructor,h=function(a){var c=(this.constructor||d).prototype;return a in this&&!(a in c&&this[a]===c[a])});c=null;return h.call(this,
a)});var C={"boolean":1,number:1,string:1,undefined:1};k=function(a,c){var d=0,e,f,l;(e=function(){this.valueOf=0}).prototype.valueOf=0;f=new e;for(l in f)h.call(f,l)&&d++;e=f=null;d?k=2==d?function(a,c){var d={},e="[object Function]"==g.call(a),f;for(f in a)e&&"prototype"==f||(h.call(d,f)||!(d[f]=1)||!h.call(a,f))||c(f)}:function(a,c){var d="[object Function]"==g.call(a),e,f;for(e in a)d&&"prototype"==e||(!h.call(a,e)||(f="constructor"===e))||c(e);(f||h.call(a,e="constructor"))&&c(e)}:(f="valueOf toString toLocaleString propertyIsEnumerable isPrototypeOf hasOwnProperty constructor".split(" "),
k=function(a,c){var d="[object Function]"==g.call(a),e,k;if(k=!d)if(k="function"!=typeof a.constructor)k=typeof a.hasOwnProperty,k="object"==k?!!a.hasOwnProperty:!C[k];k=k?a.hasOwnProperty:h;for(e in a)d&&"prototype"==e||!k.call(a,e)||c(e);for(d=f.length;e=f[--d];k.call(a,e)&&c(e));});return k(a,c)};if(!c("json-stringify")){var H={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},E=function(a,c){return("000000"+(c||0)).slice(-a)},I=function(a){var c='"',d=0,e=a.length,f=10<e&&p,g;for(f&&
(g=a.split(""));d<e;d++){var h=a.charCodeAt(d);switch(h){case 8:case 9:case 10:case 12:case 13:case 34:case 92:c+=H[h];break;default:if(32>h){c+="\\u00"+E(2,h.toString(16));break}c+=f?g[d]:p?a.charAt(d):a[d]}}return c+'"'},z=function(a,c,d,e,f,m,q){var n,p,r,s,y,w,B,D,C;try{n=c[a]}catch(v){}if("object"==typeof n&&n)if(p=g.call(n),"[object Date]"!=p||h.call(n,"toJSON"))"function"==typeof n.toJSON&&("[object Number]"!=p&&"[object String]"!=p&&"[object Array]"!=p||h.call(n,"toJSON"))&&(n=n.toJSON(a));
else if(n>-1/0&&n<1/0){if(L){s=u(n/864E5);for(p=u(s/365.2425)+1970-1;L(p+1,0)<=s;p++);for(r=u((s-L(p,0))/30.42);L(p,r+1)<=s;r++);s=1+s-L(p,r);y=(n%864E5+864E5)%864E5;w=u(y/36E5)%24;B=u(y/6E4)%60;D=u(y/1E3)%60;y%=1E3}else p=n.getUTCFullYear(),r=n.getUTCMonth(),s=n.getUTCDate(),w=n.getUTCHours(),B=n.getUTCMinutes(),D=n.getUTCSeconds(),y=n.getUTCMilliseconds();n=(0>=p||1E4<=p?(0>p?"-":"+")+E(6,0>p?-p:p):E(4,p))+"-"+E(2,r+1)+"-"+E(2,s)+"T"+E(2,w)+":"+E(2,B)+":"+E(2,D)+"."+E(3,y)+"Z"}else n=null;d&&(n=
d.call(c,a,n));if(null===n)return"null";p=g.call(n);if("[object Boolean]"==p)return""+n;if("[object Number]"==p)return n>-1/0&&n<1/0?""+n:"null";if("[object String]"==p)return I(""+n);if("object"==typeof n){for(a=q.length;a--;)if(q[a]===n)throw TypeError();q.push(n);C=[];c=m;m+=f;if("[object Array]"==p){r=0;for(a=n.length;r<a;r++)p=z(r,n,d,e,f,m,q),C.push(p===l?"null":p);a=C.length?f?"[\n"+m+C.join(",\n"+m)+"\n"+c+"]":"["+C.join(",")+"]":"[]"}else k(e||n,function(a){var c=z(a,n,d,e,f,m,q);c!==l&&
C.push(I(a)+":"+(f?" ":"")+c)}),a=C.length?f?"{\n"+m+C.join(",\n"+m)+"\n"+c+"}":"{"+C.join(",")+"}":"{}";q.pop();return a}};n.stringify=function(a,c,d){var e,f,h,k;if("function"==typeof c||"object"==typeof c&&c)if("[object Function]"==(k=g.call(c)))f=c;else if("[object Array]"==k){h={};for(var l=0,m=c.length,n;l<m;n=c[l++],(k=g.call(n),"[object String]"==k||"[object Number]"==k)&&(h[n]=1));}if(d)if("[object Number]"==(k=g.call(d))){if(0<(d-=d%1))for(e="",10<d&&(d=10);e.length<d;e+=" ");}else"[object String]"==
k&&(e=10>=d.length?d:d.slice(0,10));return z("",(n={},n[""]=a,n),f,h,e,"",[])}}if(!c("json-parse")){var T=String.fromCharCode,F={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},s,J,y=function(){s=J=null;throw SyntaxError();},S=function(){for(var a=J,c=a.length,d,e,f,h,g;s<c;)switch(g=a.charCodeAt(s),g){case 9:case 10:case 13:case 32:s++;break;case 123:case 125:case 91:case 93:case 58:case 44:return d=p?a.charAt(s):a[s],s++,d;case 34:d="@";for(s++;s<c;)if(g=a.charCodeAt(s),32>g)y();
else if(92==g)switch(g=a.charCodeAt(++s),g){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:d+=F[g];s++;break;case 117:e=++s;for(f=s+4;s<f;s++)g=a.charCodeAt(s),48<=g&&57>=g||(97<=g&&102>=g||65<=g&&70>=g)||y();d+=T("0x"+a.slice(e,s));break;default:y()}else{if(34==g)break;g=a.charCodeAt(s);for(e=s;32<=g&&92!=g&&34!=g;)g=a.charCodeAt(++s);d+=a.slice(e,s)}if(34==a.charCodeAt(s))return s++,d;y();default:e=s;45==g&&(h=!0,g=a.charCodeAt(++s));if(48<=g&&57>=g){for(48==g&&(g=a.charCodeAt(s+
1),48<=g&&57>=g)&&y();s<c&&(g=a.charCodeAt(s),48<=g&&57>=g);s++);if(46==a.charCodeAt(s)){for(f=++s;f<c&&(g=a.charCodeAt(f),48<=g&&57>=g);f++);f==s&&y();s=f}g=a.charCodeAt(s);if(101==g||69==g){g=a.charCodeAt(++s);43!=g&&45!=g||s++;for(f=s;f<c&&(g=a.charCodeAt(f),48<=g&&57>=g);f++);f==s&&y();s=f}return+a.slice(e,s)}h&&y();if("true"==a.slice(s,s+4))return s+=4,!0;if("false"==a.slice(s,s+5))return s+=5,!1;if("null"==a.slice(s,s+4))return s+=4,null;y()}return"$"},ka=function(a){var c,d;"$"==a&&y();if("string"==
typeof a){if("@"==(p?a.charAt(0):a[0]))return a.slice(1);if("["==a){for(c=[];;d||(d=!0)){a=S();if("]"==a)break;d&&(","==a?(a=S(),"]"==a&&y()):y());","==a&&y();c.push(ka(a))}return c}if("{"==a){for(c={};;d||(d=!0)){a=S();if("}"==a)break;d&&(","==a?(a=S(),"}"==a&&y()):y());","!=a&&"string"==typeof a&&"@"==(p?a.charAt(0):a[0])&&":"==S()||y();c[a.slice(1)]=ka(S())}return c}y()}return a},la=function(a,c,d){d=pa(a,c,d);d===l?delete a[c]:a[c]=d},pa=function(a,c,d){var e=a[c],f;if("object"==typeof e&&e)if("[object Array]"==
g.call(e))for(f=e.length;f--;)la(e,f,d);else k(e,function(a){la(e,a,d)});return d.call(a,c,e)};n.parse=function(a,c){var d,e;s=0;J=""+a;d=ka(S());"$"!=S()&&y();s=J=null;return c&&"[object Function]"==g.call(c)?pa((e={},e[""]=d,e),"",c):d}}}})(this)},{}],44:[function(a,c,e){c.exports=function(a,c){for(var e=[],h=(c=c||0)||0;h<a.length;h++)e[h-c]=a[h];return e}},{}]},{},[1])(1)});
